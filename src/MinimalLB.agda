{-# OPTIONS --without-K #-}

module MinimalLB where


--------------------------------------------------------------------------------
--
-- Prelude


open import Agda.Primitive public
  using (_âŠ”_)

open import Agda.Builtin.Equality
  using (_â‰¡_ ; refl)

open import Agda.Builtin.Unit
  using (âŠ¤ ; tt)


id : âˆ€ {â„“} â†’ {X : Set â„“}
           â†’ X
           â†’ X
id x = x

_âˆ˜_ : âˆ€ {â„“ â„“â€² â„“â€³} â†’ {X : Set â„“} {P : X â†’ Set â„“â€²} {Q : âˆ€ {x} â†’ P x â†’ Set â„“â€³}
                  â†’ (g : âˆ€ {x} â†’ (y : P x) â†’ Q y) (f : (x : X) â†’ P x) (x : X)
                  â†’ Q (f x)
(g âˆ˜ f) x = g (f x)


data âŠ¥ : Set where

elimâŠ¥ : âˆ€ {â„“} â†’ {X : Set â„“}
               â†’ âŠ¥
               â†’ X
elimâŠ¥ ()

Â¬_ : âˆ€ {â„“} â†’ Set â„“ â†’ Set â„“
Â¬ X = X â†’ âŠ¥


infixl 6 _,_
record Î£ {â„“ â„“â€²}
         (X : Set â„“) (P : X â†’ Set â„“â€²)
       : Set (â„“ âŠ” â„“â€²) where
  constructor _,_
  field
    projâ‚ : X
    projâ‚‚ : P projâ‚
open Î£ public

infixl 5 _â_
pattern _â_ x y = x , y

infixl 2 _Ã—_
_Ã—_ : âˆ€ {â„“ â„“â€²} â†’ Set â„“ â†’ Set â„“â€²
               â†’ Set (â„“ âŠ” â„“â€²)
X Ã— Y = Î£ X (Î» x â†’ Y)


--------------------------------------------------------------------------------
--
-- Syntax


-- Types
infixl 9 _â©•_
infixr 7 _â‡’_
data ğ’¯ : Set where
  âˆ—    : ğ’¯
  _â‡’_ : (A B : ğ’¯) â†’ ğ’¯
  _â©•_  : (A B : ğ’¯) â†’ ğ’¯
  â«ª   : ğ’¯
  â–¡_   : (A : ğ’¯) â†’ ğ’¯


-- Contexts
data ğ’ : Set where
  âˆ…   : ğ’
  _,_ : (Î“ : ğ’) (A : ğ’¯) â†’ ğ’

ğ’Â² : Set
ğ’Â² = ğ’ Ã— ğ’


-- Variables
infix 4 _âˆ‹_
data _âˆ‹_ : ğ’ â†’ ğ’¯ â†’ Set
  where
    zero : âˆ€ {Î“ A} â†’ Î“ , A âˆ‹ A

    suc  : âˆ€ {Î“ A B} â†’ (i : Î“ âˆ‹ A)
                     â†’ Î“ , B âˆ‹ A

-- Syntactic entailment
infixl 5 _âˆ™_
infix 3 _âŠ¢_
data _âŠ¢_ : ğ’Â² â†’ ğ’¯ â†’ Set
  where
    -- Reference to modal hypothesis
    áµáµ›  : âˆ€ {A Î” Î“} â†’ (i : Î” âˆ‹ A)
                    â†’ Î” â Î“ âŠ¢ A

    -- Reference to hypothesis
    áµ›   : âˆ€ {A Î” Î“} â†’ (i : Î“ âˆ‹ A)
                    â†’ Î” â Î“ âŠ¢ A

    -- Abstraction
    Æ›   : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ , A âŠ¢ B)
                      â†’ Î” â Î“ âŠ¢ A â‡’ B

    -- Application
    _âˆ™_ : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢ A â‡’ B) (N : Î” â Î“ âŠ¢ A)
                      â†’ Î” â Î“ âŠ¢ B

    -- Pairing
    _,_ : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢ A) (N : Î” â Î“ âŠ¢ B)
                      â†’ Î” â Î“ âŠ¢ A â©• B

    -- First projection
    Ï€â‚  : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢ A â©• B)
                      â†’ Î” â Î“ âŠ¢ A

    -- Second projection
    Ï€â‚‚  : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢ A â©• B)
                      â†’ Î” â Î“ âŠ¢ B

    -- Unit
    Ï„   : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢ â«ª

    -- Quotation
    âŒœ_âŒ : âˆ€ {A Î” Î“} â†’ (M : Î” â âˆ… âŠ¢ A)
                    â†’ Î” â Î“ âŠ¢ â–¡ A

    -- Unquotation
    âŒ_âŒŸ : âˆ€ {A C Î” Î“} â†’ (M : Î” â Î“ âŠ¢ â–¡ A) (N : Î” , A â Î“ âŠ¢ C)
                      â†’ Î” â Î“ âŠ¢ C


áµáµ›0 : âˆ€ {Î” Î“ A} â†’ Î” , A â Î“ âŠ¢ A
áµáµ›0 = áµáµ› zero

áµáµ›1 : âˆ€ {Î” Î“ A B} â†’ Î” , A , B â Î“ âŠ¢ A
áµáµ›1 = áµáµ› (suc zero)

áµáµ›2 : âˆ€ {Î” Î“ A B C} â†’ Î” , A , B , C â Î“ âŠ¢ A
áµáµ›2 = áµáµ› (suc (suc zero))


áµ›0 : âˆ€ {Î” Î“ A} â†’ Î” â Î“ , A âŠ¢ A
áµ›0 = áµ› zero

áµ›1 : âˆ€ {Î” Î“ A B} â†’ Î” â Î“ , A , B âŠ¢ A
áµ›1 = áµ› (suc zero)

áµ›2 : âˆ€ {Î” Î“ A B C} â†’ Î” â Î“ , A , B , C âŠ¢ A
áµ›2 = áµ› (suc (suc zero))


-- Normal and neutral forms
mutual
  infix 3 _âŠ¢â¿á¶ _
  data _âŠ¢â¿á¶ _ : ğ’Â² â†’ ğ’¯ â†’ Set
    where
      Æ›   : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ , A âŠ¢â¿á¶  B)
                        â†’ Î” â Î“ âŠ¢â¿á¶  A â‡’ B

      _,_ : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢â¿á¶  A) (N : Î” â Î“ âŠ¢â¿á¶  B)
                        â†’ Î” â Î“ âŠ¢â¿á¶  A â©• B

      Ï„   : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â¿á¶  â«ª

      âŒœ_âŒ : âˆ€ {A Î” Î“} â†’ (M : Î” â âˆ… âŠ¢ A)
                      â†’ Î” â Î“ âŠ¢â¿á¶  â–¡ A

      ne  : âˆ€ {A Î” Î“} â†’ (M : Î” â Î“ âŠ¢â¿áµ‰ A)
                      â†’ Î” â Î“ âŠ¢â¿á¶  A

  infix 3 _âŠ¢â¿áµ‰_
  data _âŠ¢â¿áµ‰_ : ğ’Â² â†’ ğ’¯ â†’ Set
    where
      áµáµ›  : âˆ€ {A Î” Î“} â†’ (i : Î” âˆ‹ A)
                      â†’ Î” â Î“ âŠ¢â¿áµ‰ A

      áµ›   : âˆ€ {A Î” Î“} â†’ (i : Î“ âˆ‹ A)
                      â†’ Î” â Î“ âŠ¢â¿áµ‰ A

      _âˆ™_ : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢â¿áµ‰ A â‡’ B) (N : Î” â Î“ âŠ¢â¿á¶  A)
                        â†’ Î” â Î“ âŠ¢â¿áµ‰ B

      Ï€â‚  : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢â¿áµ‰ A â©• B)
                        â†’ Î” â Î“ âŠ¢â¿áµ‰ A

      Ï€â‚‚  : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢â¿áµ‰ A â©• B)
                        â†’ Î” â Î“ âŠ¢â¿áµ‰ B

      âŒ_âŒŸ : âˆ€ {A C Î” Î“} â†’ (M : Î” â Î“ âŠ¢â¿áµ‰ â–¡ A) (N : Î” , A â Î“ âŠ¢â¿á¶  C)
                        â†’ Î” â Î“ âŠ¢â¿áµ‰ C


mutual
  embâ¿á¶  : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢â¿á¶  A â†’ Î” â Î“ âŠ¢ A
  embâ¿á¶  (Æ› M)   = Æ› (embâ¿á¶  M)
  embâ¿á¶  (M , N) = embâ¿á¶  M , embâ¿á¶  N
  embâ¿á¶  Ï„       = Ï„
  embâ¿á¶  (âŒœ M âŒ) = âŒœ M âŒ
  embâ¿á¶  (ne M)  = embâ¿áµ‰ M

  embâ¿áµ‰ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢â¿áµ‰ A â†’ Î” â Î“ âŠ¢ A
  embâ¿áµ‰ (áµáµ› i)    = áµáµ› i
  embâ¿áµ‰ (áµ› i)     = áµ› i
  embâ¿áµ‰ (M âˆ™ N)   = embâ¿áµ‰ M âˆ™ embâ¿á¶  N
  embâ¿áµ‰ (Ï€â‚ M)    = Ï€â‚ (embâ¿áµ‰ M)
  embâ¿áµ‰ (Ï€â‚‚ M)    = Ï€â‚‚ (embâ¿áµ‰ M)
  embâ¿áµ‰ (âŒ M âŒŸ N) = âŒ embâ¿áµ‰ M âŒŸ (embâ¿á¶  N)


--------------------------------------------------------------------------------
--
-- Renaming


-- Order-preserving embeddings
infix 4 _âŠ‡_
data _âŠ‡_ : ğ’ â†’ ğ’ â†’ Set
  where
    doneáµ£ : âˆ… âŠ‡ âˆ…

    wkáµ£   : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âŠ‡ Î“)
                       â†’ Î“â€² , A âŠ‡ Î“

    liftáµ£ : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âŠ‡ Î“)
                       â†’ Î“â€² , A âŠ‡ Î“ , A

infix 3 _âŠ‡Â²_
_âŠ‡Â²_ : ğ’Â² â†’ ğ’Â² â†’ Set
Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ = Î”â€² âŠ‡ Î” Ã— Î“â€² âŠ‡ Î“


áµwkáµ£Â² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“
                        â†’ Î”â€² , A â Î“â€² âŠ‡Â² Î” â Î“
áµwkáµ£Â² Î· = wkáµ£ (projâ‚ Î·) , projâ‚‚ Î·

wkáµ£Â² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“
                       â†’ Î”â€² â Î“â€² , A âŠ‡Â² Î” â Î“
wkáµ£Â² Î· = projâ‚ Î· , wkáµ£ (projâ‚‚ Î·)


infáµ£ : âˆ€ {Î“} â†’ Î“ âŠ‡ âˆ…
infáµ£ {âˆ…}     = doneáµ£
infáµ£ {Î“ , A} = wkáµ£ infáµ£


idáµ£ : âˆ€ {Î“} â†’ Î“ âŠ‡ Î“
idáµ£ {âˆ…}     = doneáµ£
idáµ£ {Î“ , A} = liftáµ£ idáµ£

idáµ£Â² : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ‡Â² Î” â Î“
idáµ£Â² = idáµ£ , idáµ£


_âˆ˜áµ£_ : âˆ€ {Î“ Î“â€² Î“â€³} â†’ Î“â€² âŠ‡ Î“ â†’ Î“â€³ âŠ‡ Î“â€²
                  â†’ Î“â€³ âŠ‡ Î“
Î·       âˆ˜áµ£ doneáµ£    = Î·
Î·       âˆ˜áµ£ wkáµ£ Î·â€²   = wkáµ£ (Î· âˆ˜áµ£ Î·â€²)
wkáµ£ Î·   âˆ˜áµ£ liftáµ£ Î·â€² = wkáµ£ (Î· âˆ˜áµ£ Î·â€²)
liftáµ£ Î· âˆ˜áµ£ liftáµ£ Î·â€² = liftáµ£ (Î· âˆ˜áµ£ Î·â€²)

_âˆ˜áµ£Â²_ : âˆ€ {Î” Î”â€² Î”â€³ Î“ Î“â€² Î“â€³} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î”â€³ â Î“â€³ âŠ‡Â² Î”â€² â Î“â€²
                           â†’ Î”â€³ â Î“â€³ âŠ‡Â² Î” â Î“
Î· âˆ˜áµ£Â² Î·â€² = (projâ‚ Î· âˆ˜áµ£ projâ‚ Î·â€²) , (projâ‚‚ Î· âˆ˜áµ£ projâ‚‚ Î·â€²)


lookupáµ£ : âˆ€ {Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î“ âˆ‹ A
                     â†’ Î“â€² âˆ‹ A
lookupáµ£ doneáµ£     i       = i
lookupáµ£ (wkáµ£ Î·)   i       = suc (lookupáµ£ Î· i)
lookupáµ£ (liftáµ£ Î·) zero    = zero
lookupáµ£ (liftáµ£ Î·) (suc i) = suc (lookupáµ£ Î· i)

áµlookupáµ£Â² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” âˆ‹ A
                            â†’ Î”â€² âˆ‹ A
áµlookupáµ£Â² Î· i = lookupáµ£ (projâ‚ Î·) i

lookupáµ£Â² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î“ âˆ‹ A
                           â†’ Î“â€² âˆ‹ A
lookupáµ£Â² Î· i = lookupáµ£ (projâ‚‚ Î·) i


-- Renaming
áµren : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢ A
                    â†’ Î”â€² â Î“ âŠ¢ A
áµren Î· (áµáµ› i)    = áµáµ› (lookupáµ£ Î· i)
áµren Î· (áµ› i)     = áµ› i
áµren Î· (Æ› M)     = Æ› (áµren Î· M)
áµren Î· (M âˆ™ N)   = áµren Î· M âˆ™ áµren Î· N
áµren Î· (M , N)   = áµren Î· M , áµren Î· N
áµren Î· (Ï€â‚ M)    = Ï€â‚ (áµren Î· M)
áµren Î· (Ï€â‚‚ M)    = Ï€â‚‚ (áµren Î· M)
áµren Î· Ï„         = Ï„
áµren Î· (âŒœ M âŒ)   = âŒœ áµren Î· M âŒ
áµren Î· (âŒ M âŒŸ N) = âŒ áµren Î· M âŒŸ (áµren (liftáµ£ Î·) N)

ren : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢ A
                   â†’ Î” â Î“â€² âŠ¢ A
ren Î· (áµáµ› i)    = áµáµ› i
ren Î· (áµ› i)     = áµ› (lookupáµ£ Î· i)
ren Î· (Æ› M)     = Æ› (ren (liftáµ£ Î·) M)
ren Î· (M âˆ™ N)   = ren Î· M âˆ™ ren Î· N
ren Î· (M , N)   = ren Î· M , ren Î· N
ren Î· (Ï€â‚ M)    = Ï€â‚ (ren Î· M)
ren Î· (Ï€â‚‚ M)    = Ï€â‚‚ (ren Î· M)
ren Î· Ï„         = Ï„
ren Î· (âŒœ M âŒ)   = âŒœ M âŒ
ren Î· (âŒ M âŒŸ N) = âŒ ren Î· M âŒŸ (ren Î· N)

renÂ² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢ A
                       â†’ Î”â€² â Î“â€² âŠ¢ A
renÂ² Î· M = (áµren (projâ‚ Î·) âˆ˜ ren (projâ‚‚ Î·)) M


mutual
  áµrenâ¿á¶  : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â¿á¶  A
                        â†’ Î”â€² â Î“ âŠ¢â¿á¶  A
  áµrenâ¿á¶  Î· (Æ› M)   = Æ› (áµrenâ¿á¶  Î· M)
  áµrenâ¿á¶  Î· (M , N) = áµrenâ¿á¶  Î· M , áµrenâ¿á¶  Î· N
  áµrenâ¿á¶  Î· Ï„       = Ï„
  áµrenâ¿á¶  Î· (âŒœ M âŒ) = âŒœ áµren Î· M âŒ
  áµrenâ¿á¶  Î· (ne M)  = ne (áµrenâ¿áµ‰ Î· M)

  áµrenâ¿áµ‰ : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â¿áµ‰ A
                        â†’ Î”â€² â Î“ âŠ¢â¿áµ‰ A
  áµrenâ¿áµ‰ Î· (áµáµ› i)    = áµáµ› (lookupáµ£ Î· i)
  áµrenâ¿áµ‰ Î· (áµ› i )    = áµ› i
  áµrenâ¿áµ‰ Î· (M âˆ™ N)   = áµrenâ¿áµ‰ Î· M âˆ™ áµrenâ¿á¶  Î· N
  áµrenâ¿áµ‰ Î· (Ï€â‚ M)    = Ï€â‚ (áµrenâ¿áµ‰ Î· M)
  áµrenâ¿áµ‰ Î· (Ï€â‚‚ M)    = Ï€â‚‚ (áµrenâ¿áµ‰ Î· M)
  áµrenâ¿áµ‰ Î· (âŒ M âŒŸ N) = âŒ áµrenâ¿áµ‰ Î· M âŒŸ (áµrenâ¿á¶  (liftáµ£ Î·) N)

mutual
  renâ¿á¶  : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â¿á¶  A
                       â†’ Î” â Î“â€² âŠ¢â¿á¶  A
  renâ¿á¶  Î· (Æ› M)   = Æ› (renâ¿á¶  (liftáµ£ Î·) M)
  renâ¿á¶  Î· (M , N) = renâ¿á¶  Î· M , renâ¿á¶  Î· N
  renâ¿á¶  Î· Ï„       = Ï„
  renâ¿á¶  Î· (âŒœ M âŒ) = âŒœ M âŒ
  renâ¿á¶  Î· (ne M)  = ne (renâ¿áµ‰ Î· M)

  renâ¿áµ‰ : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â¿áµ‰ A
                       â†’ Î” â Î“â€² âŠ¢â¿áµ‰ A
  renâ¿áµ‰ Î· (áµáµ› i)    = áµáµ› i
  renâ¿áµ‰ Î· (áµ› i)     = áµ› (lookupáµ£ Î· i)
  renâ¿áµ‰ Î· (M âˆ™ N)   = renâ¿áµ‰ Î· M âˆ™ renâ¿á¶  Î· N
  renâ¿áµ‰ Î· (Ï€â‚ M)    = Ï€â‚ (renâ¿áµ‰ Î· M)
  renâ¿áµ‰ Î· (Ï€â‚‚ M)    = Ï€â‚‚ (renâ¿áµ‰ Î· M)
  renâ¿áµ‰ Î· (âŒ M âŒŸ N) = âŒ renâ¿áµ‰ Î· M âŒŸ (renâ¿á¶  Î· N)

renâ¿á¶ Â² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â¿á¶  A
                         â†’ Î”â€² â Î“â€² âŠ¢â¿á¶  A
renâ¿á¶ Â² Î· M = (áµrenâ¿á¶  (projâ‚ Î·) âˆ˜ renâ¿á¶  (projâ‚‚ Î·)) M

renâ¿áµ‰Â² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â¿áµ‰ A
                         â†’ Î”â€² â Î“â€² âŠ¢â¿áµ‰ A
renâ¿áµ‰Â² Î· M = (áµrenâ¿áµ‰ (projâ‚ Î·) âˆ˜ renâ¿áµ‰ (projâ‚‚ Î·)) M


--------------------------------------------------------------------------------
--
-- Substitution


-- Simultaneous ubstitutions
infix 3 _âŠ¢â‹†_
data _âŠ¢â‹†_ : ğ’Â² â†’ ğ’ â†’ Set
  where
    âˆ…   : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‹† âˆ…

    _,_ : âˆ€ {Î” Î“ Î A} â†’ (Ïƒ : Î” â Î“ âŠ¢â‹† Î) (M : Î” â Î“ âŠ¢ A)
                      â†’ Î” â Î“ âŠ¢â‹† Î , A


áµrenâ‹† : âˆ€ {Î” Î”â€² Î“ Î} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î”â€² â Î“ âŠ¢â‹† Î
áµrenâ‹† Î· âˆ…       = âˆ…
áµrenâ‹† Î· (Ïƒ , M) = áµrenâ‹† Î· Ïƒ , áµren Î· M

renâ‹† : âˆ€ {Î” Î“ Î“â€² Î} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‹† Î
                    â†’ Î” â Î“â€² âŠ¢â‹† Î
renâ‹† Î· âˆ…       = âˆ…
renâ‹† Î· (Ïƒ , M) = renâ‹† Î· Ïƒ , ren Î· M


áµwkâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                   â†’ Î” , A â Î“ âŠ¢â‹† Î
áµwkâ‚› Ïƒ = áµrenâ‹† (wkáµ£ idáµ£) Ïƒ

wkâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                  â†’ Î” â Î“ , A âŠ¢â‹† Î
wkâ‚› Ïƒ = renâ‹† (wkáµ£ idáµ£) Ïƒ

áµliftâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” , A â Î“ âŠ¢â‹† Î , A
áµliftâ‚› Ïƒ = áµwkâ‚› Ïƒ , áµáµ› zero

liftâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                    â†’ Î” â Î“ , A âŠ¢â‹† Î , A
liftâ‚› Ïƒ = wkâ‚› Ïƒ , áµ› zero


áµidâ‚› : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‹† Î”
áµidâ‚› {âˆ…}     = âˆ…
áµidâ‚› {Î“ , A} = áµliftâ‚› áµidâ‚›

idâ‚› : âˆ€ {Î“ Î”} â†’ Î” â Î“ âŠ¢â‹† Î“
idâ‚› {âˆ…}     = âˆ…
idâ‚› {Î“ , A} = liftâ‚› idâ‚›


lookupâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î âˆ‹ A
                      â†’ Î” â Î“ âŠ¢ A
lookupâ‚› (Ïƒ , M) zero    = M
lookupâ‚› (Ïƒ , M) (suc i) = lookupâ‚› Ïƒ i


-- Substitution
áµsub : âˆ€ {Î” Î“ Î A} â†’ Î” â âˆ… âŠ¢â‹† Î â†’ Î â Î“ âŠ¢ A
                   â†’ Î” â Î“ âŠ¢ A
áµsub Ïƒ (áµáµ› i)    = ren infáµ£ (lookupâ‚› Ïƒ i)
áµsub Ïƒ (áµ› i)     = áµ› i
áµsub Ïƒ (Æ› M)     = Æ› (áµsub Ïƒ M)
áµsub Ïƒ (M âˆ™ N)   = áµsub Ïƒ M âˆ™ áµsub Ïƒ N
áµsub Î· (M , N)   = áµsub Î· M , áµsub Î· N
áµsub Î· (Ï€â‚ M)    = Ï€â‚ (áµsub Î· M)
áµsub Î· (Ï€â‚‚ M)    = Ï€â‚‚ (áµsub Î· M)
áµsub Î· Ï„         = Ï„
áµsub Ïƒ âŒœ M âŒ     = âŒœ áµsub Ïƒ M âŒ
áµsub Ïƒ (âŒ M âŒŸ N) = âŒ áµsub Ïƒ M âŒŸ (áµsub (áµliftâ‚› Ïƒ) N)

sub : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î” â Î âŠ¢ A
                  â†’ Î” â Î“ âŠ¢ A
sub Ïƒ (áµáµ› i)    = áµáµ› i
sub Ïƒ (áµ› i)     = lookupâ‚› Ïƒ i
sub Ïƒ (Æ› M)     = Æ› (sub (liftâ‚› Ïƒ) M)
sub Ïƒ (M âˆ™ N)   = sub Ïƒ M âˆ™ sub Ïƒ N
sub Î· (M , N)   = sub Î· M , sub Î· N
sub Î· (Ï€â‚ M)    = Ï€â‚ (sub Î· M)
sub Î· (Ï€â‚‚ M)    = Ï€â‚‚ (sub Î· M)
sub Î· Ï„         = Ï„
sub Ïƒ âŒœ M âŒ     = âŒœ M âŒ
sub Ïƒ (âŒ M âŒŸ N) = âŒ sub Ïƒ M âŒŸ (sub (áµwkâ‚› Ïƒ) N)


--------------------------------------------------------------------------------
--
-- Semantics


-- Introspective Kripke models
record ğ” : Setâ‚ where
  field
    ğ’²      : Set

    ğ’¢      : ğ’² â†’ Set

    _â‰¥_    : ğ’² â†’ ğ’² â†’ Set

    idâ‚    : âˆ€ {w} â†’ w â‰¥ w

    _âˆ˜â‚_   : âˆ€ {w wâ€² wâ€³} â†’ wâ€² â‰¥ w â†’ wâ€³ â‰¥ wâ€²
                         â†’ wâ€³ â‰¥ w

    accğ’¢   : âˆ€ {w wâ€²} â†’ wâ€² â‰¥ w â†’ ğ’¢ w
                      â†’ ğ’¢ wâ€²

    peekÂ²  : ğ’² â†’ ğ’Â²

    peekâ‚Â² : âˆ€ {w wâ€²} â†’ wâ€² â‰¥ w
                      â†’ peekÂ² wâ€² âŠ‡Â² peekÂ² w

open ğ” {{â€¦}} public


áµpeek : âˆ€ {{_ : ğ”}} â†’ ğ’² â†’ ğ’
áµpeek w = projâ‚ (peekÂ² w)

peek : âˆ€ {{_ : ğ”}} â†’ ğ’² â†’ ğ’
peek w = projâ‚‚ (peekÂ² w)

áµpeekâ‚ : âˆ€ {{_ : ğ”}} {w wâ€²} â†’ wâ€² â‰¥ w
                            â†’ áµpeek wâ€² âŠ‡ áµpeek w
áµpeekâ‚ w = projâ‚ (peekâ‚Â² w)

peekâ‚ : âˆ€ {{_ : ğ”}} {w wâ€²} â†’ wâ€² â‰¥ w
                           â†’ peek wâ€² âŠ‡ peek w
peekâ‚ w = projâ‚‚ (peekâ‚Â² w)


-- Values
mutual
  infix 3 _âŠ©_
  _âŠ©_ : âˆ€ {{_ : ğ”}} â†’ ğ’² â†’ ğ’¯ â†’ Set

  w âŠ© âˆ—      = ğ’¢ w

  w âŠ© A â‡’ B = âˆ€ {wâ€²} â†’ (Î· : wâ€² â‰¥ w) (aâ‚– : wâ€² âˆ‚âŠ© A)
                       â†’ wâ€² âˆ‚âŠ© B

  w âŠ© A â©• B  = w âˆ‚âŠ© A Ã— w âˆ‚âŠ© B

  w âŠ© â«ª     = âŠ¤

  w âŠ© â–¡ A    = âˆ€ {wâ€²} â†’ (Î· : wâ€² â‰¥ w)
                       â†’ wâ€² áµâˆ‚âŠ© A

  infix 3 _âˆ‚âŠ©_
  _âˆ‚âŠ©_ : âˆ€ {{_ : ğ”}} â†’ ğ’² â†’ ğ’¯ â†’ Set
  w âˆ‚âŠ© A = âˆ€ {wâ€² C} â†’ (Î· : wâ€² â‰¥ w) (f : âˆ€ {wâ€³} â†’ wâ€³ â‰¥ wâ€² â†’ wâ€³ âŠ© A
                                                 â†’ peekÂ² wâ€³ âŠ¢â¿á¶  C)
                     â†’ peekÂ² wâ€² âŠ¢â¿á¶  C

  infix 3 _áµâˆ‚âŠ©_
  _áµâˆ‚âŠ©_ : âˆ€ {{_ : ğ”}} â†’ ğ’² â†’ ğ’¯ â†’ Set
  w áµâˆ‚âŠ© A = áµpeek w â âˆ… âŠ¢ A Ã— w âˆ‚âŠ© A


-- Environments
infix 3 _âˆ‚âŠ©â‹†_
data _âˆ‚âŠ©â‹†_ {{_ : ğ”}} : ğ’² â†’ ğ’ â†’ Set
  where
    âˆ…   : âˆ€ {w} â†’ w âˆ‚âŠ©â‹† âˆ…

    _,_ : âˆ€ {A Î w} â†’ (Ï : w âˆ‚âŠ©â‹† Î) (aâ‚– : w âˆ‚âŠ© A)
                    â†’ w âˆ‚âŠ©â‹† Î , A


infix 3 _áµâˆ‚âŠ©â‹†_
data _áµâˆ‚âŠ©â‹†_ {{_ : ğ”}} : ğ’² â†’ ğ’ â†’ Set
  where
    âˆ…   : âˆ€ {w} â†’ w áµâˆ‚âŠ©â‹† âˆ…

    _,_ : âˆ€ {A Î w} â†’ (Ï : w áµâˆ‚âŠ©â‹† Î) (Maâ‚– : w áµâˆ‚âŠ© A)
                    â†’ w áµâˆ‚âŠ©â‹† Î , A


synâ‹† : âˆ€ {{_ : ğ”}} {w Î} â†’ w áµâˆ‚âŠ©â‹† Î
                         â†’ áµpeek w â âˆ… âŠ¢â‹† Î
synâ‹† âˆ…              = âˆ…
synâ‹† (Ï , (M , aâ‚–)) = synâ‹† Ï , M

semâ‹† : âˆ€ {{_ : ğ”}} {w Î} â†’ w áµâˆ‚âŠ©â‹† Î
                         â†’ w âˆ‚âŠ©â‹† Î
semâ‹† âˆ…              = âˆ…
semâ‹† (Ï , (M , aâ‚–)) = semâ‹† Ï , aâ‚–


-- Semantic entailment
infix 3 _âŠ¨_
_âŠ¨_ : ğ’Â² â†’ ğ’¯ â†’ Setâ‚
Î” â Î“ âŠ¨ A = âˆ€ {{_ : ğ”}} {w} â†’ w áµâˆ‚âŠ©â‹† Î” â†’ w âˆ‚âŠ©â‹† Î“
                             â†’ w âˆ‚âŠ© A


-- Accessibility
mutual
  acc : âˆ€ {{_ : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w âŠ© A
                             â†’ wâ€² âŠ© A
  acc {âˆ—}      Î· M = accğ’¢ Î· M
  acc {A â‡’ B} Î· f = Î» Î·â€² â†’ f (Î· âˆ˜â‚ Î·â€²)
  acc {A â©• B}  Î· p = âˆ‚acc {A} Î· (projâ‚ p) , âˆ‚acc {B} Î· (projâ‚‚ p)
  acc {â«ª}     Î· t = tt
  acc {â–¡ A}    Î· f = Î» Î·â€² â†’ f (Î· âˆ˜â‚ Î·â€²)

  âˆ‚acc : âˆ€ {{_ : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w âˆ‚âŠ© A
                              â†’ wâ€² âˆ‚âŠ© A
  âˆ‚acc Î· aâ‚– = Î» Î·â€² f â†’ aâ‚– (Î· âˆ˜â‚ Î·â€²) f

áµâˆ‚acc : âˆ€ {{_ : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâˆ‚âŠ© A
                             â†’ wâ€² áµâˆ‚âŠ© A
áµâˆ‚acc {A} Î· (M , aâ‚–) = renÂ² (áµpeekâ‚ Î· , doneáµ£) M , âˆ‚acc {A} Î· aâ‚–


âˆ‚accâ‹† : âˆ€ {{_ : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w âˆ‚âŠ©â‹† Î
                             â†’ wâ€² âˆ‚âŠ©â‹† Î
âˆ‚accâ‹† Î· âˆ…              = âˆ…
âˆ‚accâ‹† Î· (_,_ {A} Ï aâ‚–) = âˆ‚accâ‹† Î· Ï , âˆ‚acc {A} Î· aâ‚–

áµâˆ‚accâ‹† : âˆ€ {{_ : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâˆ‚âŠ©â‹† Î
                              â†’ wâ€² áµâˆ‚âŠ©â‹† Î
áµâˆ‚accâ‹† Î· âˆ…               = âˆ…
áµâˆ‚accâ‹† Î· (_,_ {A} Ï Maâ‚–) = áµâˆ‚accâ‹† Î· Ï , áµâˆ‚acc {A} Î· Maâ‚–


-- Kripke continuation monad
return : âˆ€ {{_ : ğ”}} {A w} â†’ w âŠ© A
                           â†’ w âˆ‚âŠ© A
return {A} a = Î» Î· f â†’
                 f idâ‚ (acc {A} Î· a)

bind : âˆ€ {{_ : ğ”}} {A C w} â†’ w âˆ‚âŠ© A â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² âŠ© A
                                                 â†’ wâ€² âˆ‚âŠ© C)
                           â†’ w âˆ‚âŠ© C
bind aâ‚– f = Î» Î· fâ€² â†’
              aâ‚– Î· (Î» Î·â€² a â†’
                f (Î· âˆ˜â‚ Î·â€²) a idâ‚ (Î» Î·â€³ b â†’
                  fâ€² (Î·â€² âˆ˜â‚ Î·â€³) b))


âˆ‚lookup : âˆ€ {{_ : ğ”}} {Î A w} â†’ w âˆ‚âŠ©â‹† Î â†’ Î âˆ‹ A
                              â†’ w âˆ‚âŠ© A
âˆ‚lookup (Ï , aâ‚–) zero    = aâ‚–
âˆ‚lookup (Ï , aâ‚–) (suc i) = âˆ‚lookup Ï i


âˆ‚Æ› : âˆ€ {{_ : ğ”}} {A B w} â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² âˆ‚âŠ© A
                                    â†’ wâ€² âˆ‚âŠ© B)
                         â†’ w âˆ‚âŠ© A â‡’ B
âˆ‚Æ› {A} {B} f = return {A â‡’ B} (Î» Î· aâ‚– â†’ f Î· aâ‚–)

âˆ‚âˆ™ : âˆ€ {{_ : ğ”}} {A B w} â†’ w âˆ‚âŠ© A â‡’ B â†’ w âˆ‚âŠ© A
                         â†’ w âˆ‚âŠ© B
âˆ‚âˆ™ {A} {B} fâ‚– aâ‚– = bind {A â‡’ B} {B} fâ‚– (Î» Î· f â†’ f idâ‚ (âˆ‚acc {A} Î· aâ‚–))

âˆ‚, : âˆ€ {{_ : ğ”}} {A B w} â†’ w âˆ‚âŠ© A â†’ w âˆ‚âŠ© B
                         â†’ w âˆ‚âŠ© A â©• B
âˆ‚, {A} {B} aâ‚– bâ‚– = return {A â©• B} (aâ‚– , bâ‚–)

âˆ‚Ï€â‚ : âˆ€ {{_ : ğ”}} {A B w} â†’ w âˆ‚âŠ© A â©• B
                          â†’ w âˆ‚âŠ© A
âˆ‚Ï€â‚ {A} {B} pâ‚– = bind {A â©• B} {A} pâ‚– (Î» Î· p â†’ projâ‚ p)

âˆ‚Ï€â‚‚ : âˆ€ {{_ : ğ”}} {A B w} â†’ w âˆ‚âŠ© A â©• B
                          â†’ w âˆ‚âŠ© B
âˆ‚Ï€â‚‚ {A} {B} pâ‚– = bind {A â©• B} {B} pâ‚– (Î» Î· p â†’ projâ‚‚ p)

âˆ‚Ï„ : âˆ€ {{_ : ğ”}} {w} â†’ w âˆ‚âŠ© â«ª
âˆ‚Ï„ = return {â«ª} tt

âˆ‚âŒœâŒ : âˆ€ {{_ : ğ”}} {A w} â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w
                                   â†’ wâ€² áµâˆ‚âŠ© A)
                        â†’ w âˆ‚âŠ© â–¡ A
âˆ‚âŒœâŒ {A} f = return {â–¡ A} (Î» Î· â†’ f Î·)

âˆ‚âŒâŒŸ : âˆ€ {{_ : ğ”}} {A C w} â†’ w âˆ‚âŠ© â–¡ A
                          â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² áµâˆ‚âŠ© A
                                     â†’ wâ€² âˆ‚âŠ© C)
                          â†’ w âˆ‚âŠ© C
âˆ‚âŒâŒŸ {A} {C} aâ‚– f = bind {â–¡ A} {C} aâ‚– (Î» Î· fâ€² â†’ f Î· (fâ€² idâ‚))


-- Soundness
âŸ¦_âŸ§ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
                â†’ Î” â Î“ âŠ¨ A
âŸ¦ áµáµ› i âŸ§            áµÏ Ï = âˆ‚lookup (semâ‹† áµÏ) i
âŸ¦ áµ› i âŸ§             áµÏ Ï = âˆ‚lookup Ï i
âŸ¦ Æ›   {A} {B} M âŸ§   áµÏ Ï = âˆ‚Æ› {A} {B} (Î» Î· aâ‚– â†’
                             âŸ¦ M âŸ§ (áµâˆ‚accâ‹† Î· áµÏ) (âˆ‚accâ‹† Î· Ï , aâ‚–))
âŸ¦ _âˆ™_ {A} {B} M N âŸ§ áµÏ Ï = âˆ‚âˆ™ {A} {B} (âŸ¦ M âŸ§ áµÏ Ï) (âŸ¦ N âŸ§ áµÏ Ï)
âŸ¦ _,_ {A} {B} M N âŸ§ áµÏ Ï = âˆ‚, {A} {B} (âŸ¦ M âŸ§ áµÏ Ï) (âŸ¦ N âŸ§ áµÏ Ï)
âŸ¦ Ï€â‚  {A} {B} M âŸ§   áµÏ Ï = âˆ‚Ï€â‚ {A} {B} (âŸ¦ M âŸ§ áµÏ Ï)
âŸ¦ Ï€â‚‚  {A} {B} M âŸ§   áµÏ Ï = âˆ‚Ï€â‚‚ {A} {B} (âŸ¦ M âŸ§ áµÏ Ï)
âŸ¦ Ï„ âŸ§               áµÏ Ï = âˆ‚Ï„
âŸ¦ âŒœ_âŒ {A} M âŸ§       áµÏ Ï = âˆ‚âŒœâŒ {A} (Î» Î· â†’
                             áµsub (synâ‹† (áµâˆ‚accâ‹† Î· áµÏ)) M , âŸ¦ M âŸ§ (áµâˆ‚accâ‹† Î· áµÏ) âˆ…)
âŸ¦ âŒ_âŒŸ {A} {C} M N âŸ§ áµÏ Ï = âˆ‚âŒâŒŸ {A} {C} (âŸ¦ M âŸ§ áµÏ Ï) (Î» Î· Maâ‚– â†’
                             âŸ¦ N âŸ§ (áµâˆ‚accâ‹† Î· áµÏ , Maâ‚–) (âˆ‚accâ‹† Î· Ï))


-- Canonical model
instance
  ğ”  : ğ”
  ğ”  = record
        { ğ’²      = ğ’Â²
        ; ğ’¢      = _âŠ¢â¿á¶  âˆ—
        ; _â‰¥_    = _âŠ‡Â²_
        ; idâ‚    = idáµ£Â²
        ; _âˆ˜â‚_   = _âˆ˜áµ£Â²_
        ; accğ’¢   = renâ¿á¶ Â²
        ; peekÂ²  = id
        ; peekâ‚Â² = id
        }

-- Canonical soundness and completeness
mutual
  âŸ¦_âŸ§á¶œ : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢â¿áµ‰ A
                   â†’ Î” â Î“ âˆ‚âŠ© A
  âŸ¦_âŸ§á¶œ {âˆ—}      M = return {âˆ—}      (ne M)
  âŸ¦_âŸ§á¶œ {A â‡’ B} M = return {A â‡’ B} (Î» Î· aâ‚– â†’ âŸ¦ renâ¿áµ‰Â² Î· M âˆ™ reifyá¶œ aâ‚– âŸ§á¶œ)
  âŸ¦_âŸ§á¶œ {A â©• B}  M = return {A â©• B}  (âŸ¦ Ï€â‚ M âŸ§á¶œ , âŸ¦ Ï€â‚‚ M âŸ§á¶œ)
  âŸ¦_âŸ§á¶œ {â«ª}     M = return {â«ª}     tt
  âŸ¦_âŸ§á¶œ {â–¡ A}    M = Î» Î· f â†’
                      ne (âŒ renâ¿áµ‰Â² Î· M âŒŸ (f (áµwkáµ£Â² idáµ£Â²) (Î» Î·â€² â†’
                        áµáµ› (áµlookupáµ£Â² Î·â€² zero) , âŸ¦ áµáµ› (áµlookupáµ£Â² Î·â€² zero) âŸ§á¶œ)))

  reifyá¶œ : âˆ€ {A Î” Î“} â†’ Î” â Î“ âˆ‚âŠ© A
                     â†’ Î” â Î“ âŠ¢â¿á¶  A
  reifyá¶œ {âˆ—}      aâ‚– = aâ‚– idáµ£Â² (Î» Î· M â†’ M)
  reifyá¶œ {A â‡’ B} aâ‚– = aâ‚– idáµ£Â² (Î» Î· f â†’ Æ› (reifyá¶œ (f (wkáµ£Â² idáµ£Â²) âŸ¦ áµ› zero âŸ§á¶œ)))
  reifyá¶œ {A â©• B}  aâ‚– = aâ‚– idáµ£Â² (Î» Î· p â†’ reifyá¶œ (projâ‚ p) , reifyá¶œ (projâ‚‚ p))
  reifyá¶œ {â«ª}     aâ‚– = aâ‚– idáµ£Â² (Î» Î· t â†’ Ï„)
  reifyá¶œ {â–¡ A}    aâ‚– = aâ‚– idáµ£Â² (Î» Î· f â†’ âŒœ projâ‚ (f idáµ£Â²) âŒ)


áµidâ‚‘ : âˆ€ {Î” Î“} â†’ Î” â Î“ áµâˆ‚âŠ©â‹† Î”
áµidâ‚‘ {âˆ…}     = âˆ…
áµidâ‚‘ {Î” , A} = áµâˆ‚accâ‹† (áµwkáµ£Â² idáµ£Â²) áµidâ‚‘ , (áµáµ› zero , âŸ¦ áµáµ› zero âŸ§á¶œ)

idâ‚‘ : âˆ€ {Î“ Î”} â†’ Î” â Î“ âˆ‚âŠ©â‹† Î“
idâ‚‘ {âˆ…}     = âˆ…
idâ‚‘ {Î“ , A} = âˆ‚accâ‹† (wkáµ£Â² idáµ£Â²) idâ‚‘ , âŸ¦ áµ› zero âŸ§á¶œ


-- Completeness
reify : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¨ A
                  â†’ Î” â Î“ âŠ¢â¿á¶  A
reify ğ” = reifyá¶œ (ğ” áµidâ‚‘ idâ‚‘)


-- Normalisation
nf : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
               â†’ Î” â Î“ âŠ¢â¿á¶  A
nf = reify âˆ˜ âŸ¦_âŸ§


--------------------------------------------------------------------------------
--
-- Examples


ğ•€ : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢ A â‡’ A
ğ•€ = Æ› áµ›0

ğ•‚ : âˆ€ {A B Î” Î“} â†’ Î” â Î“ âŠ¢ A â‡’ B â‡’ A
ğ•‚ = Æ› (Æ› áµ›1)

ğ•Š : âˆ€ {A B C Î” Î“} â†’ Î” â Î“ âŠ¢ (A â‡’ B â‡’ C) â‡’ (A â‡’ B) â‡’ A â‡’ C
ğ•Š = Æ› (Æ› (Æ› ((áµ›2 âˆ™ áµ›0) âˆ™ (áµ›1 âˆ™ áµ›0))))


ğ”» : âˆ€ {A B Î” Î“} â†’ Î” â Î“ âŠ¢ â–¡ (A â‡’ B) â‡’ â–¡ A â‡’ â–¡ B
ğ”» = Æ› (Æ› (âŒ áµ›1 âŒŸ (âŒ áµ›0 âŒŸ âŒœ áµáµ›1 âˆ™ áµáµ›0 âŒ)))

ğ•‹ : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢ â–¡ A â‡’ A
ğ•‹ = Æ› (âŒ áµ›0 âŒŸ áµáµ›0)

ğŸœ : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢ â–¡ A â‡’ â–¡ â–¡ A
ğŸœ = Æ› (âŒ áµ›0 âŒŸ âŒœ âŒœ áµáµ›0 âŒ âŒ)


--------------------------------------------------------------------------------
--
-- Conversion tests


test : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A â†’ Î” â Î“ âŠ¢ A
test = embâ¿á¶  âˆ˜ nf


-- redâ‡’ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ , A âŠ¢ B) (N : Î” â Î“ âŠ¢ A)
--                     â†’ Æ› M âˆ™ N âˆ¼ sub (idâ‚› , N) M

test_redâ‡’ : test {âˆ…} {âˆ… , âˆ—} (Æ› áµ›0 âˆ™ áµ›0) â‰¡ áµ›0
test_redâ‡’ = refl


-- redâ©•â‚ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A) (N : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚ (M , N) âˆ¼ M

test_redâ©•â‚ : test {âˆ…} {âˆ… , âˆ— , âˆ—} (Ï€â‚ (áµ›1 , áµ›0)) â‰¡ áµ›1
test_redâ©•â‚ = refl


-- redâ©•â‚‚ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A) (N : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚‚ (M , N) âˆ¼ N
test_redâ©•â‚‚ : test {âˆ…} {âˆ… , âˆ— , âˆ—} (Ï€â‚‚ (áµ›1 , áµ›0)) â‰¡ áµ›0
test_redâ©•â‚‚ = refl


-- redâ–¡ : âˆ€ {Î” Î“ A C} â†’ (M : Î” â âˆ… âŠ¢ A) (N : Î” , A â Î“ âŠ¢ C)
--                    â†’ âŒ âŒœ M âŒ âŒŸ N âˆ¼ áµsub (áµidâ‚› , M) N

test_redâ–¡ : test {âˆ… , âˆ—} {âˆ…} (âŒ âŒœ áµáµ›0 âŒ âŒŸ áµáµ›0) â‰¡ áµáµ›0
test_redâ–¡ = refl


-- expâ‡’ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A â‡’ B)
--                     â†’ M âˆ¼ Æ› (ren (wkáµ£ idáµ£) M âˆ™ áµ›0)

test_expâ‡’ : test {âˆ…} {âˆ… , âˆ— â‡’ âˆ—} áµ›0 â‰¡ Æ› (ren (wkáµ£ idáµ£) áµ›0 âˆ™ áµ›0)
test_expâ‡’ = refl


-- expâ©• : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A â©• B)
--                    â†’ M âˆ¼ Ï€â‚ M , Ï€â‚‚ M

test_expâ©• : test {âˆ…} {âˆ… , âˆ— â©• âˆ—} áµ›0 â‰¡ Ï€â‚ áµ›0 , Ï€â‚‚ áµ›0
test_expâ©• = refl


-- expâ«ª : âˆ€ {Î” Î“} â†’ (M : Î” â Î“ âŠ¢ â«ª)
--                 â†’ M âˆ¼ Ï„

test_expâ«ª : test {âˆ…} {âˆ… , â«ª} áµ›0 â‰¡ Ï„
test_expâ«ª = refl


-- expâ–¡ : âˆ€ {Î” Î“} â†’ (M : Î” â Î“ âŠ¢ â–¡ A)
--                â†’ M âˆ¼ âŒ M âŒŸ âŒœ áµáµ›0 âŒ

test_expâ–¡ : test {âˆ…} {âˆ… , â–¡ âˆ—} áµ›0 â‰¡ âŒ áµ›0 âŒŸ âŒœ áµáµ›0 âŒ
test_expâ–¡ = refl


-- commâ–¡âˆ™ : âˆ€ {Î” Î“ A B X} â†’ (K : Î” â Î“ âŠ¢ â–¡ X)
--                           (M : Î” , X â Î“ âŠ¢ A â‡’ B) (N : Î” â Î“ âŠ¢ A)
--                        â†’ (âŒ K âŒŸ M) âˆ™ N âˆ¼ âŒ K âŒŸ (M âˆ™ (áµren (wkáµ£ idáµ£) N))

test_commâ–¡âˆ™ : test {âˆ…} {âˆ… , â–¡ (âˆ— â‡’ âˆ—) , âˆ—} ((âŒ áµ›1 âŒŸ áµáµ›0) âˆ™ áµ›0) â‰¡ âŒ áµ›1 âŒŸ (áµáµ›0 âˆ™ áµren (wkáµ£ idáµ£) áµ›0)
test_commâ–¡âˆ™ = refl


-- commâ–¡âŒâŒŸ : âˆ€ {Î” Î“ A C X} â†’ (K : Î” â Î“ âŠ¢ â–¡ X)
--                            (M : Î” , X â Î“ âŠ¢ â–¡ A) (N : Î” , A â Î“ âŠ¢ C)
--                         â†’ âŒ (âŒ K âŒŸ M) âŒŸ N âˆ¼ âŒ K âŒŸ (âŒ M âŒŸ (áµren (wkáµ£ idáµ£) N))

test_commâ–¡âŒâŒŸ : test {âˆ…} {âˆ… , â–¡ â–¡ âˆ—} (âŒ (âŒ áµ›0 âŒŸ áµáµ›0) âŒŸ áµáµ›0) â‰¡ âŒ áµ›0 âŒŸ (âŒ áµáµ›0 âŒŸ áµáµ›0)
test_commâ–¡âŒâŒŸ = refl


-- commâ–¡Ï€â‚ : âˆ€ {Î” Î“ A B X} â†’ (K : Î” â Î“ âŠ¢ â–¡ X)
--                            (M : Î” , X â Î“ âŠ¢ A â©• B)
--                         â†’ Ï€â‚ (âŒ K âŒŸ M) âˆ¼ âŒ K âŒŸ (Ï€â‚ M)

test_commâ–¡Ï€â‚ : test {âˆ…} {âˆ… , â–¡ (âˆ— â©• âˆ—)} (Ï€â‚ (âŒ áµ›0 âŒŸ áµáµ›0)) â‰¡ âŒ áµ›0 âŒŸ (Ï€â‚ áµáµ›0)
test_commâ–¡Ï€â‚ = refl


-- commâ–¡Ï€â‚‚ : âˆ€ {Î” Î“ A B X} â†’ (K : Î” â Î“ âŠ¢ â–¡ X)
--                            (M : Î” , X â Î“ âŠ¢ A â©• B)
--                         â†’ Ï€â‚‚ (âŒ K âŒŸ M) âˆ¼ âŒ K âŒŸ (Ï€â‚‚ M)

test_commâ–¡Ï€â‚‚ : test {âˆ…} {âˆ… , â–¡ (âˆ— â©• âˆ—)} (Ï€â‚‚ (âŒ áµ›0 âŒŸ áµáµ›0)) â‰¡ âŒ áµ›0 âŒŸ (Ï€â‚‚ áµáµ›0)
test_commâ–¡Ï€â‚‚ = refl


--------------------------------------------------------------------------------


-- weakBP : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A)
--                      â†’ ğ•‹ âˆ™ âŒœ M âŒ âˆ¼ âŒœ M âŒ

test_weakBP : test {âˆ… , âˆ—} {âˆ…} (ğ•‹ âˆ™ âŒœ áµáµ›0 âŒ) â‰¡ áµáµ›0
test_weakBP = refl


-- Andrej : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A â‡’ B) (N : Î” â Î“ âŠ¢ A)
--                      â†’ (ğ”» âˆ™ âŒœ M âŒ) âˆ™ âŒœ N âŒ âˆ¼ âŒœ M âˆ™ N âŒ

test_Andrej : test {âˆ… , âˆ— â‡’ âˆ— , âˆ—} {âˆ…} ((ğ”» âˆ™ âŒœ áµáµ›1 âŒ) âˆ™ âŒœ áµáµ›0 âŒ) â‰¡ âŒœ áµáµ›1 âˆ™ áµáµ›0 âŒ
test_Andrej = refl

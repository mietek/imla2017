module S4WithoutTerms where

open import Prelude public


--------------------------------------------------------------------------------
--
-- Syntax


-- Type variables
data TVar : Set where
  tvar : String â†’ TVar

injtvar : âˆ€ {sâ‚ sâ‚‚} â†’ tvar sâ‚ â‰¡ tvar sâ‚‚ â†’ sâ‚ â‰¡ sâ‚‚
injtvar refl = refl

_â‰Ÿâ‚œáµ¥_ : (xâ‚ xâ‚‚ : TVar) â†’ Dec (xâ‚ â‰¡ xâ‚‚)
tvar sâ‚ â‰Ÿâ‚œáµ¥ tvar sâ‚‚ = mapDec (tvar &_) injtvar (sâ‚ â‰Ÿâ‚› sâ‚‚)

instance
  tvarIsString : IsString TVar
  tvarIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ tvar s
      }


-- Types
infixl 9 _âˆ§_
infixr 7 _âŠƒ_
data Tp : Set where
  áµ—áµ›  : (x : TVar) â†’ Tp
  _âŠƒ_ : (A B : Tp) â†’ Tp
  _âˆ§_ : (A B : Tp) â†’ Tp
  ğ•‹   : Tp
  â–¡_  : (A : Tp) â†’ Tp

instance
  typeIsString : IsString Tp
  typeIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ áµ—áµ› (tvar s)
      }


-- Contexts
Cx : Set
Cx = ListÂ² Tp Tp


-- Syntactic entailment
infix 3 _âŠ¢_
data _âŠ¢_ : Cx â†’ Tp â†’ Set
  where
    áµáµ›  : âˆ€ {A Î” Î“} â†’ (i : Î” âˆ‹ A)
                    â†’ Î” â Î“ âŠ¢ A

    Ê³áµ›  : âˆ€ {A Î” Î“} â†’ (i : Î“ âˆ‹ A)
                    â†’ Î” â Î“ âŠ¢ A

    Æ›   : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ , A âŠ¢ B)
                      â†’ Î” â Î“ âŠ¢ A âŠƒ B

    _$_ : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âŠƒ B) (â„° : Î” â Î“ âŠ¢ A)
                      â†’ Î” â Î“ âŠ¢ B

    _,_ : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A) (â„° : Î” â Î“ âŠ¢ B)
                      â†’ Î” â Î“ âŠ¢ A âˆ§ B

    Ï€â‚  : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âˆ§ B)
                      â†’ Î” â Î“ âŠ¢ A

    Ï€â‚‚  : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âˆ§ B)
                      â†’ Î” â Î“ âŠ¢ B

    tt  : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢ ğ•‹

    âŒœ_âŒ : âˆ€ {A Î” Î“} â†’ (ğ’Ÿ : Î” â âˆ… âŠ¢ A)
                    â†’ Î” â Î“ âŠ¢ â–¡ A

    âŒ_âŒŸ : âˆ€ {A C Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ â–¡ A) (â„° : Î” , A â Î“ âŠ¢ C)
                      â†’ Î” â Î“ âŠ¢ C


-- Normal and neutral forms
mutual
  infix 3 _âŠ¢â‚™â‚˜_
  data _âŠ¢â‚™â‚˜_ : Cx â†’ Tp â†’ Set
    where
      Æ›   : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ , A âŠ¢â‚™â‚˜ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚˜ A âŠƒ B

      _,_ : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚˜ A) (â„° : Î” â Î“ âŠ¢â‚™â‚˜ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚˜ A âˆ§ B

      tt  : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‚™â‚˜ ğ•‹

      âŒœ_âŒ : âˆ€ {A Î” Î“} â†’ (ğ’Ÿ : Î” â âˆ… âŠ¢ A)
                      â†’ Î” â Î“ âŠ¢â‚™â‚˜ â–¡ A

      âŒ_âŒŸ : âˆ€ {A C Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ â–¡ A) (â„° : Î” , A â Î“ âŠ¢â‚™â‚˜ C)
                        â†’ Î” â Î“ âŠ¢â‚™â‚˜ C

      â¿áµ—  : âˆ€ {x Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ áµ—áµ› x)
                      â†’ Î” â Î“ âŠ¢â‚™â‚˜ áµ—áµ› x

  infix 3 _âŠ¢â‚™â‚œ_
  data _âŠ¢â‚™â‚œ_ : Cx â†’ Tp â†’ Set
    where
      áµáµ›  : âˆ€ {A Î” Î“} â†’ (i : Î” âˆ‹ A)
                      â†’ Î” â Î“ âŠ¢â‚™â‚œ A

      Ê³áµ›  : âˆ€ {A Î” Î“} â†’ (i : Î“ âˆ‹ A)
                      â†’ Î” â Î“ âŠ¢â‚™â‚œ A

      _$_ : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ A âŠƒ B) (â„° : Î” â Î“ âŠ¢â‚™â‚˜ A)
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ B

      Ï€â‚  : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ A âˆ§ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ A

      Ï€â‚‚  : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ A âˆ§ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ B


mutual
  embâ‚™â‚˜ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢â‚™â‚˜ A â†’ Î” â Î“ âŠ¢ A
  embâ‚™â‚˜ (Æ› ğ’Ÿ)     = Æ› (embâ‚™â‚˜ ğ’Ÿ)
  embâ‚™â‚˜ (ğ’Ÿ , â„°)   = embâ‚™â‚˜ ğ’Ÿ , embâ‚™â‚˜ â„°
  embâ‚™â‚˜ tt        = tt
  embâ‚™â‚˜ (âŒœ ğ’Ÿ âŒ)   = âŒœ ğ’Ÿ âŒ
  embâ‚™â‚˜ (âŒ ğ’Ÿ âŒŸ â„°) = âŒ embâ‚™â‚œ ğ’Ÿ âŒŸ (embâ‚™â‚˜ â„°)
  embâ‚™â‚˜ (â¿áµ— ğ’Ÿ)    = embâ‚™â‚œ ğ’Ÿ

  embâ‚™â‚œ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢â‚™â‚œ A â†’ Î” â Î“ âŠ¢ A
  embâ‚™â‚œ (áµáµ› i)  = áµáµ› i
  embâ‚™â‚œ (Ê³áµ› i)  = Ê³áµ› i
  embâ‚™â‚œ (ğ’Ÿ $ â„°) = embâ‚™â‚œ ğ’Ÿ $ embâ‚™â‚˜ â„°
  embâ‚™â‚œ (Ï€â‚ ğ’Ÿ)  = Ï€â‚ (embâ‚™â‚œ ğ’Ÿ)
  embâ‚™â‚œ (Ï€â‚‚ ğ’Ÿ)  = Ï€â‚‚ (embâ‚™â‚œ ğ’Ÿ)


--------------------------------------------------------------------------------
--
-- Renaming


mren : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢ A
                    â†’ Î”â€² â Î“ âŠ¢ A
mren Î· (áµáµ› i)    = áµáµ› (lookupáµ£ Î· i)
mren Î· (Ê³áµ› i)    = Ê³áµ› i
mren Î· (Æ› ğ’Ÿ)     = Æ› (mren Î· ğ’Ÿ)
mren Î· (ğ’Ÿ $ â„°)   = mren Î· ğ’Ÿ $ mren Î· â„°
mren Î· (ğ’Ÿ , â„°)   = mren Î· ğ’Ÿ , mren Î· â„°
mren Î· (Ï€â‚ ğ’Ÿ)    = Ï€â‚ (mren Î· ğ’Ÿ)
mren Î· (Ï€â‚‚ ğ’Ÿ)    = Ï€â‚‚ (mren Î· ğ’Ÿ)
mren Î· tt        = tt
mren Î· (âŒœ ğ’Ÿ âŒ)   = âŒœ mren Î· ğ’Ÿ âŒ
mren Î· (âŒ ğ’Ÿ âŒŸ â„°) = âŒ mren Î· ğ’Ÿ âŒŸ (mren (liftáµ£ Î·) â„°)

rren : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢ A
                    â†’ Î” â Î“â€² âŠ¢ A
rren Î· (áµáµ› i)    = áµáµ› i
rren Î· (Ê³áµ› i)    = Ê³áµ› (lookupáµ£ Î· i)
rren Î· (Æ› ğ’Ÿ)     = Æ› (rren (liftáµ£ Î·) ğ’Ÿ)
rren Î· (ğ’Ÿ $ â„°)   = rren Î· ğ’Ÿ $ rren Î· â„°
rren Î· (ğ’Ÿ , â„°)   = rren Î· ğ’Ÿ , rren Î· â„°
rren Î· (Ï€â‚ ğ’Ÿ)    = Ï€â‚ (rren Î· ğ’Ÿ)
rren Î· (Ï€â‚‚ ğ’Ÿ)    = Ï€â‚‚ (rren Î· ğ’Ÿ)
rren Î· tt        = tt
rren Î· (âŒœ ğ’Ÿ âŒ)   = âŒœ ğ’Ÿ âŒ
rren Î· (âŒ ğ’Ÿ âŒŸ â„°) = âŒ rren Î· ğ’Ÿ âŒŸ (rren Î· â„°)


mutual
  mrenâ‚™â‚˜ : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
                        â†’ Î”â€² â Î“ âŠ¢â‚™â‚˜ A
  mrenâ‚™â‚˜ Î· (Æ› ğ’Ÿ)     = Æ› (mrenâ‚™â‚˜ Î· ğ’Ÿ)
  mrenâ‚™â‚˜ Î· (ğ’Ÿ , â„°)   = mrenâ‚™â‚˜ Î· ğ’Ÿ , mrenâ‚™â‚˜ Î· â„°
  mrenâ‚™â‚˜ Î· tt        = tt
  mrenâ‚™â‚˜ Î· (âŒœ ğ’Ÿ âŒ)   = âŒœ mren Î· ğ’Ÿ âŒ
  mrenâ‚™â‚˜ Î· (âŒ ğ’Ÿ âŒŸ â„°) = âŒ mrenâ‚™â‚œ Î· ğ’Ÿ âŒŸ (mrenâ‚™â‚˜ (liftáµ£ Î·) â„°)
  mrenâ‚™â‚˜ Î· (â¿áµ— ğ’Ÿ)    = â¿áµ— (mrenâ‚™â‚œ Î· ğ’Ÿ)

  mrenâ‚™â‚œ : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                        â†’ Î”â€² â Î“ âŠ¢â‚™â‚œ A
  mrenâ‚™â‚œ Î· (áµáµ› i)  = áµáµ› (lookupáµ£ Î· i)
  mrenâ‚™â‚œ Î· (Ê³áµ› i ) = Ê³áµ› i
  mrenâ‚™â‚œ Î· (ğ’Ÿ $ â„°) = mrenâ‚™â‚œ Î· ğ’Ÿ $ mrenâ‚™â‚˜ Î· â„°
  mrenâ‚™â‚œ Î· (Ï€â‚ ğ’Ÿ)  = Ï€â‚ (mrenâ‚™â‚œ Î· ğ’Ÿ)
  mrenâ‚™â‚œ Î· (Ï€â‚‚ ğ’Ÿ)  = Ï€â‚‚ (mrenâ‚™â‚œ Î· ğ’Ÿ)


mutual
  rrenâ‚™â‚˜ : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
                        â†’ Î” â Î“â€² âŠ¢â‚™â‚˜ A
  rrenâ‚™â‚˜ Î· (Æ› ğ’Ÿ)     = Æ› (rrenâ‚™â‚˜ (liftáµ£ Î·) ğ’Ÿ)
  rrenâ‚™â‚˜ Î· (ğ’Ÿ , â„°)   = rrenâ‚™â‚˜ Î· ğ’Ÿ , rrenâ‚™â‚˜ Î· â„°
  rrenâ‚™â‚˜ Î· tt        = tt
  rrenâ‚™â‚˜ Î· (âŒœ ğ’Ÿ âŒ)   = âŒœ ğ’Ÿ âŒ
  rrenâ‚™â‚˜ Î· (âŒ ğ’Ÿ âŒŸ â„°) = âŒ rrenâ‚™â‚œ Î· ğ’Ÿ âŒŸ (rrenâ‚™â‚˜ Î· â„°)
  rrenâ‚™â‚˜ Î· (â¿áµ— ğ’Ÿ)    = â¿áµ— (rrenâ‚™â‚œ Î· ğ’Ÿ)

  rrenâ‚™â‚œ : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                        â†’ Î” â Î“â€² âŠ¢â‚™â‚œ A
  rrenâ‚™â‚œ Î· (áµáµ› i)  = áµáµ› i
  rrenâ‚™â‚œ Î· (Ê³áµ› i)  = Ê³áµ› (lookupáµ£ Î· i)
  rrenâ‚™â‚œ Î· (ğ’Ÿ $ â„°) = rrenâ‚™â‚œ Î· ğ’Ÿ $ rrenâ‚™â‚˜ Î· â„°
  rrenâ‚™â‚œ Î· (Ï€â‚ ğ’Ÿ)  = Ï€â‚ (rrenâ‚™â‚œ Î· ğ’Ÿ)
  rrenâ‚™â‚œ Î· (Ï€â‚‚ ğ’Ÿ)  = Ï€â‚‚ (rrenâ‚™â‚œ Î· ğ’Ÿ)


renâ‚™â‚˜ : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
                        â†’ Î”â€² â Î“â€² âŠ¢â‚™â‚˜ A
renâ‚™â‚˜ Î· ğ’Ÿ = (mrenâ‚™â‚˜ (projâ‚ Î·) âˆ˜ rrenâ‚™â‚˜ (projâ‚‚ Î·)) ğ’Ÿ

renâ‚™â‚œ : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                        â†’ Î”â€² â Î“â€² âŠ¢â‚™â‚œ A
renâ‚™â‚œ Î· ğ’Ÿ = (mrenâ‚™â‚œ (projâ‚ Î·) âˆ˜ rrenâ‚™â‚œ (projâ‚‚ Î·)) ğ’Ÿ


--------------------------------------------------------------------------------
--
-- Substitution


-- Simultaneous substitutions
infix 3 _âŠ¢â‹†_
_âŠ¢â‹†_ : Cx â†’ List Tp â†’ Set
Î” â Î“ âŠ¢â‹† Î = All (Î” â Î“ âŠ¢_) Î


mrenâ‹† : âˆ€ {Î” Î”â€² Î“ Î} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î”â€² â Î“ âŠ¢â‹† Î
mrenâ‹† Î· Ïƒ = mapAll (mren Î·) Ïƒ

rrenâ‹† : âˆ€ {Î” Î“ Î“â€² Î} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” â Î“â€² âŠ¢â‹† Î
rrenâ‹† Î· Ïƒ = mapAll (rren Î·) Ïƒ


mwkâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                   â†’ Î” , A â Î“ âŠ¢â‹† Î
mwkâ‚› Ïƒ = mrenâ‹† (wkáµ£ idáµ£) Ïƒ

rwkâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                   â†’ Î” â Î“ , A âŠ¢â‹† Î
rwkâ‚› Ïƒ = rrenâ‹† (wkáµ£ idáµ£) Ïƒ

mliftâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” , A â Î“ âŠ¢â‹† Î , A
mliftâ‚› Ïƒ = mwkâ‚› Ïƒ , áµáµ› zero

rliftâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” â Î“ , A âŠ¢â‹† Î , A
rliftâ‚› Ïƒ = rwkâ‚› Ïƒ , Ê³áµ› zero


midâ‚› : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‹† Î”
midâ‚› {âˆ…}     = âˆ…
midâ‚› {Î“ , A} = mliftâ‚› midâ‚›

ridâ‚› : âˆ€ {Î“ Î”} â†’ Î” â Î“ âŠ¢â‹† Î“
ridâ‚› {âˆ…}     = âˆ…
ridâ‚› {Î“ , A} = rliftâ‚› ridâ‚›


lookupâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î âˆ‹ A
                      â†’ Î” â Î“ âŠ¢ A
lookupâ‚› Ïƒ i = lookupAll Ïƒ i


-- Substitution
msub : âˆ€ {Î” Î“ Î A} â†’ Î” â âˆ… âŠ¢â‹† Î â†’ Î â Î“ âŠ¢ A
                   â†’ Î” â Î“ âŠ¢ A
msub Ïƒ (áµáµ› i)    = rren infáµ£ (lookupâ‚› Ïƒ i)
msub Ïƒ (Ê³áµ› i)    = Ê³áµ› i
msub Ïƒ (Æ› ğ’Ÿ)     = Æ› (msub Ïƒ ğ’Ÿ)
msub Ïƒ (ğ’Ÿ $ â„°)   = msub Ïƒ ğ’Ÿ $ msub Ïƒ â„°
msub Î· (ğ’Ÿ , â„°)   = msub Î· ğ’Ÿ , msub Î· â„°
msub Î· (Ï€â‚ ğ’Ÿ)    = Ï€â‚ (msub Î· ğ’Ÿ)
msub Î· (Ï€â‚‚ ğ’Ÿ)    = Ï€â‚‚ (msub Î· ğ’Ÿ)
msub Î· tt        = tt
msub Ïƒ âŒœ ğ’Ÿ âŒ     = âŒœ msub Ïƒ ğ’Ÿ âŒ
msub Ïƒ (âŒ ğ’Ÿ âŒŸ â„°) = âŒ msub Ïƒ ğ’Ÿ âŒŸ (msub (mliftâ‚› Ïƒ) â„°)

rsub : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î” â Î âŠ¢ A
                   â†’ Î” â Î“ âŠ¢ A
rsub Ïƒ (áµáµ› i)    = áµáµ› i
rsub Ïƒ (Ê³áµ› i)    = lookupâ‚› Ïƒ i
rsub Ïƒ (Æ› ğ’Ÿ)     = Æ› (rsub (rliftâ‚› Ïƒ) ğ’Ÿ)
rsub Ïƒ (ğ’Ÿ $ â„°)   = rsub Ïƒ ğ’Ÿ $ rsub Ïƒ â„°
rsub Î· (ğ’Ÿ , â„°)   = rsub Î· ğ’Ÿ , rsub Î· â„°
rsub Î· (Ï€â‚ ğ’Ÿ)    = Ï€â‚ (rsub Î· ğ’Ÿ)
rsub Î· (Ï€â‚‚ ğ’Ÿ)    = Ï€â‚‚ (rsub Î· ğ’Ÿ)
rsub Î· tt        = tt
rsub Ïƒ âŒœ ğ’Ÿ âŒ     = âŒœ ğ’Ÿ âŒ
rsub Ïƒ (âŒ ğ’Ÿ âŒŸ â„°) = âŒ rsub Ïƒ ğ’Ÿ âŒŸ (rsub (mwkâ‚› Ïƒ) â„°)


--------------------------------------------------------------------------------
--
-- Semantics


-- Introspective Kripke models
record ğ” : Setâ‚ where
  field
    ğ’²    : Set

    ğ’±    : ğ’² â†’ TVar â†’ Set

    _â‰¥_  : ğ’² â†’ ğ’² â†’ Set

    idâ‚  : âˆ€ {w} â†’ w â‰¥ w

    _âˆ˜â‚_ : âˆ€ {w wâ€² wâ€³} â†’ wâ€² â‰¥ w â†’ wâ€³ â‰¥ wâ€²
                       â†’ wâ€³ â‰¥ w

    accáµ¥ : âˆ€ {x w wâ€²} â†’ wâ€² â‰¥ w â†’ ğ’± w x
                      â†’ ğ’± wâ€² x

    âŒŠ_âŒ‹  : ğ’² â†’ Cx

    âŒŠ_âŒ‹â‚ : âˆ€ {w wâ€²} â†’ wâ€² â‰¥ w
                    â†’ âŒŠ wâ€² âŒ‹ âŠ‡Â² âŒŠ w âŒ‹

open ğ” {{â€¦}} public


áµâŒŠ_âŒ‹ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List Tp
áµâŒŠ w âŒ‹ = projâ‚ âŒŠ w âŒ‹

Ê³âŒŠ_âŒ‹ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List Tp
Ê³âŒŠ w âŒ‹ = projâ‚‚ âŒŠ w âŒ‹

áµâŒŠ_âŒ‹â‚ : âˆ€ {{ğ” : ğ”}} {w wâ€²} â†’ wâ€² â‰¥ w
                           â†’ áµâŒŠ wâ€² âŒ‹ âŠ‡ áµâŒŠ w âŒ‹
áµâŒŠ Î· âŒ‹â‚ = projâ‚ âŒŠ Î· âŒ‹â‚

Ê³âŒŠ_âŒ‹â‚ : âˆ€ {{ğ” : ğ”}} {w wâ€²} â†’ wâ€² â‰¥ w
                           â†’ Ê³âŒŠ wâ€² âŒ‹ âŠ‡ Ê³âŒŠ w âŒ‹
Ê³âŒŠ w âŒ‹â‚ = projâ‚‚ âŒŠ w âŒ‹â‚


-- Values
mutual
  infix 3 _âŠ©_
  _âŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ Tp â†’ Set

  w âŠ© áµ—áµ› x  = ğ’± w x

  w âŠ© A âŠƒ B = âˆ€ {wâ€²} â†’ (Î· : wâ€² â‰¥ w) (k : wâ€² áµâŠ© A)
                      â†’ wâ€² áµâŠ© B

  w âŠ© A âˆ§ B = w áµâŠ© A Ã— w áµâŠ© B

  w âŠ© ğ•‹     = âŠ¤

  w âŠ© â–¡ A   = âˆ€ {wâ€²} â†’ (Î· : wâ€² â‰¥ w)
                      â†’ wâ€² áµáµâŠ© A

  infix 3 _áµâŠ©_
  _áµâŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ Tp â†’ Set
  w áµâŠ© A = âˆ€ {wâ€² C} â†’ (Î· : wâ€² â‰¥ w) (f : âˆ€ {wâ€³} â†’ wâ€³ â‰¥ wâ€² â†’ wâ€³ âŠ© A
                                                 â†’ âŒŠ wâ€³ âŒ‹ âŠ¢â‚™â‚˜ C)
                     â†’ âŒŠ wâ€² âŒ‹ âŠ¢â‚™â‚˜ C

  infix 3 _áµáµâŠ©_
  _áµáµâŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ Tp â†’ Set
  w áµáµâŠ© A = áµâŒŠ w âŒ‹ â âˆ… âŠ¢ A Ã— w áµâŠ© A


syn : âˆ€ {{ğ” : ğ”}} {w A} â†’ w áµáµâŠ© A
                        â†’ áµâŒŠ w âŒ‹ â âˆ… âŠ¢ A
syn ğ’Ÿk = projâ‚ ğ’Ÿk

sem : âˆ€ {{ğ” : ğ”}} {w A} â†’ w áµáµâŠ© A
                        â†’ w áµâŠ© A
sem ğ’Ÿk = projâ‚‚ ğ’Ÿk


-- Environments
infix 3 _áµâŠ©â‹†_
_áµâŠ©â‹†_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List Tp â†’ Set
w áµâŠ©â‹† Î = All (w áµâŠ©_) Î

infix 3 _áµáµâŠ©â‹†_
_áµáµâŠ©â‹†_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List Tp â†’ Set
w áµáµâŠ©â‹† Î = All (w áµáµâŠ©_) Î


synâ‹† : âˆ€ {{ğ” : ğ”}} {w Î} â†’ w áµáµâŠ©â‹† Î
                         â†’ áµâŒŠ w âŒ‹ â âˆ… âŠ¢â‹† Î
synâ‹† mÏ = mapAll syn mÏ

semâ‹† : âˆ€ {{ğ” : ğ”}} {w Î} â†’ w áµáµâŠ©â‹† Î
                         â†’ w áµâŠ©â‹† Î
semâ‹† mÏ = mapAll sem mÏ


-- Semantic entailment
infix 3 _âŠ¨_
_âŠ¨_ : Cx â†’ Tp â†’ Setâ‚
Î” â Î“ âŠ¨ A = âˆ€ {{ğ” : ğ”}} {w} â†’ w áµáµâŠ©â‹† Î” â†’ w áµâŠ©â‹† Î“
                             â†’ w áµâŠ© A


-- Accessibility
mutual
  acc : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w âŠ© A
                             â†’ wâ€² âŠ© A
  acc {áµ—áµ› x}  Î· ğ’Ÿ = accáµ¥ Î· ğ’Ÿ
  acc {A âŠƒ B} Î· f = Î» Î·â€² â†’ f (Î· âˆ˜â‚ Î·â€²)
  acc {A âˆ§ B} Î· p = kacc {A} Î· (projâ‚ p) , kacc {B} Î· (projâ‚‚ p)
  acc {ğ•‹}     Î· t = tt
  acc {â–¡ A}   Î· f = Î» Î·â€² â†’ f (Î· âˆ˜â‚ Î·â€²)

  kacc : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâŠ© A
                              â†’ wâ€² áµâŠ© A
  kacc Î· k = Î» Î·â€² f â†’ k (Î· âˆ˜â‚ Î·â€²) f

mkacc : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµáµâŠ© A
                             â†’ wâ€² áµáµâŠ© A
mkacc {A} Î· (ğ’Ÿ , k) = mren áµâŒŠ Î· âŒ‹â‚ ğ’Ÿ , kacc {A} Î· k


kaccâ‹† : âˆ€ {{ğ” : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâŠ©â‹† Î
                             â†’ wâ€² áµâŠ©â‹† Î
-- TODO: Why does Agda require me to add seemingly unused annotations here?
-- kaccâ‹† Î· rÏ = mapAll (kacc Î·) rÏ
kaccâ‹† Î· rÏ = mapAll (Î» {A} k {_} {_} â†’ kacc {A} Î· (k {_})) rÏ

mkaccâ‹† : âˆ€ {{ğ” : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµáµâŠ©â‹† Î
                              â†’ wâ€² áµáµâŠ©â‹† Î
mkaccâ‹† Î· mÏ = mapAll (mkacc Î·) mÏ


-- Kripke continuation monad
return : âˆ€ {{ğ” : ğ”}} {A w} â†’ w âŠ© A
                           â†’ w áµâŠ© A
return {A} a = Î» Î· f â†’
                 f idâ‚ (acc {A} Î· a)

bind : âˆ€ {{ğ” : ğ”}} {A C w} â†’ w áµâŠ© A â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² âŠ© A
                                                 â†’ wâ€² áµâŠ© C)
                           â†’ w áµâŠ© C
bind k f = Î» Î· fâ€² â†’
             k Î· (Î» Î·â€² a â†’
               f (Î· âˆ˜â‚ Î·â€²) a idâ‚ (Î» Î·â€³ b â†’
                 fâ€² (Î·â€² âˆ˜â‚ Î·â€³) b))


klookupâ‚‘ : âˆ€ {{ğ” : ğ”}} {Î A w} â†’ w áµâŠ©â‹† Î â†’ Î âˆ‹ A
                               â†’ w áµâŠ© A
klookupâ‚‘ rÏ i = lookupAll rÏ i


kÆ› : âˆ€ {{ğ” : ğ”}} {A B w} â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² áµâŠ© A
                                    â†’ wâ€² áµâŠ© B)
                         â†’ w áµâŠ© A âŠƒ B
kÆ› {A} {B} f = return {A âŠƒ B} (Î» Î· k â†’ f Î· k)

k$ : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A âŠƒ B â†’ w áµâŠ© A
                         â†’ w áµâŠ© B
k$ {A} {B} kâ‚ kâ‚‚ = bind {A âŠƒ B} {B} kâ‚ (Î» Î· f â†’ f idâ‚ (kacc {A} Î· kâ‚‚))

k, : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A â†’ w áµâŠ© B
                         â†’ w áµâŠ© A âˆ§ B
k, {A} {B} kâ‚ kâ‚‚ = return {A âˆ§ B} (kâ‚ , kâ‚‚)

kÏ€â‚ : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A âˆ§ B
                          â†’ w áµâŠ© A
kÏ€â‚ {A} {B} k = bind {A âˆ§ B} {A} k (Î» Î· p â†’ projâ‚ p)

kÏ€â‚‚ : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A âˆ§ B
                          â†’ w áµâŠ© B
kÏ€â‚‚ {A} {B} k = bind {A âˆ§ B} {B} k (Î» Î· p â†’ projâ‚‚ p)

ktt : âˆ€ {{ğ” : ğ”}} {w} â†’ w áµâŠ© ğ•‹
ktt = return {ğ•‹} tt

kâŒœâŒ : âˆ€ {{ğ” : ğ”}} {A w} â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w
                                   â†’ wâ€² áµáµâŠ© A)
                        â†’ w áµâŠ© â–¡ A
kâŒœâŒ {A} f = return {â–¡ A} (Î» Î· â†’ f Î·)

kâŒâŒŸ : âˆ€ {{ğ” : ğ”}} {A C w} â†’ w áµâŠ© â–¡ A
                          â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² áµáµâŠ© A
                                     â†’ wâ€² áµâŠ© C)
                          â†’ w áµâŠ© C
kâŒâŒŸ {A} {C} k f = bind {â–¡ A} {C} k (Î» Î· fâ€² â†’ f Î· (fâ€² idâ‚))


-- Soundness
-- â†“ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
--               â†’ Î” â Î“ âŠ¨ A
-- â†“ (áµáµ› i)            mÏ rÏ = klookupâ‚‘ (semâ‹† mÏ) i
-- â†“ (Ê³áµ› i)            mÏ rÏ = klookupâ‚‘ rÏ i
-- â†“ (Æ› {A} {B} ğ’Ÿ)     mÏ rÏ = kÆ› {A} {B} (Î» Î· k â†’
--                               â†“ ğ’Ÿ (mkaccâ‹† Î· mÏ) (kaccâ‹† Î· rÏ , k))
-- â†“ (_$_ {A} {B} ğ’Ÿ â„°) mÏ rÏ = k$ {A} {B} (â†“ ğ’Ÿ mÏ rÏ) (â†“ â„° mÏ rÏ)
-- â†“ (_,_ {A} {B} ğ’Ÿ â„°) mÏ rÏ = k, {A} {B} (â†“ ğ’Ÿ mÏ rÏ) (â†“ â„° mÏ rÏ)
-- â†“ (Ï€â‚ {A} {B} ğ’Ÿ)    mÏ rÏ = kÏ€â‚ {A} {B} (â†“ ğ’Ÿ mÏ rÏ)
-- â†“ (Ï€â‚‚ {A} {B} ğ’Ÿ)    mÏ rÏ = kÏ€â‚‚ {A} {B} (â†“ ğ’Ÿ mÏ rÏ)
-- â†“ tt                mÏ rÏ = ktt
-- â†“ (âŒœ_âŒ {A} ğ’Ÿ)       mÏ rÏ = kâŒœâŒ {A} (Î» Î· â†’
--                               msub (synâ‹† (mkaccâ‹† Î· mÏ)) ğ’Ÿ , â†“ ğ’Ÿ (mkaccâ‹† Î· mÏ) âˆ…)
-- â†“ (âŒ_âŒŸ {A} {C} ğ’Ÿ â„°) mÏ rÏ = kâŒâŒŸ {A} {C} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· ğ’Ÿk â†’
--                               â†“ â„° (mkaccâ‹† Î· mÏ , ğ’Ÿk) (kaccâ‹† Î· rÏ))


-- Soundness, inlined
â†“ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
              â†’ Î” â Î“ âŠ¨ A
â†“ (áµáµ› i)            mÏ rÏ = klookupâ‚‘ (semâ‹† mÏ) i
â†“ (Ê³áµ› i)            mÏ rÏ = klookupâ‚‘ rÏ i
â†“ (Æ› {A} {B} ğ’Ÿ)     mÏ rÏ = return {A âŠƒ B} (Î» Î· k â†’
                              â†“ ğ’Ÿ (mkaccâ‹† Î· mÏ) (kaccâ‹† Î· rÏ , k))
â†“ (_$_ {A} {B} ğ’Ÿ â„°) mÏ rÏ = bind {A âŠƒ B} {B} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· f â†’
                              f idâ‚ (â†“ â„° (mkaccâ‹† Î· mÏ) (kaccâ‹† Î· rÏ)))
â†“ (_,_ {A} {B} ğ’Ÿ â„°) mÏ rÏ = return {A âˆ§ B} (â†“ ğ’Ÿ mÏ rÏ , â†“ â„° mÏ rÏ)
â†“ (Ï€â‚ {A} {B} ğ’Ÿ)    mÏ rÏ = bind {A âˆ§ B} {A} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· p â†’ projâ‚ p)
â†“ (Ï€â‚‚ {A} {B} ğ’Ÿ)    mÏ rÏ = bind {A âˆ§ B} {B} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· p â†’ projâ‚‚ p)
â†“ tt                mÏ rÏ = return {ğ•‹} tt
â†“ (âŒœ_âŒ {A} ğ’Ÿ)       mÏ rÏ = return {â–¡ A} (Î» Î· â†’
                              msub (synâ‹† (mkaccâ‹† Î· mÏ)) ğ’Ÿ , â†“ ğ’Ÿ (mkaccâ‹† Î· mÏ) âˆ…)
â†“ (âŒ_âŒŸ {A} {C} ğ’Ÿ â„°) mÏ rÏ = bind {â–¡ A} {C} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· f â†’
                              â†“ â„° (mkaccâ‹† Î· mÏ , f idâ‚) (kaccâ‹† Î· rÏ))


--------------------------------------------------------------------------------
--
-- Completeness


-- Universal model
instance
  ğ”áµ¤ : ğ”
  ğ”áµ¤ = record
         { ğ’²    = Cx
         ; ğ’±    = Î» { (Î” â Î“) x â†’ Î” â Î“ âŠ¢â‚™â‚˜ áµ—áµ› x }
         ; _â‰¥_  = _âŠ‡Â²_
         ; idâ‚  = idáµ£Â²
         ; _âˆ˜â‚_ = _âˆ˜áµ£Â²_
         ; accáµ¥ = renâ‚™â‚˜
         ; âŒŠ_âŒ‹  = id
         ; âŒŠ_âŒ‹â‚ = id
         }


-- Soundness and completeness with respect to the universal model
mutual
  â†‘áµ¤ : âˆ€ {A Î” Î“} â†’ Î” â Î“ áµâŠ© A
                 â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
  â†‘áµ¤ {áµ—áµ› x}  k = k idáµ£Â² (Î» Î· ğ’Ÿ â†’ ğ’Ÿ)
  â†‘áµ¤ {A âŠƒ B} k = k idáµ£Â² (Î» Î· f â†’ Æ› (â†‘áµ¤ (f (rwkáµ£ idáµ£Â²) (â†“áµ¤ (Ê³áµ› zero)))))
  â†‘áµ¤ {A âˆ§ B} k = k idáµ£Â² (Î» Î· p â†’ â†‘áµ¤ (projâ‚ p) , â†‘áµ¤ (projâ‚‚ p))
  â†‘áµ¤ {ğ•‹}     k = k idáµ£Â² (Î» Î· t â†’ tt)
  â†‘áµ¤ {â–¡ A}   k = k idáµ£Â² (Î» Î· f â†’ âŒœ syn (f idáµ£Â²) âŒ)

  â†“áµ¤ : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                 â†’ Î” â Î“ áµâŠ© A
  â†“áµ¤ {áµ—áµ› x}  ğ’Ÿ = return {áµ—áµ› x} (â¿áµ— ğ’Ÿ)
  â†“áµ¤ {A âŠƒ B} ğ’Ÿ = return {A âŠƒ B} (Î» Î· k â†’ â†“áµ¤ (renâ‚™â‚œ Î· ğ’Ÿ $ â†‘áµ¤ k))
  â†“áµ¤ {A âˆ§ B} ğ’Ÿ = return {A âˆ§ B} (â†“áµ¤ (Ï€â‚ ğ’Ÿ) , â†“áµ¤ (Ï€â‚‚ ğ’Ÿ))
  â†“áµ¤ {ğ•‹}     ğ’Ÿ = return {ğ•‹} tt
  â†“áµ¤ {â–¡ A}   ğ’Ÿ = Î» Î· f â†’ âŒ renâ‚™â‚œ Î· ğ’Ÿ âŒŸ (f (mwkáµ£ idáµ£Â²) (Î» Î·â€² â†’
                   áµáµ› (mlookupáµ£ Î·â€² zero) , â†“áµ¤ (áµáµ› (mlookupáµ£ Î·â€² zero))))


mkidâ‚‘ : âˆ€ {Î” Î“} â†’ Î” â Î“ áµáµâŠ©â‹† Î”
mkidâ‚‘ {âˆ…}     = âˆ…
mkidâ‚‘ {Î” , A} = mkaccâ‹† (mwkáµ£ idáµ£Â²) mkidâ‚‘ , (áµáµ› zero , â†“áµ¤ (áµáµ› zero))

kidâ‚‘ : âˆ€ {Î“ Î”} â†’ Î” â Î“ áµâŠ©â‹† Î“
kidâ‚‘ {âˆ…}     = âˆ…
kidâ‚‘ {Î“ , A} = kaccâ‹† (rwkáµ£ idáµ£Â²) kidâ‚‘ , â†“áµ¤ (Ê³áµ› zero)


-- Completeness
â†‘ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¨ A
              â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
â†‘ f = â†‘áµ¤ (f mkidâ‚‘ kidâ‚‘)


-- Normalisation
nm : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
               â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
nm = â†‘ âˆ˜ â†“


--------------------------------------------------------------------------------
--
-- Examples


áµáµ›0 : âˆ€ {Î” Î“ A} â†’ Î” , A â Î“ âŠ¢ A
áµáµ›0 = áµáµ› zero

áµáµ›1 : âˆ€ {Î” Î“ A B} â†’ Î” , A , B â Î“ âŠ¢ A
áµáµ›1 = áµáµ› (suc zero)

áµáµ›2 : âˆ€ {Î” Î“ A B C} â†’ Î” , A , B , C â Î“ âŠ¢ A
áµáµ›2 = áµáµ› (suc (suc zero))


Ê³áµ›0 : âˆ€ {Î” Î“ A} â†’ Î” â Î“ , A âŠ¢ A
Ê³áµ›0 = Ê³áµ› zero

Ê³áµ›1 : âˆ€ {Î” Î“ A B} â†’ Î” â Î“ , A , B âŠ¢ A
Ê³áµ›1 = Ê³áµ› (suc zero)

Ê³áµ›2 : âˆ€ {Î” Î“ A B C} â†’ Î” â Î“ , A , B , C âŠ¢ A
Ê³áµ›2 = Ê³áµ› (suc (suc zero))


axI : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢ A âŠƒ A
axI = Æ› Ê³áµ›0

axK : âˆ€ {A B Î” Î“} â†’ Î” â Î“ âŠ¢ A âŠƒ B âŠƒ A
axK = Æ› (Æ› Ê³áµ›1)

axS : âˆ€ {A B C Î” Î“} â†’ Î” â Î“ âŠ¢ (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
axS = Æ› (Æ› (Æ› ((Ê³áµ›2 $ Ê³áµ›0) $ (Ê³áµ›1 $ Ê³áµ›0))))


axD : âˆ€ {A B Î” Î“} â†’ Î” â Î“ âŠ¢ â–¡ (A âŠƒ B) âŠƒ â–¡ A âŠƒ â–¡ B
axD = Æ› (Æ› (âŒ Ê³áµ›1 âŒŸ (âŒ Ê³áµ›0 âŒŸ âŒœ áµáµ›1 $ áµáµ›0 âŒ)))

axT : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢ â–¡ A âŠƒ A
axT = Æ› (âŒ Ê³áµ›0 âŒŸ áµáµ›0)

ax4 : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢ â–¡ A âŠƒ â–¡ â–¡ A
ax4 = Æ› (âŒ Ê³áµ›0 âŒŸ âŒœ âŒœ áµáµ›0 âŒ âŒ)


--------------------------------------------------------------------------------
--
-- Conversion tests


testâˆ¼ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A â†’ Î” â Î“ âŠ¢ A â†’ Set
testâˆ¼ ğ’Ÿâ‚ ğ’Ÿâ‚‚ = embâ‚™â‚˜ (nm ğ’Ÿâ‚) â‰¡ ğ’Ÿâ‚‚


-- redâŠƒ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ , A âŠ¢ B) (â„° : Î” â Î“ âŠ¢ A)
--                    â†’ Æ› ğ’Ÿ $ â„° âˆ¼ rsub (ridâ‚› , â„°) ğ’Ÿ

testâˆ¼redâŠƒ : testâˆ¼ {âˆ…} {âˆ… , "A"}
                  ((Æ› Ê³áµ›0) $ Ê³áµ›0)
                  Ê³áµ›0
testâˆ¼redâŠƒ = refl


-- redâˆ§â‚ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A) (â„° : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚ (ğ’Ÿ , â„°) âˆ¼ ğ’Ÿ

testâˆ¼redâˆ§â‚ : testâˆ¼ {âˆ…} {âˆ… , "A" , "B"}
                   (Ï€â‚ (Ê³áµ›1 , Ê³áµ›0))
                   Ê³áµ›1
testâˆ¼redâˆ§â‚ = refl


-- redâˆ§â‚‚ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A) (â„° : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚‚ (ğ’Ÿ , â„°) âˆ¼ â„°

testâˆ¼redâˆ§â‚‚ : testâˆ¼ {âˆ…} {âˆ… , "A" , "B"}
                   (Ï€â‚‚ (Ê³áµ›1 , Ê³áµ›0))
                   Ê³áµ›0
testâˆ¼redâˆ§â‚‚ = refl


-- redâ–¡ : âˆ€ {Î” Î“ A C} â†’ (ğ’Ÿ : Î” â âˆ… âŠ¢ A) (â„° : Î” , A â Î“ âŠ¢ C)
--                    â†’ âŒ âŒœ ğ’Ÿ âŒ âŒŸ â„° âˆ¼ msub (midâ‚› , ğ’Ÿ) â„°

testâˆ¼redâ–¡ : testâˆ¼ {âˆ… , "A"} {âˆ…}
                  (âŒ âŒœ áµáµ›0 âŒ âŒŸ áµáµ›0)
                  áµáµ›0
testâˆ¼redâ–¡ = refl


-- expâŠƒ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âŠƒ B)
--                    â†’ ğ’Ÿ âˆ¼ Æ› (rren (wkáµ£ idáµ£) ğ’Ÿ $ Ê³áµ›0)

testâˆ¼expâŠƒ : testâˆ¼ {âˆ…} {âˆ… , "A" âŠƒ "B"}
                  Ê³áµ›0
                  (Æ› (rren (wkáµ£ idáµ£) Ê³áµ›0 $ Ê³áµ›0))
testâˆ¼expâŠƒ = refl


-- expâˆ§ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âˆ§ B)
--                    â†’ ğ’Ÿ âˆ¼ Ï€â‚ ğ’Ÿ , Ï€â‚‚ ğ’Ÿ

testâˆ¼expâˆ§ : testâˆ¼ {âˆ…} {âˆ… , "A" âˆ§ "B"}
                  Ê³áµ›0
                  (Ï€â‚ Ê³áµ›0 , Ï€â‚‚ Ê³áµ›0)
testâˆ¼expâˆ§ = refl


-- expğ•‹ : âˆ€ {Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ ğ•‹)
--                â†’ ğ’Ÿ âˆ¼ tt

testâˆ¼expğ•‹ : testâˆ¼ {âˆ…} {âˆ… , ğ•‹}
                  Ê³áµ›0
                  tt
testâˆ¼expğ•‹ = refl


-- expâ–¡ : âˆ€ {Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ â–¡ A)
--                â†’ ğ’Ÿ âˆ¼ âŒ ğ’Ÿ âŒŸ âŒœ áµáµ›0 âŒ

testâˆ¼expâ–¡ : testâˆ¼ {âˆ…} {âˆ… , â–¡ "A"}
                  Ê³áµ›0
                  (âŒ Ê³áµ›0 âŒŸ âŒœ áµáµ›0 âŒ)
testâˆ¼expâ–¡ = refl


-- commâ–¡$ : âˆ€ {Î” Î“ A B} â†’ (Q : Î” â Î“ âŠ¢ â–¡ (A âŠƒ B))
--                         (ğ’Ÿ : Î” , A âŠƒ B â Î“ âŠ¢ A âŠƒ B) (â„° : Î” â Î“ âŠ¢ A)
--                      â†’ (âŒ Q âŒŸ ğ’Ÿ) $ â„° âˆ¼ âŒ Q âŒŸ (ğ’Ÿ $ (mren (wkáµ£ idáµ£) â„°))

testâˆ¼commâ–¡$ : testâˆ¼ {âˆ…} {âˆ… , â–¡ ("A" âŠƒ "B") , "A"}
                    ((âŒ Ê³áµ›1 âŒŸ áµáµ›0) $ Ê³áµ›0)
                    (âŒ Ê³áµ›1 âŒŸ (áµáµ›0 $ mren (wkáµ£ idáµ£) Ê³áµ›0))
testâˆ¼commâ–¡$ = refl


-- commâ–¡âŒâŒŸ : âˆ€ {Î” Î“ A C} â†’ (Q : Î” â Î“ âŠ¢ â–¡ â–¡ A)
--                          (ğ’Ÿ : Î” , â–¡ A â Î“ âŠ¢ â–¡ A) (â„° : Î” , A â Î“ âŠ¢ C)
--                       â†’ âŒ (âŒ Q âŒŸ ğ’Ÿ) âŒŸ â„° âˆ¼ âŒ Q âŒŸ (âŒ ğ’Ÿ âŒŸ (mren (wkáµ£ idáµ£) â„°))

testâˆ¼commâ–¡âŒâŒŸ : testâˆ¼ {âˆ…} {âˆ… , â–¡ â–¡ "A"}
                     (âŒ âŒ Ê³áµ›0 âŒŸ áµáµ›0 âŒŸ áµáµ›0)
                     (âŒ Ê³áµ›0 âŒŸ (âŒ áµáµ›0 âŒŸ áµáµ›0))
testâˆ¼commâ–¡âŒâŒŸ = refl


-- commâ–¡Ï€â‚ : âˆ€ {Î” Î“ A B} â†’ (Q : Î” â Î“ âŠ¢ â–¡ (A âˆ§ B))
--                          (ğ’Ÿ : Î” , A âˆ§ B â Î“ âŠ¢ A âˆ§ B)
--                       â†’ Ï€â‚ (âŒ Q âŒŸ ğ’Ÿ) âˆ¼ âŒ Q âŒŸ (Ï€â‚ ğ’Ÿ)

testâˆ¼commâ–¡Ï€â‚ : testâˆ¼ {âˆ…} {âˆ… , â–¡ ("A" âˆ§ "B")}
                     (Ï€â‚ (âŒ Ê³áµ›0 âŒŸ áµáµ›0))
                     (âŒ Ê³áµ›0 âŒŸ (Ï€â‚ áµáµ›0))
testâˆ¼commâ–¡Ï€â‚ = refl


-- commâ–¡Ï€â‚‚ : âˆ€ {Î” Î“ A B} â†’ (Q : Î” â Î“ âŠ¢ â–¡ (A âˆ§ B))
--                          (ğ’Ÿ : Î” , A âˆ§ B â Î“ âŠ¢ A âˆ§ B)
--                       â†’ Ï€â‚‚ (âŒ Q âŒŸ ğ’Ÿ) âˆ¼ âŒ Q âŒŸ (Ï€â‚‚ ğ’Ÿ)

testâˆ¼commâ–¡Ï€â‚‚ : testâˆ¼ {âˆ…} {âˆ… , â–¡ ("A" âˆ§ "B")}
                     (Ï€â‚‚ (âŒ Ê³áµ›0 âŒŸ áµáµ›0))
                     (âŒ Ê³áµ›0 âŒŸ (Ï€â‚‚ áµáµ›0))
testâˆ¼commâ–¡Ï€â‚‚ = refl


--------------------------------------------------------------------------------
--
-- Self-interpretation


-- weakBP : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A)
--                      â†’ ğ•‹ $ âŒœ ğ’Ÿ âŒ âˆ¼ âŒœ ğ’Ÿ âŒ

testâˆ¼weakBP : testâˆ¼ {âˆ… , "A"} {âˆ…}
                    (axT $ âŒœ áµáµ›0 âŒ)
                    áµáµ›0
testâˆ¼weakBP = refl


-- Andrej : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âŠƒ B) (â„° : Î” â Î“ âŠ¢ A)
--                      â†’ (ğ”» $ âŒœ ğ’Ÿ âŒ) $ âŒœ â„° âŒ âˆ¼ âŒœ ğ’Ÿ $ â„° âŒ

testâˆ¼Andrej : testâˆ¼ {âˆ… , "A" âŠƒ "B" , "A"} {âˆ…}
                    ((axD $ âŒœ áµáµ›1 âŒ) $ âŒœ áµáµ›0 âŒ)
                    (âŒœ áµáµ›1 $ áµáµ›0 âŒ)
testâˆ¼Andrej = refl


--------------------------------------------------------------------------------

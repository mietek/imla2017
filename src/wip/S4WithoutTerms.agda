module S4WithoutTerms where

open import Prelude public


--------------------------------------------------------------------------------
--
-- Syntax


-- Type variables
data TVar : Set where
  tvar : String â†’ TVar

injtvar : âˆ€ {sâ‚ sâ‚‚} â†’ tvar sâ‚ â‰¡ tvar sâ‚‚ â†’ sâ‚ â‰¡ sâ‚‚
injtvar refl = refl

_â‰Ÿâ‚œáµ¥_ : (xâ‚ xâ‚‚ : TVar) â†’ Dec (xâ‚ â‰¡ xâ‚‚)
tvar sâ‚ â‰Ÿâ‚œáµ¥ tvar sâ‚‚ = mapDec (tvar &_) injtvar (sâ‚ â‰Ÿâ‚› sâ‚‚)

instance
  tvarIsString : IsString TVar
  tvarIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ tvar s
      }


-- Types
infixl 9 _âˆ§_
infixr 7 _âŠƒ_
data ğ’¯ : Set where
  áµ—áµ›  : (x : TVar) â†’ ğ’¯
  _âŠƒ_ : (A B : ğ’¯) â†’ ğ’¯
  _âˆ§_ : (A B : ğ’¯) â†’ ğ’¯
  ğ•‹   : ğ’¯
  â–¡_  : (A : ğ’¯) â†’ ğ’¯

instance
  typeIsString : IsString ğ’¯
  typeIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ áµ—áµ› (tvar s)
      }


-- Contexts
ğ’ : Set
ğ’ = ListÂ² ğ’¯ ğ’¯


-- Syntactic entailment
infix 3 _âŠ¢_
data _âŠ¢_ : ğ’ â†’ ğ’¯ â†’ Set
  where
    áµáµ›  : âˆ€ {A Î” Î“} â†’ (i : Î” âˆ‹ A)
                    â†’ Î” â Î“ âŠ¢ A

    Ê³áµ›  : âˆ€ {A Î” Î“} â†’ (i : Î“ âˆ‹ A)
                    â†’ Î” â Î“ âŠ¢ A

    Æ›   : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ , A âŠ¢ B)
                      â†’ Î” â Î“ âŠ¢ A âŠƒ B

    _$_ : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢ A âŠƒ B) (N : Î” â Î“ âŠ¢ A)
                      â†’ Î” â Î“ âŠ¢ B

    _,_ : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢ A) (N : Î” â Î“ âŠ¢ B)
                      â†’ Î” â Î“ âŠ¢ A âˆ§ B

    Ï€â‚  : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢ A âˆ§ B)
                      â†’ Î” â Î“ âŠ¢ A

    Ï€â‚‚  : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢ A âˆ§ B)
                      â†’ Î” â Î“ âŠ¢ B

    tt  : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢ ğ•‹

    âŒœ_âŒ : âˆ€ {A Î” Î“} â†’ (M : Î” â âˆ… âŠ¢ A)
                    â†’ Î” â Î“ âŠ¢ â–¡ A

    âŒ_âŒŸ : âˆ€ {A C Î” Î“} â†’ (M : Î” â Î“ âŠ¢ â–¡ A) (N : Î” , A â Î“ âŠ¢ C)
                      â†’ Î” â Î“ âŠ¢ C


-- Normal and neutral forms
mutual
  infix 3 _âŠ¢â‚™â‚˜_
  data _âŠ¢â‚™â‚˜_ : ğ’ â†’ ğ’¯ â†’ Set
    where
      Æ›   : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ , A âŠ¢â‚™â‚˜ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚˜ A âŠƒ B

      _,_ : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢â‚™â‚˜ A) (N : Î” â Î“ âŠ¢â‚™â‚˜ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚˜ A âˆ§ B

      tt  : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‚™â‚˜ ğ•‹

      âŒœ_âŒ : âˆ€ {A Î” Î“} â†’ (M : Î” â âˆ… âŠ¢ A)
                      â†’ Î” â Î“ âŠ¢â‚™â‚˜ â–¡ A

      âŒ_âŒŸ : âˆ€ {A C Î” Î“} â†’ (M : Î” â Î“ âŠ¢â‚™â‚œ â–¡ A) (N : Î” , A â Î“ âŠ¢â‚™â‚˜ C)
                        â†’ Î” â Î“ âŠ¢â‚™â‚˜ C

      â¿áµ—  : âˆ€ {x Î” Î“} â†’ (M : Î” â Î“ âŠ¢â‚™â‚œ áµ—áµ› x)
                      â†’ Î” â Î“ âŠ¢â‚™â‚˜ áµ—áµ› x

  infix 3 _âŠ¢â‚™â‚œ_
  data _âŠ¢â‚™â‚œ_ : ğ’ â†’ ğ’¯ â†’ Set
    where
      áµáµ›  : âˆ€ {A Î” Î“} â†’ (i : Î” âˆ‹ A)
                      â†’ Î” â Î“ âŠ¢â‚™â‚œ A

      Ê³áµ›  : âˆ€ {A Î” Î“} â†’ (i : Î“ âˆ‹ A)
                      â†’ Î” â Î“ âŠ¢â‚™â‚œ A

      _$_ : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢â‚™â‚œ A âŠƒ B) (N : Î” â Î“ âŠ¢â‚™â‚˜ A)
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ B

      Ï€â‚  : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢â‚™â‚œ A âˆ§ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ A

      Ï€â‚‚  : âˆ€ {A B Î” Î“} â†’ (M : Î” â Î“ âŠ¢â‚™â‚œ A âˆ§ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ B


mutual
  embâ‚™â‚˜ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢â‚™â‚˜ A â†’ Î” â Î“ âŠ¢ A
  embâ‚™â‚˜ (Æ› M)     = Æ› (embâ‚™â‚˜ M)
  embâ‚™â‚˜ (M , N)   = embâ‚™â‚˜ M , embâ‚™â‚˜ N
  embâ‚™â‚˜ tt        = tt
  embâ‚™â‚˜ (âŒœ M âŒ)   = âŒœ M âŒ
  embâ‚™â‚˜ (âŒ M âŒŸ N) = âŒ embâ‚™â‚œ M âŒŸ (embâ‚™â‚˜ N)
  embâ‚™â‚˜ (â¿áµ— M)    = embâ‚™â‚œ M

  embâ‚™â‚œ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢â‚™â‚œ A â†’ Î” â Î“ âŠ¢ A
  embâ‚™â‚œ (áµáµ› i)  = áµáµ› i
  embâ‚™â‚œ (Ê³áµ› i)  = Ê³áµ› i
  embâ‚™â‚œ (M $ N) = embâ‚™â‚œ M $ embâ‚™â‚˜ N
  embâ‚™â‚œ (Ï€â‚ M)  = Ï€â‚ (embâ‚™â‚œ M)
  embâ‚™â‚œ (Ï€â‚‚ M)  = Ï€â‚‚ (embâ‚™â‚œ M)


--------------------------------------------------------------------------------
--
-- Renaming


mren : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢ A
                    â†’ Î”â€² â Î“ âŠ¢ A
mren Î· (áµáµ› i)    = áµáµ› (lookupáµ£ Î· i)
mren Î· (Ê³áµ› i)    = Ê³áµ› i
mren Î· (Æ› M)     = Æ› (mren Î· M)
mren Î· (M $ N)   = mren Î· M $ mren Î· N
mren Î· (M , N)   = mren Î· M , mren Î· N
mren Î· (Ï€â‚ M)    = Ï€â‚ (mren Î· M)
mren Î· (Ï€â‚‚ M)    = Ï€â‚‚ (mren Î· M)
mren Î· tt        = tt
mren Î· (âŒœ M âŒ)   = âŒœ mren Î· M âŒ
mren Î· (âŒ M âŒŸ N) = âŒ mren Î· M âŒŸ (mren (liftáµ£ Î·) N)

rren : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢ A
                   â†’ Î” â Î“â€² âŠ¢ A
rren Î· (áµáµ› i)    = áµáµ› i
rren Î· (Ê³áµ› i)    = Ê³áµ› (lookupáµ£ Î· i)
rren Î· (Æ› M)     = Æ› (rren (liftáµ£ Î·) M)
rren Î· (M $ N)   = rren Î· M $ rren Î· N
rren Î· (M , N)   = rren Î· M , rren Î· N
rren Î· (Ï€â‚ M)    = Ï€â‚ (rren Î· M)
rren Î· (Ï€â‚‚ M)    = Ï€â‚‚ (rren Î· M)
rren Î· tt        = tt
rren Î· (âŒœ M âŒ)   = âŒœ M âŒ
rren Î· (âŒ M âŒŸ N) = âŒ rren Î· M âŒŸ (rren Î· N)


mutual
  mrenâ‚™â‚˜ : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
                        â†’ Î”â€² â Î“ âŠ¢â‚™â‚˜ A
  mrenâ‚™â‚˜ Î· (Æ› M)     = Æ› (mrenâ‚™â‚˜ Î· M)
  mrenâ‚™â‚˜ Î· (M , N)   = mrenâ‚™â‚˜ Î· M , mrenâ‚™â‚˜ Î· N
  mrenâ‚™â‚˜ Î· tt        = tt
  mrenâ‚™â‚˜ Î· (âŒœ M âŒ)   = âŒœ mren Î· M âŒ
  mrenâ‚™â‚˜ Î· (âŒ M âŒŸ N) = âŒ mrenâ‚™â‚œ Î· M âŒŸ (mrenâ‚™â‚˜ (liftáµ£ Î·) N)
  mrenâ‚™â‚˜ Î· (â¿áµ— M)    = â¿áµ— (mrenâ‚™â‚œ Î· M)

  mrenâ‚™â‚œ : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                        â†’ Î”â€² â Î“ âŠ¢â‚™â‚œ A
  mrenâ‚™â‚œ Î· (áµáµ› i)  = áµáµ› (lookupáµ£ Î· i)
  mrenâ‚™â‚œ Î· (Ê³áµ› i ) = Ê³áµ› i
  mrenâ‚™â‚œ Î· (M $ N) = mrenâ‚™â‚œ Î· M $ mrenâ‚™â‚˜ Î· N
  mrenâ‚™â‚œ Î· (Ï€â‚ M)  = Ï€â‚ (mrenâ‚™â‚œ Î· M)
  mrenâ‚™â‚œ Î· (Ï€â‚‚ M)  = Ï€â‚‚ (mrenâ‚™â‚œ Î· M)


mutual
  rrenâ‚™â‚˜ : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
                       â†’ Î” â Î“â€² âŠ¢â‚™â‚˜ A
  rrenâ‚™â‚˜ Î· (Æ› M)     = Æ› (rrenâ‚™â‚˜ (liftáµ£ Î·) M)
  rrenâ‚™â‚˜ Î· (M , N)   = rrenâ‚™â‚˜ Î· M , rrenâ‚™â‚˜ Î· N
  rrenâ‚™â‚˜ Î· tt        = tt
  rrenâ‚™â‚˜ Î· (âŒœ M âŒ)   = âŒœ M âŒ
  rrenâ‚™â‚˜ Î· (âŒ M âŒŸ N) = âŒ rrenâ‚™â‚œ Î· M âŒŸ (rrenâ‚™â‚˜ Î· N)
  rrenâ‚™â‚˜ Î· (â¿áµ— M)    = â¿áµ— (rrenâ‚™â‚œ Î· M)

  rrenâ‚™â‚œ : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                       â†’ Î” â Î“â€² âŠ¢â‚™â‚œ A
  rrenâ‚™â‚œ Î· (áµáµ› i)  = áµáµ› i
  rrenâ‚™â‚œ Î· (Ê³áµ› i)  = Ê³áµ› (lookupáµ£ Î· i)
  rrenâ‚™â‚œ Î· (M $ N) = rrenâ‚™â‚œ Î· M $ rrenâ‚™â‚˜ Î· N
  rrenâ‚™â‚œ Î· (Ï€â‚ M)  = Ï€â‚ (rrenâ‚™â‚œ Î· M)
  rrenâ‚™â‚œ Î· (Ï€â‚‚ M)  = Ï€â‚‚ (rrenâ‚™â‚œ Î· M)


renâ‚™â‚˜ : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
                        â†’ Î”â€² â Î“â€² âŠ¢â‚™â‚˜ A
renâ‚™â‚˜ Î· M = (mrenâ‚™â‚˜ (projâ‚ Î·) âˆ˜ rrenâ‚™â‚˜ (projâ‚‚ Î·)) M

renâ‚™â‚œ : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                        â†’ Î”â€² â Î“â€² âŠ¢â‚™â‚œ A
renâ‚™â‚œ Î· M = (mrenâ‚™â‚œ (projâ‚ Î·) âˆ˜ rrenâ‚™â‚œ (projâ‚‚ Î·)) M


--------------------------------------------------------------------------------
--
-- Substitution


-- Simultaneous substitutions
infix 3 _âŠ¢â‹†_
_âŠ¢â‹†_ : ğ’ â†’ List ğ’¯ â†’ Set
Î” â Î“ âŠ¢â‹† Î = All (Î” â Î“ âŠ¢_) Î


mrenâ‹† : âˆ€ {Î” Î”â€² Î“ Î} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î”â€² â Î“ âŠ¢â‹† Î
mrenâ‹† Î· Ïƒ = mapAll (mren Î·) Ïƒ

rrenâ‹† : âˆ€ {Î” Î“ Î“â€² Î} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” â Î“â€² âŠ¢â‹† Î
rrenâ‹† Î· Ïƒ = mapAll (rren Î·) Ïƒ


mwkâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                   â†’ Î” , A â Î“ âŠ¢â‹† Î
mwkâ‚› Ïƒ = mrenâ‹† (wkáµ£ idáµ£) Ïƒ

rwkâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                   â†’ Î” â Î“ , A âŠ¢â‹† Î
rwkâ‚› Ïƒ = rrenâ‹† (wkáµ£ idáµ£) Ïƒ

mliftâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” , A â Î“ âŠ¢â‹† Î , A
mliftâ‚› Ïƒ = mwkâ‚› Ïƒ , áµáµ› zero

rliftâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” â Î“ , A âŠ¢â‹† Î , A
rliftâ‚› Ïƒ = rwkâ‚› Ïƒ , Ê³áµ› zero


midâ‚› : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‹† Î”
midâ‚› {âˆ…}     = âˆ…
midâ‚› {Î“ , A} = mliftâ‚› midâ‚›

ridâ‚› : âˆ€ {Î“ Î”} â†’ Î” â Î“ âŠ¢â‹† Î“
ridâ‚› {âˆ…}     = âˆ…
ridâ‚› {Î“ , A} = rliftâ‚› ridâ‚›


lookupâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î âˆ‹ A
                      â†’ Î” â Î“ âŠ¢ A
lookupâ‚› Ïƒ i = lookupAll Ïƒ i


-- Substitution
msub : âˆ€ {Î” Î“ Î A} â†’ Î” â âˆ… âŠ¢â‹† Î â†’ Î â Î“ âŠ¢ A
                   â†’ Î” â Î“ âŠ¢ A
msub Ïƒ (áµáµ› i)    = rren infáµ£ (lookupâ‚› Ïƒ i)
msub Ïƒ (Ê³áµ› i)    = Ê³áµ› i
msub Ïƒ (Æ› M)     = Æ› (msub Ïƒ M)
msub Ïƒ (M $ N)   = msub Ïƒ M $ msub Ïƒ N
msub Î· (M , N)   = msub Î· M , msub Î· N
msub Î· (Ï€â‚ M)    = Ï€â‚ (msub Î· M)
msub Î· (Ï€â‚‚ M)    = Ï€â‚‚ (msub Î· M)
msub Î· tt        = tt
msub Ïƒ âŒœ M âŒ     = âŒœ msub Ïƒ M âŒ
msub Ïƒ (âŒ M âŒŸ N) = âŒ msub Ïƒ M âŒŸ (msub (mliftâ‚› Ïƒ) N)

rsub : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î” â Î âŠ¢ A
                  â†’ Î” â Î“ âŠ¢ A
rsub Ïƒ (áµáµ› i)    = áµáµ› i
rsub Ïƒ (Ê³áµ› i)    = lookupâ‚› Ïƒ i
rsub Ïƒ (Æ› M)     = Æ› (rsub (rliftâ‚› Ïƒ) M)
rsub Ïƒ (M $ N)   = rsub Ïƒ M $ rsub Ïƒ N
rsub Î· (M , N)   = rsub Î· M , rsub Î· N
rsub Î· (Ï€â‚ M)    = Ï€â‚ (rsub Î· M)
rsub Î· (Ï€â‚‚ M)    = Ï€â‚‚ (rsub Î· M)
rsub Î· tt        = tt
rsub Ïƒ âŒœ M âŒ     = âŒœ M âŒ
rsub Ïƒ (âŒ M âŒŸ N) = âŒ rsub Ïƒ M âŒŸ (rsub (mwkâ‚› Ïƒ) N)


--------------------------------------------------------------------------------
--
-- Semantics


-- Introspective Kripke models
record ğ” : Setâ‚ where
  field
    ğ’²    : Set

    ğ’±    : ğ’² â†’ TVar â†’ Set

    _â‰¥_  : ğ’² â†’ ğ’² â†’ Set

    idâ‚  : âˆ€ {w} â†’ w â‰¥ w

    _âˆ˜â‚_ : âˆ€ {w wâ€² wâ€³} â†’ wâ€² â‰¥ w â†’ wâ€³ â‰¥ wâ€²
                       â†’ wâ€³ â‰¥ w

    accáµ¥ : âˆ€ {x w wâ€²} â†’ wâ€² â‰¥ w â†’ ğ’± w x
                      â†’ ğ’± wâ€² x

    âŒŠ_âŒ‹  : ğ’² â†’ ğ’

    âŒŠ_âŒ‹â‚ : âˆ€ {w wâ€²} â†’ wâ€² â‰¥ w
                    â†’ âŒŠ wâ€² âŒ‹ âŠ‡Â² âŒŠ w âŒ‹

open ğ” {{â€¦}} public


áµâŒŠ_âŒ‹ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List ğ’¯
áµâŒŠ w âŒ‹ = projâ‚ âŒŠ w âŒ‹

Ê³âŒŠ_âŒ‹ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List ğ’¯
Ê³âŒŠ w âŒ‹ = projâ‚‚ âŒŠ w âŒ‹

áµâŒŠ_âŒ‹â‚ : âˆ€ {{ğ” : ğ”}} {w wâ€²} â†’ wâ€² â‰¥ w
                           â†’ áµâŒŠ wâ€² âŒ‹ âŠ‡ áµâŒŠ w âŒ‹
áµâŒŠ Î· âŒ‹â‚ = projâ‚ âŒŠ Î· âŒ‹â‚

Ê³âŒŠ_âŒ‹â‚ : âˆ€ {{ğ” : ğ”}} {w wâ€²} â†’ wâ€² â‰¥ w
                           â†’ Ê³âŒŠ wâ€² âŒ‹ âŠ‡ Ê³âŒŠ w âŒ‹
Ê³âŒŠ w âŒ‹â‚ = projâ‚‚ âŒŠ w âŒ‹â‚


-- Values
mutual
  infix 3 _âŠ©_
  _âŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ ğ’¯ â†’ Set

  w âŠ© áµ—áµ› x  = ğ’± w x

  w âŠ© A âŠƒ B = âˆ€ {wâ€²} â†’ (Î· : wâ€² â‰¥ w) (k : wâ€² áµâŠ© A)
                       â†’ wâ€² áµâŠ© B

  w âŠ© A âˆ§ B = w áµâŠ© A Ã— w áµâŠ© B

  w âŠ© ğ•‹     = âŠ¤

  w âŠ© â–¡ A   = âˆ€ {wâ€²} â†’ (Î· : wâ€² â‰¥ w)
                      â†’ wâ€² áµáµâŠ© A

  infix 3 _áµâŠ©_
  _áµâŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ ğ’¯ â†’ Set
  w áµâŠ© A = âˆ€ {wâ€² C} â†’ (Î· : wâ€² â‰¥ w) (f : âˆ€ {wâ€³} â†’ wâ€³ â‰¥ wâ€² â†’ wâ€³ âŠ© A
                                                 â†’ âŒŠ wâ€³ âŒ‹ âŠ¢â‚™â‚˜ C)
                     â†’ âŒŠ wâ€² âŒ‹ âŠ¢â‚™â‚˜ C

  infix 3 _áµáµâŠ©_
  _áµáµâŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ ğ’¯ â†’ Set
  w áµáµâŠ© A = áµâŒŠ w âŒ‹ â âˆ… âŠ¢ A Ã— w áµâŠ© A


syn : âˆ€ {{ğ” : ğ”}} {w A} â†’ w áµáµâŠ© A
                        â†’ áµâŒŠ w âŒ‹ â âˆ… âŠ¢ A
syn Mk = projâ‚ Mk

sem : âˆ€ {{ğ” : ğ”}} {w A} â†’ w áµáµâŠ© A
                        â†’ w áµâŠ© A
sem Mk = projâ‚‚ Mk


-- Environments
infix 3 _áµâŠ©â‹†_
_áµâŠ©â‹†_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List ğ’¯ â†’ Set
w áµâŠ©â‹† Î = All (w áµâŠ©_) Î

infix 3 _áµáµâŠ©â‹†_
_áµáµâŠ©â‹†_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List ğ’¯ â†’ Set
w áµáµâŠ©â‹† Î = All (w áµáµâŠ©_) Î


synâ‹† : âˆ€ {{ğ” : ğ”}} {w Î} â†’ w áµáµâŠ©â‹† Î
                         â†’ áµâŒŠ w âŒ‹ â âˆ… âŠ¢â‹† Î
synâ‹† mÏ = mapAll syn mÏ

semâ‹† : âˆ€ {{ğ” : ğ”}} {w Î} â†’ w áµáµâŠ©â‹† Î
                         â†’ w áµâŠ©â‹† Î
semâ‹† mÏ = mapAll sem mÏ


-- Semantic entailment
infix 3 _âŠ¨_
_âŠ¨_ : ğ’ â†’ ğ’¯ â†’ Setâ‚
Î” â Î“ âŠ¨ A = âˆ€ {{ğ” : ğ”}} {w} â†’ w áµáµâŠ©â‹† Î” â†’ w áµâŠ©â‹† Î“
                             â†’ w áµâŠ© A


-- Accessibility
mutual
  acc : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w âŠ© A
                             â†’ wâ€² âŠ© A
  acc {áµ—áµ› x}  Î· M = accáµ¥ Î· M
  acc {A âŠƒ B} Î· f = Î» Î·â€² â†’ f (Î· âˆ˜â‚ Î·â€²)
  acc {A âˆ§ B} Î· p = kacc {A} Î· (projâ‚ p) , kacc {B} Î· (projâ‚‚ p)
  acc {ğ•‹}     Î· t = tt
  acc {â–¡ A}   Î· f = Î» Î·â€² â†’ f (Î· âˆ˜â‚ Î·â€²)

  kacc : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâŠ© A
                              â†’ wâ€² áµâŠ© A
  kacc Î· k = Î» Î·â€² f â†’ k (Î· âˆ˜â‚ Î·â€²) f

mkacc : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµáµâŠ© A
                             â†’ wâ€² áµáµâŠ© A
mkacc {A} Î· (M , k) = mren áµâŒŠ Î· âŒ‹â‚ M , kacc {A} Î· k


kaccâ‹† : âˆ€ {{ğ” : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâŠ©â‹† Î
                             â†’ wâ€² áµâŠ©â‹† Î
-- TODO: Why does Agda require me to add seemingly unused annotations here?
-- kaccâ‹† Î· rÏ = mapAll (kacc Î·) rÏ
kaccâ‹† Î· rÏ = mapAll (Î» {A} k {_} {_} â†’ kacc {A} Î· (k {_})) rÏ

mkaccâ‹† : âˆ€ {{ğ” : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµáµâŠ©â‹† Î
                              â†’ wâ€² áµáµâŠ©â‹† Î
mkaccâ‹† Î· mÏ = mapAll (mkacc Î·) mÏ


-- Kripke continuation monad
return : âˆ€ {{ğ” : ğ”}} {A w} â†’ w âŠ© A
                           â†’ w áµâŠ© A
return {A} a = Î» Î· f â†’
                 f idâ‚ (acc {A} Î· a)

bind : âˆ€ {{ğ” : ğ”}} {A C w} â†’ w áµâŠ© A â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² âŠ© A
                                                 â†’ wâ€² áµâŠ© C)
                           â†’ w áµâŠ© C
bind k f = Î» Î· fâ€² â†’
             k Î· (Î» Î·â€² a â†’
               f (Î· âˆ˜â‚ Î·â€²) a idâ‚ (Î» Î·â€³ b â†’
                 fâ€² (Î·â€² âˆ˜â‚ Î·â€³) b))


klookupâ‚‘ : âˆ€ {{ğ” : ğ”}} {Î A w} â†’ w áµâŠ©â‹† Î â†’ Î âˆ‹ A
                               â†’ w áµâŠ© A
klookupâ‚‘ rÏ i = lookupAll rÏ i


kÆ› : âˆ€ {{ğ” : ğ”}} {A B w} â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² áµâŠ© A
                                    â†’ wâ€² áµâŠ© B)
                         â†’ w áµâŠ© A âŠƒ B
kÆ› {A} {B} f = return {A âŠƒ B} (Î» Î· k â†’ f Î· k)

k$ : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A âŠƒ B â†’ w áµâŠ© A
                         â†’ w áµâŠ© B
k$ {A} {B} kâ‚ kâ‚‚ = bind {A âŠƒ B} {B} kâ‚ (Î» Î· f â†’ f idâ‚ (kacc {A} Î· kâ‚‚))

k, : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A â†’ w áµâŠ© B
                         â†’ w áµâŠ© A âˆ§ B
k, {A} {B} kâ‚ kâ‚‚ = return {A âˆ§ B} (kâ‚ , kâ‚‚)

kÏ€â‚ : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A âˆ§ B
                          â†’ w áµâŠ© A
kÏ€â‚ {A} {B} k = bind {A âˆ§ B} {A} k (Î» Î· p â†’ projâ‚ p)

kÏ€â‚‚ : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A âˆ§ B
                          â†’ w áµâŠ© B
kÏ€â‚‚ {A} {B} k = bind {A âˆ§ B} {B} k (Î» Î· p â†’ projâ‚‚ p)

ktt : âˆ€ {{ğ” : ğ”}} {w} â†’ w áµâŠ© ğ•‹
ktt = return {ğ•‹} tt

kâŒœâŒ : âˆ€ {{ğ” : ğ”}} {A w} â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w
                                   â†’ wâ€² áµáµâŠ© A)
                        â†’ w áµâŠ© â–¡ A
kâŒœâŒ {A} f = return {â–¡ A} (Î» Î· â†’ f Î·)

kâŒâŒŸ : âˆ€ {{ğ” : ğ”}} {A C w} â†’ w áµâŠ© â–¡ A
                          â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² áµáµâŠ© A
                                     â†’ wâ€² áµâŠ© C)
                          â†’ w áµâŠ© C
kâŒâŒŸ {A} {C} k f = bind {â–¡ A} {C} k (Î» Î· fâ€² â†’ f Î· (fâ€² idâ‚))


-- Soundness
-- â†“ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
--               â†’ Î” â Î“ âŠ¨ A
-- â†“ (áµáµ› i)            mÏ rÏ = klookupâ‚‘ (semâ‹† mÏ) i
-- â†“ (Ê³áµ› i)            mÏ rÏ = klookupâ‚‘ rÏ i
-- â†“ (Æ› {A} {B} M)     mÏ rÏ = kÆ› {A} {B} (Î» Î· k â†’
--                               â†“ M (mkaccâ‹† Î· mÏ) (kaccâ‹† Î· rÏ , k))
-- â†“ (_$_ {A} {B} M N) mÏ rÏ = k$ {A} {B} (â†“ M mÏ rÏ) (â†“ N mÏ rÏ)
-- â†“ (_,_ {A} {B} M N) mÏ rÏ = k, {A} {B} (â†“ M mÏ rÏ) (â†“ N mÏ rÏ)
-- â†“ (Ï€â‚ {A} {B} M)    mÏ rÏ = kÏ€â‚ {A} {B} (â†“ M mÏ rÏ)
-- â†“ (Ï€â‚‚ {A} {B} M)    mÏ rÏ = kÏ€â‚‚ {A} {B} (â†“ M mÏ rÏ)
-- â†“ tt                mÏ rÏ = ktt
-- â†“ (âŒœ_âŒ {A} M)       mÏ rÏ = kâŒœâŒ {A} (Î» Î· â†’
--                               msub (synâ‹† (mkaccâ‹† Î· mÏ)) M , â†“ M (mkaccâ‹† Î· mÏ) âˆ…)
-- â†“ (âŒ_âŒŸ {A} {C} M N) mÏ rÏ = kâŒâŒŸ {A} {C} (â†“ M mÏ rÏ) (Î» Î· Mk â†’
--                               â†“ N (mkaccâ‹† Î· mÏ , Mk) (kaccâ‹† Î· rÏ))


-- Soundness, inlined
â†“ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
              â†’ Î” â Î“ âŠ¨ A
â†“ (áµáµ› i)            mÏ rÏ = klookupâ‚‘ (semâ‹† mÏ) i
â†“ (Ê³áµ› i)            mÏ rÏ = klookupâ‚‘ rÏ i
â†“ (Æ› {A} {B} M)     mÏ rÏ = return {A âŠƒ B} (Î» Î· k â†’
                              â†“ M (mkaccâ‹† Î· mÏ) (kaccâ‹† Î· rÏ , k))
â†“ (_$_ {A} {B} M N) mÏ rÏ = bind {A âŠƒ B} {B} (â†“ M mÏ rÏ) (Î» Î· f â†’
                              f idâ‚ (â†“ N (mkaccâ‹† Î· mÏ) (kaccâ‹† Î· rÏ)))
â†“ (_,_ {A} {B} M N) mÏ rÏ = return {A âˆ§ B} (â†“ M mÏ rÏ , â†“ N mÏ rÏ)
â†“ (Ï€â‚ {A} {B} M)    mÏ rÏ = bind {A âˆ§ B} {A} (â†“ M mÏ rÏ) (Î» Î· p â†’ projâ‚ p)
â†“ (Ï€â‚‚ {A} {B} M)    mÏ rÏ = bind {A âˆ§ B} {B} (â†“ M mÏ rÏ) (Î» Î· p â†’ projâ‚‚ p)
â†“ tt                mÏ rÏ = return {ğ•‹} tt
â†“ (âŒœ_âŒ {A} M)       mÏ rÏ = return {â–¡ A} (Î» Î· â†’
                              msub (synâ‹† (mkaccâ‹† Î· mÏ)) M , â†“ M (mkaccâ‹† Î· mÏ) âˆ…)
â†“ (âŒ_âŒŸ {A} {C} M N) mÏ rÏ = bind {â–¡ A} {C} (â†“ M mÏ rÏ) (Î» Î· f â†’
                              â†“ N (mkaccâ‹† Î· mÏ , f idâ‚) (kaccâ‹† Î· rÏ))


--------------------------------------------------------------------------------
--
-- Completeness


-- Canonical model
instance
  ğ”á¶œ : ğ”
  ğ”á¶œ = record
         { ğ’²    = ğ’
         ; ğ’±    = Î» { (Î” â Î“) x â†’ Î” â Î“ âŠ¢â‚™â‚˜ áµ—áµ› x }
         ; _â‰¥_  = _âŠ‡Â²_
         ; idâ‚  = idáµ£áµ£
         ; _âˆ˜â‚_ = _âˆ˜áµ£áµ£_
         ; accáµ¥ = renâ‚™â‚˜
         ; âŒŠ_âŒ‹  = id
         ; âŒŠ_âŒ‹â‚ = id
         }


-- Canonical soundness and completeness
mutual
  â†‘á¶œ : âˆ€ {A Î” Î“} â†’ Î” â Î“ áµâŠ© A
                 â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
  â†‘á¶œ {áµ—áµ› x}  k = k idáµ£áµ£ (Î» Î· M â†’ M)
  â†‘á¶œ {A âŠƒ B} k = k idáµ£áµ£ (Î» Î· f â†’ Æ› (â†‘á¶œ (f (rwkáµ£áµ£ idáµ£áµ£) (â†“á¶œ (Ê³áµ› zero)))))
  â†‘á¶œ {A âˆ§ B} k = k idáµ£áµ£ (Î» Î· p â†’ â†‘á¶œ (projâ‚ p) , â†‘á¶œ (projâ‚‚ p))
  â†‘á¶œ {ğ•‹}     k = k idáµ£áµ£ (Î» Î· t â†’ tt)
  â†‘á¶œ {â–¡ A}   k = k idáµ£áµ£ (Î» Î· f â†’ âŒœ syn (f idáµ£áµ£) âŒ)

  â†“á¶œ : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                 â†’ Î” â Î“ áµâŠ© A
  â†“á¶œ {áµ—áµ› x}  M = return {áµ—áµ› x} (â¿áµ— M)
  â†“á¶œ {A âŠƒ B} M = return {A âŠƒ B} (Î» Î· k â†’ â†“á¶œ (renâ‚™â‚œ Î· M $ â†‘á¶œ k))
  â†“á¶œ {A âˆ§ B} M = return {A âˆ§ B} (â†“á¶œ (Ï€â‚ M) , â†“á¶œ (Ï€â‚‚ M))
  â†“á¶œ {ğ•‹}     M = return {ğ•‹} tt
  â†“á¶œ {â–¡ A}   M = Î» Î· f â†’ âŒ renâ‚™â‚œ Î· M âŒŸ (f (mwkáµ£áµ£ idáµ£áµ£) (Î» Î·â€² â†’
                   áµáµ› (mlookupáµ£áµ£ Î·â€² zero) , â†“á¶œ (áµáµ› (mlookupáµ£áµ£ Î·â€² zero))))


mkidâ‚‘ : âˆ€ {Î” Î“} â†’ Î” â Î“ áµáµâŠ©â‹† Î”
mkidâ‚‘ {âˆ…}     = âˆ…
mkidâ‚‘ {Î” , A} = mkaccâ‹† (mwkáµ£áµ£ idáµ£áµ£) mkidâ‚‘ , (áµáµ› zero , â†“á¶œ (áµáµ› zero))

kidâ‚‘ : âˆ€ {Î“ Î”} â†’ Î” â Î“ áµâŠ©â‹† Î“
kidâ‚‘ {âˆ…}     = âˆ…
kidâ‚‘ {Î“ , A} = kaccâ‹† (rwkáµ£áµ£ idáµ£áµ£) kidâ‚‘ , â†“á¶œ (Ê³áµ› zero)


-- Completeness
â†‘ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¨ A
              â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
â†‘ ğ” = â†‘á¶œ (ğ” mkidâ‚‘ kidâ‚‘)


-- Normalisation
nm : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
               â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
nm = â†‘ âˆ˜ â†“


--------------------------------------------------------------------------------
--
-- Examples


áµáµ›0 : âˆ€ {Î” Î“ A} â†’ Î” , A â Î“ âŠ¢ A
áµáµ›0 = áµáµ› zero

áµáµ›1 : âˆ€ {Î” Î“ A B} â†’ Î” , A , B â Î“ âŠ¢ A
áµáµ›1 = áµáµ› (suc zero)

áµáµ›2 : âˆ€ {Î” Î“ A B C} â†’ Î” , A , B , C â Î“ âŠ¢ A
áµáµ›2 = áµáµ› (suc (suc zero))


Ê³áµ›0 : âˆ€ {Î” Î“ A} â†’ Î” â Î“ , A âŠ¢ A
Ê³áµ›0 = Ê³áµ› zero

Ê³áµ›1 : âˆ€ {Î” Î“ A B} â†’ Î” â Î“ , A , B âŠ¢ A
Ê³áµ›1 = Ê³áµ› (suc zero)

Ê³áµ›2 : âˆ€ {Î” Î“ A B C} â†’ Î” â Î“ , A , B , C âŠ¢ A
Ê³áµ›2 = Ê³áµ› (suc (suc zero))


axI : âˆ€ {A Î” Î“}
    â†’ Î” â Î“ âŠ¢ A âŠƒ A
axI = Æ› Ê³áµ›0

axK : âˆ€ {A B Î” Î“}
    â†’ Î” â Î“ âŠ¢ A âŠƒ B âŠƒ A
axK = Æ› (Æ› Ê³áµ›1)

axS : âˆ€ {A B C Î” Î“}
    â†’ Î” â Î“ âŠ¢ (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
axS = Æ› (Æ› (Æ› ((Ê³áµ›2 $ Ê³áµ›0) $ (Ê³áµ›1 $ Ê³áµ›0))))


axD : âˆ€ {A B Î” Î“}
    â†’ Î” â Î“ âŠ¢ â–¡ (A âŠƒ B) âŠƒ â–¡ A âŠƒ â–¡ B
axD = Æ› (Æ› (âŒ Ê³áµ›1 âŒŸ (âŒ Ê³áµ›0 âŒŸ âŒœ áµáµ›1 $ áµáµ›0 âŒ)))

axT : âˆ€ {A Î” Î“}
    â†’ Î” â Î“ âŠ¢ â–¡ A âŠƒ A
axT = Æ› (âŒ Ê³áµ›0 âŒŸ áµáµ›0)

ax4 : âˆ€ {A Î” Î“}
    â†’ Î” â Î“ âŠ¢ â–¡ A âŠƒ â–¡ â–¡ A
ax4 = Æ› (âŒ Ê³áµ›0 âŒŸ âŒœ âŒœ áµáµ›0 âŒ âŒ)


--------------------------------------------------------------------------------
--
-- Conversion tests


testâˆ¼ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A â†’ Î” â Î“ âŠ¢ A â†’ Set
testâˆ¼ Mâ‚ Mâ‚‚ = embâ‚™â‚˜ (nm Mâ‚) â‰¡ Mâ‚‚


-- redâŠƒ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ , A âŠ¢ B) (N : Î” â Î“ âŠ¢ A)
--                    â†’ Æ› M $ N âˆ¼ rsub (ridâ‚› , N) M

testâˆ¼redâŠƒ : testâˆ¼ {âˆ…} {âˆ… , "A"}
                  ((Æ› Ê³áµ›0) $ Ê³áµ›0)
                  Ê³áµ›0
testâˆ¼redâŠƒ = refl


-- redâˆ§â‚ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A) (N : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚ (M , N) âˆ¼ M

testâˆ¼redâˆ§â‚ : testâˆ¼ {âˆ…} {âˆ… , "A" , "B"}
                   (Ï€â‚ (Ê³áµ›1 , Ê³áµ›0))
                   Ê³áµ›1
testâˆ¼redâˆ§â‚ = refl


-- redâˆ§â‚‚ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A) (N : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚‚ (M , N) âˆ¼ N

testâˆ¼redâˆ§â‚‚ : testâˆ¼ {âˆ…} {âˆ… , "A" , "B"}
                   (Ï€â‚‚ (Ê³áµ›1 , Ê³áµ›0))
                   Ê³áµ›0
testâˆ¼redâˆ§â‚‚ = refl


-- redâ–¡ : âˆ€ {Î” Î“ A C} â†’ (M : Î” â âˆ… âŠ¢ A) (N : Î” , A â Î“ âŠ¢ C)
--                    â†’ âŒ âŒœ M âŒ âŒŸ N âˆ¼ msub (midâ‚› , M) N

testâˆ¼redâ–¡ : testâˆ¼ {âˆ… , "A"} {âˆ…}
                  (âŒ âŒœ áµáµ›0 âŒ âŒŸ áµáµ›0)
                  áµáµ›0
testâˆ¼redâ–¡ = refl


-- expâŠƒ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A âŠƒ B)
--                    â†’ M âˆ¼ Æ› (rren (wkáµ£ idáµ£) M $ Ê³áµ›0)

testâˆ¼expâŠƒ : testâˆ¼ {âˆ…} {âˆ… , "A" âŠƒ "B"}
                  Ê³áµ›0
                  (Æ› (rren (wkáµ£ idáµ£) Ê³áµ›0 $ Ê³áµ›0))
testâˆ¼expâŠƒ = refl


-- expâˆ§ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A âˆ§ B)
--                    â†’ M âˆ¼ Ï€â‚ M , Ï€â‚‚ M

testâˆ¼expâˆ§ : testâˆ¼ {âˆ…} {âˆ… , "A" âˆ§ "B"}
                  Ê³áµ›0
                  (Ï€â‚ Ê³áµ›0 , Ï€â‚‚ Ê³áµ›0)
testâˆ¼expâˆ§ = refl


-- expğ•‹ : âˆ€ {Î” Î“} â†’ (M : Î” â Î“ âŠ¢ ğ•‹)
--                â†’ M âˆ¼ tt

testâˆ¼expğ•‹ : testâˆ¼ {âˆ…} {âˆ… , ğ•‹}
                  Ê³áµ›0
                  tt
testâˆ¼expğ•‹ = refl


-- expâ–¡ : âˆ€ {Î” Î“} â†’ (M : Î” â Î“ âŠ¢ â–¡ A)
--                â†’ M âˆ¼ âŒ M âŒŸ âŒœ áµáµ›0 âŒ

testâˆ¼expâ–¡ : testâˆ¼ {âˆ…} {âˆ… , â–¡ "A"}
                  Ê³áµ›0
                  (âŒ Ê³áµ›0 âŒŸ âŒœ áµáµ›0 âŒ)
testâˆ¼expâ–¡ = refl


-- commâ–¡$ : âˆ€ {Î” Î“ A B} â†’ (K : Î” â Î“ âŠ¢ â–¡ (A âŠƒ B))
--                         (M : Î” , A âŠƒ B â Î“ âŠ¢ A âŠƒ B) (N : Î” â Î“ âŠ¢ A)
--                      â†’ (âŒ K âŒŸ M) $ N âˆ¼ âŒ K âŒŸ (M $ (mren (wkáµ£ idáµ£) N))

testâˆ¼commâ–¡$ : testâˆ¼ {âˆ…} {âˆ… , â–¡ ("A" âŠƒ "B") , "A"}
                    ((âŒ Ê³áµ›1 âŒŸ áµáµ›0) $ Ê³áµ›0)
                    (âŒ Ê³áµ›1 âŒŸ (áµáµ›0 $ mren (wkáµ£ idáµ£) Ê³áµ›0))
testâˆ¼commâ–¡$ = refl


-- commâ–¡âŒâŒŸ : âˆ€ {Î” Î“ A C} â†’ (K : Î” â Î“ âŠ¢ â–¡ â–¡ A)
--                          (M : Î” , â–¡ A â Î“ âŠ¢ â–¡ A) (N : Î” , A â Î“ âŠ¢ C)
--                       â†’ âŒ (âŒ K âŒŸ M) âŒŸ N âˆ¼ âŒ K âŒŸ (âŒ M âŒŸ (mren (wkáµ£ idáµ£) N))

testâˆ¼commâ–¡âŒâŒŸ : testâˆ¼ {âˆ…} {âˆ… , â–¡ â–¡ "A"}
                     (âŒ âŒ Ê³áµ›0 âŒŸ áµáµ›0 âŒŸ áµáµ›0)
                     (âŒ Ê³áµ›0 âŒŸ (âŒ áµáµ›0 âŒŸ áµáµ›0))
testâˆ¼commâ–¡âŒâŒŸ = refl


-- commâ–¡Ï€â‚ : âˆ€ {Î” Î“ A B} â†’ (K : Î” â Î“ âŠ¢ â–¡ (A âˆ§ B))
--                          (M : Î” , A âˆ§ B â Î“ âŠ¢ A âˆ§ B)
--                       â†’ Ï€â‚ (âŒ K âŒŸ M) âˆ¼ âŒ K âŒŸ (Ï€â‚ M)

testâˆ¼commâ–¡Ï€â‚ : testâˆ¼ {âˆ…} {âˆ… , â–¡ ("A" âˆ§ "B")}
                     (Ï€â‚ (âŒ Ê³áµ›0 âŒŸ áµáµ›0))
                     (âŒ Ê³áµ›0 âŒŸ (Ï€â‚ áµáµ›0))
testâˆ¼commâ–¡Ï€â‚ = refl


-- commâ–¡Ï€â‚‚ : âˆ€ {Î” Î“ A B} â†’ (K : Î” â Î“ âŠ¢ â–¡ (A âˆ§ B))
--                          (M : Î” , A âˆ§ B â Î“ âŠ¢ A âˆ§ B)
--                       â†’ Ï€â‚‚ (âŒ K âŒŸ M) âˆ¼ âŒ K âŒŸ (Ï€â‚‚ M)

testâˆ¼commâ–¡Ï€â‚‚ : testâˆ¼ {âˆ…} {âˆ… , â–¡ ("A" âˆ§ "B")}
                     (Ï€â‚‚ (âŒ Ê³áµ›0 âŒŸ áµáµ›0))
                     (âŒ Ê³áµ›0 âŒŸ (Ï€â‚‚ áµáµ›0))
testâˆ¼commâ–¡Ï€â‚‚ = refl


--------------------------------------------------------------------------------
--
-- Self-interpretation


-- weakBP : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A)
--                      â†’ ğ•‹ $ âŒœ M âŒ âˆ¼ âŒœ M âŒ

testâˆ¼weakBP : testâˆ¼ {âˆ… , "A"} {âˆ…}
                    (axT $ âŒœ áµáµ›0 âŒ)
                    áµáµ›0
testâˆ¼weakBP = refl


-- Andrej : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A âŠƒ B) (N : Î” â Î“ âŠ¢ A)
--                      â†’ (ğ”» $ âŒœ M âŒ) $ âŒœ N âŒ âˆ¼ âŒœ M $ N âŒ

testâˆ¼Andrej : testâˆ¼ {âˆ… , "A" âŠƒ "B" , "A"} {âˆ…}
                    ((axD $ âŒœ áµáµ›1 âŒ) $ âŒœ áµáµ›0 âŒ)
                    (âŒœ áµáµ›1 $ áµáµ›0 âŒ)
testâˆ¼Andrej = refl


--------------------------------------------------------------------------------

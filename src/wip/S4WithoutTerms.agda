module S4WithoutTerms where

open import Prelude public


--------------------------------------------------------------------------------
--
-- Syntax


-- Type variables
data TVar : Set where
  mkTV : String â†’ TVar

injmkTV : âˆ€ {sâ‚ sâ‚‚} â†’ mkTV sâ‚ â‰¡ mkTV sâ‚‚ â†’ sâ‚ â‰¡ sâ‚‚
injmkTV refl = refl

_â‰Ÿâ‚œáµ¥_ : (xâ‚ xâ‚‚ : TVar) â†’ Dec (xâ‚ â‰¡ xâ‚‚)
mkTV sâ‚ â‰Ÿâ‚œáµ¥ mkTV sâ‚‚ = mapDec (mkTV &_) injmkTV (sâ‚ â‰Ÿâ‚› sâ‚‚)

instance
  TVarIsString : IsString TVar
  TVarIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ mkTV s
      }


-- Types
infixl 9 _âˆ§_
infixr 7 _âŠƒ_
data Tp : Set where
  áµ—áµ›  : (x : TVar) â†’ Tp
  _âŠƒ_ : (A B : Tp) â†’ Tp
  _âˆ§_ : (A B : Tp) â†’ Tp
  TT  : Tp
  â–¡_  : (A : Tp) â†’ Tp

instance
  typeIsString : IsString Tp
  typeIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ áµ—áµ› (mkTV s)
      }


-- Contexts
Cx : Set
Cx = ListÂ² Tp Tp


-- Syntactic entailment
infix 3 _âŠ¢_
data _âŠ¢_ : Cx â†’ Tp â†’ Set
  where
    áµáµ›  : âˆ€ {A Î” Î“} â†’ (i : Î” âˆ‹ A)
                    â†’ Î” â Î“ âŠ¢ A

    áµ›   : âˆ€ {A Î” Î“} â†’ (i : Î“ âˆ‹ A)
                    â†’ Î” â Î“ âŠ¢ A

    Æ›   : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ , A âŠ¢ B)
                      â†’ Î” â Î“ âŠ¢ A âŠƒ B

    _$_ : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âŠƒ B) (â„° : Î” â Î“ âŠ¢ A)
                      â†’ Î” â Î“ âŠ¢ B

    _,_ : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A) (â„° : Î” â Î“ âŠ¢ B)
                      â†’ Î” â Î“ âŠ¢ A âˆ§ B

    Ï€â‚  : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âˆ§ B)
                      â†’ Î” â Î“ âŠ¢ A

    Ï€â‚‚  : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âˆ§ B)
                      â†’ Î” â Î“ âŠ¢ B

    tt  : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢ TT

    âŒœ_âŒ : âˆ€ {A Î” Î“} â†’ (ğ’Ÿ : Î” â âˆ… âŠ¢ A)
                    â†’ Î” â Î“ âŠ¢ â–¡ A

    âŒ_âŒŸ : âˆ€ {A C Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ â–¡ A) (â„° : Î” , A â Î“ âŠ¢ C)
                      â†’ Î” â Î“ âŠ¢ C


-- Normal and neutral forms
mutual
  infix 3 _âŠ¢â‚™â‚˜_
  data _âŠ¢â‚™â‚˜_ : Cx â†’ Tp â†’ Set
    where
      Æ›   : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ , A âŠ¢â‚™â‚˜ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚˜ A âŠƒ B

      _,_ : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚˜ A) (â„° : Î” â Î“ âŠ¢â‚™â‚˜ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚˜ A âˆ§ B

      tt  : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‚™â‚˜ TT

      âŒœ_âŒ : âˆ€ {A Î” Î“} â†’ (ğ’Ÿ : Î” â âˆ… âŠ¢ A)
                      â†’ Î” â Î“ âŠ¢â‚™â‚˜ â–¡ A

      âŒ_âŒŸ : âˆ€ {A C Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ â–¡ A) (â„° : Î” , A â Î“ âŠ¢â‚™â‚˜ C)
                        â†’ Î” â Î“ âŠ¢â‚™â‚˜ C

      â¿áµ—  : âˆ€ {x Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ áµ—áµ› x)
                      â†’ Î” â Î“ âŠ¢â‚™â‚˜ áµ—áµ› x

  infix 3 _âŠ¢â‚™â‚œ_
  data _âŠ¢â‚™â‚œ_ : Cx â†’ Tp â†’ Set
    where
      áµáµ›  : âˆ€ {A Î” Î“} â†’ (i : Î” âˆ‹ A)
                      â†’ Î” â Î“ âŠ¢â‚™â‚œ A

      áµ›   : âˆ€ {A Î” Î“} â†’ (i : Î“ âˆ‹ A)
                      â†’ Î” â Î“ âŠ¢â‚™â‚œ A

      _$_ : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ A âŠƒ B) (â„° : Î” â Î“ âŠ¢â‚™â‚˜ A)
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ B

      Ï€â‚  : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ A âˆ§ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ A

      Ï€â‚‚  : âˆ€ {A B Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ A âˆ§ B)
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ B


mutual
  embâ‚™â‚˜ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢â‚™â‚˜ A â†’ Î” â Î“ âŠ¢ A
  embâ‚™â‚˜ (Æ› ğ’Ÿ)     = Æ› (embâ‚™â‚˜ ğ’Ÿ)
  embâ‚™â‚˜ (ğ’Ÿ , â„°)   = embâ‚™â‚˜ ğ’Ÿ , embâ‚™â‚˜ â„°
  embâ‚™â‚˜ tt        = tt
  embâ‚™â‚˜ (âŒœ ğ’Ÿ âŒ)   = âŒœ ğ’Ÿ âŒ
  embâ‚™â‚˜ (âŒ ğ’Ÿ âŒŸ â„°) = âŒ embâ‚™â‚œ ğ’Ÿ âŒŸ (embâ‚™â‚˜ â„°)
  embâ‚™â‚˜ (â¿áµ— ğ’Ÿ)    = embâ‚™â‚œ ğ’Ÿ

  embâ‚™â‚œ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢â‚™â‚œ A â†’ Î” â Î“ âŠ¢ A
  embâ‚™â‚œ (áµáµ› i)  = áµáµ› i
  embâ‚™â‚œ (áµ› i)   = áµ› i
  embâ‚™â‚œ (ğ’Ÿ $ â„°) = embâ‚™â‚œ ğ’Ÿ $ embâ‚™â‚˜ â„°
  embâ‚™â‚œ (Ï€â‚ ğ’Ÿ)  = Ï€â‚ (embâ‚™â‚œ ğ’Ÿ)
  embâ‚™â‚œ (Ï€â‚‚ ğ’Ÿ)  = Ï€â‚‚ (embâ‚™â‚œ ğ’Ÿ)


--------------------------------------------------------------------------------
--
-- Renaming


áµren : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢ A
                    â†’ Î”â€² â Î“ âŠ¢ A
áµren Î· (áµáµ› i)    = áµáµ› (lookupáµ£ Î· i)
áµren Î· (áµ› i)     = áµ› i
áµren Î· (Æ› ğ’Ÿ)     = Æ› (áµren Î· ğ’Ÿ)
áµren Î· (ğ’Ÿ $ â„°)   = áµren Î· ğ’Ÿ $ áµren Î· â„°
áµren Î· (ğ’Ÿ , â„°)   = áµren Î· ğ’Ÿ , áµren Î· â„°
áµren Î· (Ï€â‚ ğ’Ÿ)    = Ï€â‚ (áµren Î· ğ’Ÿ)
áµren Î· (Ï€â‚‚ ğ’Ÿ)    = Ï€â‚‚ (áµren Î· ğ’Ÿ)
áµren Î· tt        = tt
áµren Î· (âŒœ ğ’Ÿ âŒ)   = âŒœ áµren Î· ğ’Ÿ âŒ
áµren Î· (âŒ ğ’Ÿ âŒŸ â„°) = âŒ áµren Î· ğ’Ÿ âŒŸ (áµren (lift Î·) â„°)

ren : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢ A
                   â†’ Î” â Î“â€² âŠ¢ A
ren Î· (áµáµ› i)    = áµáµ› i
ren Î· (áµ› i)     = áµ› (lookupáµ£ Î· i)
ren Î· (Æ› ğ’Ÿ)     = Æ› (ren (lift Î·) ğ’Ÿ)
ren Î· (ğ’Ÿ $ â„°)   = ren Î· ğ’Ÿ $ ren Î· â„°
ren Î· (ğ’Ÿ , â„°)   = ren Î· ğ’Ÿ , ren Î· â„°
ren Î· (Ï€â‚ ğ’Ÿ)    = Ï€â‚ (ren Î· ğ’Ÿ)
ren Î· (Ï€â‚‚ ğ’Ÿ)    = Ï€â‚‚ (ren Î· ğ’Ÿ)
ren Î· tt        = tt
ren Î· (âŒœ ğ’Ÿ âŒ)   = âŒœ ğ’Ÿ âŒ
ren Î· (âŒ ğ’Ÿ âŒŸ â„°) = âŒ ren Î· ğ’Ÿ âŒŸ (ren Î· â„°)


mutual
  áµrenâ‚™â‚˜ : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
                        â†’ Î”â€² â Î“ âŠ¢â‚™â‚˜ A
  áµrenâ‚™â‚˜ Î· (Æ› ğ’Ÿ)     = Æ› (áµrenâ‚™â‚˜ Î· ğ’Ÿ)
  áµrenâ‚™â‚˜ Î· (ğ’Ÿ , â„°)   = áµrenâ‚™â‚˜ Î· ğ’Ÿ , áµrenâ‚™â‚˜ Î· â„°
  áµrenâ‚™â‚˜ Î· tt        = tt
  áµrenâ‚™â‚˜ Î· (âŒœ ğ’Ÿ âŒ)   = âŒœ áµren Î· ğ’Ÿ âŒ
  áµrenâ‚™â‚˜ Î· (âŒ ğ’Ÿ âŒŸ â„°) = âŒ áµrenâ‚™â‚œ Î· ğ’Ÿ âŒŸ (áµrenâ‚™â‚˜ (lift Î·) â„°)
  áµrenâ‚™â‚˜ Î· (â¿áµ— ğ’Ÿ)    = â¿áµ— (áµrenâ‚™â‚œ Î· ğ’Ÿ)

  áµrenâ‚™â‚œ : âˆ€ {Î” Î”â€² Î“ A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                        â†’ Î”â€² â Î“ âŠ¢â‚™â‚œ A
  áµrenâ‚™â‚œ Î· (áµáµ› i)  = áµáµ› (lookupáµ£ Î· i)
  áµrenâ‚™â‚œ Î· (áµ› i )  = áµ› i
  áµrenâ‚™â‚œ Î· (ğ’Ÿ $ â„°) = áµrenâ‚™â‚œ Î· ğ’Ÿ $ áµrenâ‚™â‚˜ Î· â„°
  áµrenâ‚™â‚œ Î· (Ï€â‚ ğ’Ÿ)  = Ï€â‚ (áµrenâ‚™â‚œ Î· ğ’Ÿ)
  áµrenâ‚™â‚œ Î· (Ï€â‚‚ ğ’Ÿ)  = Ï€â‚‚ (áµrenâ‚™â‚œ Î· ğ’Ÿ)


mutual
  renâ‚™â‚˜ : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
                       â†’ Î” â Î“â€² âŠ¢â‚™â‚˜ A
  renâ‚™â‚˜ Î· (Æ› ğ’Ÿ)     = Æ› (renâ‚™â‚˜ (lift Î·) ğ’Ÿ)
  renâ‚™â‚˜ Î· (ğ’Ÿ , â„°)   = renâ‚™â‚˜ Î· ğ’Ÿ , renâ‚™â‚˜ Î· â„°
  renâ‚™â‚˜ Î· tt        = tt
  renâ‚™â‚˜ Î· (âŒœ ğ’Ÿ âŒ)   = âŒœ ğ’Ÿ âŒ
  renâ‚™â‚˜ Î· (âŒ ğ’Ÿ âŒŸ â„°) = âŒ renâ‚™â‚œ Î· ğ’Ÿ âŒŸ (renâ‚™â‚˜ Î· â„°)
  renâ‚™â‚˜ Î· (â¿áµ— ğ’Ÿ)    = â¿áµ— (renâ‚™â‚œ Î· ğ’Ÿ)

  renâ‚™â‚œ : âˆ€ {Î” Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                       â†’ Î” â Î“â€² âŠ¢â‚™â‚œ A
  renâ‚™â‚œ Î· (áµáµ› i)  = áµáµ› i
  renâ‚™â‚œ Î· (áµ› i)   = áµ› (lookupáµ£ Î· i)
  renâ‚™â‚œ Î· (ğ’Ÿ $ â„°) = renâ‚™â‚œ Î· ğ’Ÿ $ renâ‚™â‚˜ Î· â„°
  renâ‚™â‚œ Î· (Ï€â‚ ğ’Ÿ)  = Ï€â‚ (renâ‚™â‚œ Î· ğ’Ÿ)
  renâ‚™â‚œ Î· (Ï€â‚‚ ğ’Ÿ)  = Ï€â‚‚ (renâ‚™â‚œ Î· ğ’Ÿ)


renâ‚™â‚˜Â² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
                         â†’ Î”â€² â Î“â€² âŠ¢â‚™â‚˜ A
renâ‚™â‚˜Â² Î· ğ’Ÿ = (áµrenâ‚™â‚˜ (projâ‚ Î·) âˆ˜ renâ‚™â‚˜ (projâ‚‚ Î·)) ğ’Ÿ

renâ‚™â‚œÂ² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                         â†’ Î”â€² â Î“â€² âŠ¢â‚™â‚œ A
renâ‚™â‚œÂ² Î· ğ’Ÿ = (áµrenâ‚™â‚œ (projâ‚ Î·) âˆ˜ renâ‚™â‚œ (projâ‚‚ Î·)) ğ’Ÿ


--------------------------------------------------------------------------------
--
-- Substitution


-- Simultaneous substitutions
infix 3 _âŠ¢â‹†_
_âŠ¢â‹†_ : Cx â†’ List Tp â†’ Set
Î” â Î“ âŠ¢â‹† Î = All (Î” â Î“ âŠ¢_) Î


áµrenâ‹† : âˆ€ {Î” Î”â€² Î“ Î} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î”â€² â Î“ âŠ¢â‹† Î
áµrenâ‹† Î· Ïƒ = mapâ‚ (áµren Î·) Ïƒ

renâ‹† : âˆ€ {Î” Î“ Î“â€² Î} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” â Î“â€² âŠ¢â‹† Î
renâ‹† Î· Ïƒ = mapâ‚ (ren Î·) Ïƒ


áµwkâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                   â†’ Î” , A â Î“ âŠ¢â‹† Î
áµwkâ‚› Ïƒ = áµrenâ‹† (wk idáµ£) Ïƒ

wkâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                  â†’ Î” â Î“ , A âŠ¢â‹† Î
wkâ‚› Ïƒ = renâ‹† (wk idáµ£) Ïƒ

áµliftâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” , A â Î“ âŠ¢â‹† Î , A
áµliftâ‚› Ïƒ = áµwkâ‚› Ïƒ , áµáµ› zero

liftâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î
                    â†’ Î” â Î“ , A âŠ¢â‹† Î , A
liftâ‚› Ïƒ = wkâ‚› Ïƒ , áµ› zero


áµidâ‚› : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‹† Î”
áµidâ‚› {âˆ…}     = âˆ…
áµidâ‚› {Î“ , A} = áµliftâ‚› áµidâ‚›

idâ‚› : âˆ€ {Î“ Î”} â†’ Î” â Î“ âŠ¢â‹† Î“
idâ‚› {âˆ…}     = âˆ…
idâ‚› {Î“ , A} = liftâ‚› idâ‚›


lookupâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î âˆ‹ A
                      â†’ Î” â Î“ âŠ¢ A
lookupâ‚› Ïƒ i = lookupâ‚ Ïƒ i


-- Substitution
áµsub : âˆ€ {Î” Î“ Î A} â†’ Î” â âˆ… âŠ¢â‹† Î â†’ Î â Î“ âŠ¢ A
                   â†’ Î” â Î“ âŠ¢ A
áµsub Ïƒ (áµáµ› i)    = ren infáµ£ (lookupâ‚› Ïƒ i)
áµsub Ïƒ (áµ› i)     = áµ› i
áµsub Ïƒ (Æ› ğ’Ÿ)     = Æ› (áµsub Ïƒ ğ’Ÿ)
áµsub Ïƒ (ğ’Ÿ $ â„°)   = áµsub Ïƒ ğ’Ÿ $ áµsub Ïƒ â„°
áµsub Î· (ğ’Ÿ , â„°)   = áµsub Î· ğ’Ÿ , áµsub Î· â„°
áµsub Î· (Ï€â‚ ğ’Ÿ)    = Ï€â‚ (áµsub Î· ğ’Ÿ)
áµsub Î· (Ï€â‚‚ ğ’Ÿ)    = Ï€â‚‚ (áµsub Î· ğ’Ÿ)
áµsub Î· tt        = tt
áµsub Ïƒ âŒœ ğ’Ÿ âŒ     = âŒœ áµsub Ïƒ ğ’Ÿ âŒ
áµsub Ïƒ (âŒ ğ’Ÿ âŒŸ â„°) = âŒ áµsub Ïƒ ğ’Ÿ âŒŸ (áµsub (áµliftâ‚› Ïƒ) â„°)

sub : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î” â Î âŠ¢ A
                  â†’ Î” â Î“ âŠ¢ A
sub Ïƒ (áµáµ› i)    = áµáµ› i
sub Ïƒ (áµ› i)     = lookupâ‚› Ïƒ i
sub Ïƒ (Æ› ğ’Ÿ)     = Æ› (sub (liftâ‚› Ïƒ) ğ’Ÿ)
sub Ïƒ (ğ’Ÿ $ â„°)   = sub Ïƒ ğ’Ÿ $ sub Ïƒ â„°
sub Î· (ğ’Ÿ , â„°)   = sub Î· ğ’Ÿ , sub Î· â„°
sub Î· (Ï€â‚ ğ’Ÿ)    = Ï€â‚ (sub Î· ğ’Ÿ)
sub Î· (Ï€â‚‚ ğ’Ÿ)    = Ï€â‚‚ (sub Î· ğ’Ÿ)
sub Î· tt        = tt
sub Ïƒ âŒœ ğ’Ÿ âŒ     = âŒœ ğ’Ÿ âŒ
sub Ïƒ (âŒ ğ’Ÿ âŒŸ â„°) = âŒ sub Ïƒ ğ’Ÿ âŒŸ (sub (áµwkâ‚› Ïƒ) â„°)


--------------------------------------------------------------------------------
--
-- Semantics


-- Introspective Kripke models
record ğ” : Setâ‚ where
  field
    ğ’²    : Set

    _ğ’±_  : ğ’² â†’ TVar â†’ Set

    _â‰¥_  : ğ’² â†’ ğ’² â†’ Set

    idâ‚  : âˆ€ {w} â†’ w â‰¥ w

    _âˆ˜â‚_ : âˆ€ {w wâ€² wâ€³} â†’ wâ€² â‰¥ w â†’ wâ€³ â‰¥ wâ€²
                       â†’ wâ€³ â‰¥ w

    reláµ¥ : âˆ€ {x w wâ€²} â†’ wâ€² â‰¥ w â†’ w ğ’± x
                      â†’ wâ€² ğ’± x

    âŒŠ_âŒ‹  : ğ’² â†’ Cx

    âŒŠ_âŒ‹â‚ : âˆ€ {w wâ€²} â†’ wâ€² â‰¥ w
                    â†’ âŒŠ wâ€² âŒ‹ âŠ‡Â² âŒŠ w âŒ‹

open ğ” {{â€¦}} public


áµâŒŠ_âŒ‹ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List Tp
áµâŒŠ w âŒ‹ = projâ‚ âŒŠ w âŒ‹

áµâŒŠ_âŒ‹â‚ : âˆ€ {{ğ” : ğ”}} {w wâ€²} â†’ wâ€² â‰¥ w
                           â†’ áµâŒŠ wâ€² âŒ‹ âŠ‡ áµâŒŠ w âŒ‹
áµâŒŠ Î· âŒ‹â‚ = projâ‚ âŒŠ Î· âŒ‹â‚


-- Values
mutual
  infix 3 _âŠ©_
  _âŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ Tp â†’ Set

  w âŠ© áµ—áµ› x  = w ğ’± x

  w âŠ© A âŠƒ B = âˆ€ {wâ€²} â†’ (Î· : wâ€² â‰¥ w) (k : wâ€² âŠ©â‚– A)
                      â†’ wâ€² âŠ©â‚– B

  w âŠ© A âˆ§ B = w âŠ©â‚– A Ã— w âŠ©â‚– B

  w âŠ© TT    = âŠ¤

  w âŠ© â–¡ A   = w áµâŠ©â‚– A

  infix 3 _âŠ©â‚–_
  _âŠ©â‚–_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ Tp â†’ Set
  w âŠ©â‚– A = âˆ€ {wâ€² C} â†’ (Î· : wâ€² â‰¥ w) (f : âˆ€ {wâ€³} â†’ wâ€³ â‰¥ wâ€² â†’ wâ€³ âŠ© A
                                                 â†’ âŒŠ wâ€³ âŒ‹ âŠ¢â‚™â‚˜ C)
                     â†’ âŒŠ wâ€² âŒ‹ âŠ¢â‚™â‚˜ C

  infix 3 _áµâŠ©â‚–_
  _áµâŠ©â‚–_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ Tp â†’ Set
  w áµâŠ©â‚– A = áµâŒŠ w âŒ‹ â âˆ… âŠ¢ A Ã— w âŠ©â‚– A


syn : âˆ€ {{ğ” : ğ”}} {w A} â†’ w áµâŠ©â‚– A
                        â†’ áµâŒŠ w âŒ‹ â âˆ… âŠ¢ A
syn p = projâ‚ p

sem : âˆ€ {{ğ” : ğ”}} {w A} â†’ w áµâŠ©â‚– A
                        â†’ w âŠ©â‚– A
sem p = projâ‚‚ p


-- Environments
infix 3 _âŠ©â‚–â‹†_
_âŠ©â‚–â‹†_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List Tp â†’ Set
w âŠ©â‚–â‹† Î = All (w âŠ©â‚–_) Î

infix 3 _áµâŠ©â‚–â‹†_
_áµâŠ©â‚–â‹†_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List Tp â†’ Set
w áµâŠ©â‚–â‹† Î = All (w áµâŠ©â‚–_) Î


synâ‹† : âˆ€ {{ğ” : ğ”}} {w Î} â†’ w áµâŠ©â‚–â‹† Î
                         â†’ áµâŒŠ w âŒ‹ â âˆ… âŠ¢â‹† Î
synâ‹† Î´ = mapâ‚ syn Î´

semâ‹† : âˆ€ {{ğ” : ğ”}} {w Î} â†’ w áµâŠ©â‚–â‹† Î
                         â†’ w âŠ©â‚–â‹† Î
semâ‹† Î´ = mapâ‚ sem Î´


-- Semantic entailment
infix 3 _âŠ¨_
_âŠ¨_ : Cx â†’ Tp â†’ Setâ‚
Î” â Î“ âŠ¨ A = âˆ€ {{ğ” : ğ”}} {w} â†’ w áµâŠ©â‚–â‹† Î” â†’ w âŠ©â‚–â‹† Î“
                             â†’ w âŠ©â‚– A


-- Accessibility
mutual
  rel : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w âŠ© A
                             â†’ wâ€² âŠ© A
  rel {áµ—áµ› x}  Î· v = reláµ¥ Î· v
  rel {A âŠƒ B} Î· f = Î» Î·â€² â†’ f (Î· âˆ˜â‚ Î·â€²)
  rel {A âˆ§ B} Î· p = relâ‚– {A} Î· (projâ‚ p) , relâ‚– {B} Î· (projâ‚‚ p)
  rel {TT}    Î· t = tt
  rel {â–¡ A}   Î· p = áµrelâ‚– Î· p

  relâ‚– : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w âŠ©â‚– A
                              â†’ wâ€² âŠ©â‚– A
  relâ‚– Î· k = Î» Î·â€² f â†’ k (Î· âˆ˜â‚ Î·â€²) f

  áµrelâ‚– : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâŠ©â‚– A
                               â†’ wâ€² áµâŠ©â‚– A
  áµrelâ‚– {A} Î· p = áµren áµâŒŠ Î· âŒ‹â‚ (syn p) , relâ‚– {A} Î· (sem p)


relâ‚–â‹† : âˆ€ {{ğ” : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w âŠ©â‚–â‹† Î
                             â†’ wâ€² âŠ©â‚–â‹† Î
-- TODO: Why does Agda require me to add seemingly unused annotations here?
-- relâ‚–â‹† Î· Î³ = mapAll (relâ‚– Î·) Î³
relâ‚–â‹† Î· Î³ = mapâ‚ (Î» {A} k {_} {_} â†’ relâ‚– {A} Î· (k {_})) Î³

áµrelâ‚–â‹† : âˆ€ {{ğ” : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâŠ©â‚–â‹† Î
                              â†’ wâ€² áµâŠ©â‚–â‹† Î
áµrelâ‚–â‹† Î· Î´ = mapâ‚ (áµrelâ‚– Î·) Î´


-- Kripke continuation monad
unit : âˆ€ {{ğ” : ğ”}} {A w} â†’ w âŠ© A
                           â†’ w âŠ©â‚– A
unit {A} a = Î» Î· f â†’
               f idâ‚ (rel {A} Î· a)

bind : âˆ€ {{ğ” : ğ”}} {A C w} â†’ w âŠ©â‚– A â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² âŠ© A
                                                 â†’ wâ€² âŠ©â‚– C)
                           â†’ w âŠ©â‚– C
bind k f = Î» Î· fâ€² â†’
             k Î· (Î» Î·â€² a â†’
               f (Î· âˆ˜â‚ Î·â€²) a idâ‚ (Î» Î·â€³ b â†’
                 fâ€² (Î·â€² âˆ˜â‚ Î·â€³) b))


lookup : âˆ€ {{ğ” : ğ”}} {Î A w} â†’ w âŠ©â‚–â‹† Î â†’ Î âˆ‹ A
                             â†’ w âŠ©â‚– A
lookup Î³ i = lookupâ‚ Î³ i


-- Soundness
â†“ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
              â†’ Î” â Î“ âŠ¨ A
â†“ (áµáµ› i)            = Î» Î´ Î³ â†’ lookup (semâ‹† Î´) i
â†“ (áµ› i)             = Î» Î´ Î³ â†’ lookup Î³ i
â†“ (Æ› {A} {B} ğ’Ÿ)     = Î» Î´ Î³ â†’ unit {A âŠƒ B} (Î» Î· k â†’
                        â†“ ğ’Ÿ (áµrelâ‚–â‹† Î· Î´) (relâ‚–â‹† Î· Î³ , k))
â†“ (_$_ {A} {B} ğ’Ÿ â„°) = Î» Î´ Î³ â†’ bind {A âŠƒ B} {B} (â†“ ğ’Ÿ Î´ Î³) (Î» Î· f â†’
                        f idâ‚ (â†“ â„° (áµrelâ‚–â‹† Î· Î´) (relâ‚–â‹† Î· Î³)))
â†“ (_,_ {A} {B} ğ’Ÿ â„°) = Î» Î´ Î³ â†’ unit {A âˆ§ B} (â†“ ğ’Ÿ Î´ Î³ , â†“ â„° Î´ Î³)
â†“ (Ï€â‚ {A} {B} ğ’Ÿ)    = Î» Î´ Î³ â†’ bind {A âˆ§ B} {A} (â†“ ğ’Ÿ Î´ Î³) (Î» Î· p â†’
                        projâ‚ p)
â†“ (Ï€â‚‚ {A} {B} ğ’Ÿ)    = Î» Î´ Î³ â†’ bind {A âˆ§ B} {B} (â†“ ğ’Ÿ Î´ Î³) (Î» Î· p â†’
                        projâ‚‚ p)
â†“ tt                = Î» Î´ Î³ â†’ unit {TT} tt
â†“ (âŒœ_âŒ {A} ğ’Ÿ)       = Î» Î´ Î³ â†’ unit {â–¡ A} (áµsub (synâ‹† Î´) ğ’Ÿ , â†“ ğ’Ÿ Î´ âˆ…)
â†“ (âŒ_âŒŸ {A} {C} ğ’Ÿ â„°) = Î» Î´ Î³ â†’ bind {â–¡ A} {C} (â†“ ğ’Ÿ Î´ Î³) (Î» Î· p â†’
                        â†“ â„° (áµrelâ‚–â‹† Î· Î´ , p) (relâ‚–â‹† Î· Î³))


--------------------------------------------------------------------------------
--
-- Completeness


-- Universal model
instance
  ğ”áµ¤ : ğ”
  ğ”áµ¤ = record
         { ğ’²    = Cx
         ; _ğ’±_  = _ğ’±áµ¤_
         ; _â‰¥_  = _âŠ‡Â²_
         ; idâ‚  = idáµ£Â²
         ; _âˆ˜â‚_ = _âˆ˜áµ£Â²_
         ; reláµ¥ = renâ‚™â‚˜Â²
         ; âŒŠ_âŒ‹  = id
         ; âŒŠ_âŒ‹â‚ = id
         }
    where
      infix 3 _ğ’±áµ¤_
      _ğ’±áµ¤_ : Cx â†’ TVar â†’ Set
      Î” â Î“ ğ’±áµ¤ x = Î” â Î“ âŠ¢â‚™â‚˜ áµ—áµ› x


-- Soundness and completeness with respect to the universal model
mutual
  â†“áµ¤ : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢â‚™â‚œ A
                 â†’ Î” â Î“ âŠ©â‚– A
  â†“áµ¤ {áµ—áµ› x}  ğ’Ÿ = unit {áµ—áµ› x} (â¿áµ— ğ’Ÿ)
  â†“áµ¤ {A âŠƒ B} ğ’Ÿ = unit {A âŠƒ B} (Î» Î· k â†’ â†“áµ¤ (renâ‚™â‚œÂ² Î· ğ’Ÿ $ â†‘áµ¤ k))
  â†“áµ¤ {A âˆ§ B} ğ’Ÿ = unit {A âˆ§ B} (â†“áµ¤ (Ï€â‚ ğ’Ÿ) , â†“áµ¤ (Ï€â‚‚ ğ’Ÿ))
  â†“áµ¤ {TT}    ğ’Ÿ = unit {TT} tt
  â†“áµ¤ {â–¡ A}   ğ’Ÿ = Î» Î· f â†’ âŒ renâ‚™â‚œÂ² Î· ğ’Ÿ âŒŸ (f (áµwkÂ² idáµ£Â²) (áµáµ› zero , â†“áµ¤ (áµáµ› zero)))

  â†‘áµ¤ : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ©â‚– A
                 â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
  â†‘áµ¤ {áµ—áµ› x}  k = k idáµ£Â² (Î» Î· v â†’ v)
  â†‘áµ¤ {A âŠƒ B} k = k idáµ£Â² (Î» Î· f â†’ Æ› (â†‘áµ¤ (f (wkÂ² idáµ£Â²) (â†“áµ¤ (áµ› zero)))))
  â†‘áµ¤ {A âˆ§ B} k = k idáµ£Â² (Î» Î· p â†’ â†‘áµ¤ (projâ‚ p) , â†‘áµ¤ (projâ‚‚ p))
  â†‘áµ¤ {TT}    k = k idáµ£Â² (Î» Î· t â†’ tt)
  â†‘áµ¤ {â–¡ A}   k = k idáµ£Â² (Î» Î· p â†’ âŒœ syn p âŒ)


áµidâ‚‘ : âˆ€ {Î” Î“} â†’ Î” â Î“ áµâŠ©â‚–â‹† Î”
áµidâ‚‘ {âˆ…}     = âˆ…
áµidâ‚‘ {Î” , A} = áµrelâ‚–â‹† (áµwkÂ² idáµ£Â²) áµidâ‚‘ , (áµáµ› zero , â†“áµ¤ (áµáµ› zero))

idâ‚‘ : âˆ€ {Î“ Î”} â†’ Î” â Î“ âŠ©â‚–â‹† Î“
idâ‚‘ {âˆ…}     = âˆ…
idâ‚‘ {Î“ , A} = relâ‚–â‹† (wkÂ² idáµ£Â²) idâ‚‘ , â†“áµ¤ (áµ› zero)


-- Completeness
â†‘ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¨ A
              â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
â†‘ f = â†‘áµ¤ (f áµidâ‚‘ idâ‚‘)


-- Normalisation
nm : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A
               â†’ Î” â Î“ âŠ¢â‚™â‚˜ A
nm = â†‘ âˆ˜ â†“


--------------------------------------------------------------------------------
--
-- Examples


áµáµ›0 : âˆ€ {Î” Î“ A} â†’ Î” , A â Î“ âŠ¢ A
áµáµ›0 = áµáµ› zero

áµáµ›1 : âˆ€ {Î” Î“ A B} â†’ Î” , A , B â Î“ âŠ¢ A
áµáµ›1 = áµáµ› (suc zero)

áµáµ›2 : âˆ€ {Î” Î“ A B C} â†’ Î” , A , B , C â Î“ âŠ¢ A
áµáµ›2 = áµáµ› (suc (suc zero))


áµ›0 : âˆ€ {Î” Î“ A} â†’ Î” â Î“ , A âŠ¢ A
áµ›0 = áµ› zero

áµ›1 : âˆ€ {Î” Î“ A B} â†’ Î” â Î“ , A , B âŠ¢ A
áµ›1 = áµ› (suc zero)

áµ›2 : âˆ€ {Î” Î“ A B C} â†’ Î” â Î“ , A , B , C âŠ¢ A
áµ›2 = áµ› (suc (suc zero))


áµƒË£I : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢ A âŠƒ A
áµƒË£I = Æ› áµ›0

áµƒË£K : âˆ€ {A B Î” Î“} â†’ Î” â Î“ âŠ¢ A âŠƒ B âŠƒ A
áµƒË£K = Æ› (Æ› áµ›1)

áµƒË£S : âˆ€ {A B C Î” Î“} â†’ Î” â Î“ âŠ¢ (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
áµƒË£S = Æ› (Æ› (Æ› ((áµ›2 $ áµ›0) $ (áµ›1 $ áµ›0))))


áµƒË£D : âˆ€ {A B Î” Î“} â†’ Î” â Î“ âŠ¢ â–¡ (A âŠƒ B) âŠƒ â–¡ A âŠƒ â–¡ B
áµƒË£D = Æ› (Æ› (âŒ áµ›1 âŒŸ (âŒ áµ›0 âŒŸ âŒœ áµáµ›1 $ áµáµ›0 âŒ)))

áµƒË£T : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢ â–¡ A âŠƒ A
áµƒË£T = Æ› (âŒ áµ›0 âŒŸ áµáµ›0)

áµƒË£4 : âˆ€ {A Î” Î“} â†’ Î” â Î“ âŠ¢ â–¡ A âŠƒ â–¡ â–¡ A
áµƒË£4 = Æ› (âŒ áµ›0 âŒŸ âŒœ âŒœ áµáµ›0 âŒ âŒ)


--------------------------------------------------------------------------------
--
-- Conversion tests


testâˆ¼ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¢ A â†’ Î” â Î“ âŠ¢ A â†’ Set
testâˆ¼ ğ’Ÿâ‚ ğ’Ÿâ‚‚ = embâ‚™â‚˜ (nm ğ’Ÿâ‚) â‰¡ ğ’Ÿâ‚‚


-- redâŠƒ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ , A âŠ¢ B) (â„° : Î” â Î“ âŠ¢ A)
--                    â†’ Æ› ğ’Ÿ $ â„° âˆ¼ sub (idâ‚› , â„°) ğ’Ÿ

testâˆ¼redâŠƒ : testâˆ¼ {âˆ…} {âˆ… , "A"}
                  ((Æ› áµ›0) $ áµ›0)
                  áµ›0
testâˆ¼redâŠƒ = refl


-- redâˆ§â‚ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A) (â„° : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚ (ğ’Ÿ , â„°) âˆ¼ ğ’Ÿ

testâˆ¼redâˆ§â‚ : testâˆ¼ {âˆ…} {âˆ… , "A" , "B"}
                   (Ï€â‚ (áµ›1 , áµ›0))
                   áµ›1
testâˆ¼redâˆ§â‚ = refl


-- redâˆ§â‚‚ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A) (â„° : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚‚ (ğ’Ÿ , â„°) âˆ¼ â„°

testâˆ¼redâˆ§â‚‚ : testâˆ¼ {âˆ…} {âˆ… , "A" , "B"}
                   (Ï€â‚‚ (áµ›1 , áµ›0))
                   áµ›0
testâˆ¼redâˆ§â‚‚ = refl


-- redâ–¡ : âˆ€ {Î” Î“ A C} â†’ (ğ’Ÿ : Î” â âˆ… âŠ¢ A) (â„° : Î” , A â Î“ âŠ¢ C)
--                    â†’ âŒ âŒœ ğ’Ÿ âŒ âŒŸ â„° âˆ¼ áµsub (áµidâ‚› , ğ’Ÿ) â„°

testâˆ¼redâ–¡ : testâˆ¼ {âˆ… , "A"} {âˆ…}
                  (âŒ âŒœ áµáµ›0 âŒ âŒŸ áµáµ›0)
                  áµáµ›0
testâˆ¼redâ–¡ = refl


-- expâŠƒ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âŠƒ B)
--                    â†’ ğ’Ÿ âˆ¼ Æ› (ren (wk idáµ£) ğ’Ÿ $ áµ›0)

testâˆ¼expâŠƒ : testâˆ¼ {âˆ…} {âˆ… , "A" âŠƒ "B"}
                  áµ›0
                  (Æ› (ren (wk idáµ£) áµ›0 $ áµ›0))
testâˆ¼expâŠƒ = refl


-- expâˆ§ : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âˆ§ B)
--                    â†’ ğ’Ÿ âˆ¼ Ï€â‚ ğ’Ÿ , Ï€â‚‚ ğ’Ÿ

testâˆ¼expâˆ§ : testâˆ¼ {âˆ…} {âˆ… , "A" âˆ§ "B"}
                  áµ›0
                  (Ï€â‚ áµ›0 , Ï€â‚‚ áµ›0)
testâˆ¼expâˆ§ = refl


-- expTT : âˆ€ {Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ ğ”—)
--                 â†’ ğ’Ÿ âˆ¼ tt

testâˆ¼expTT : testâˆ¼ {âˆ…} {âˆ… , TT}
                   áµ›0
                   tt
testâˆ¼expTT = refl


-- expâ–¡ : âˆ€ {Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ â–¡ A)
--                â†’ ğ’Ÿ âˆ¼ âŒ ğ’Ÿ âŒŸ âŒœ áµáµ›0 âŒ

testâˆ¼expâ–¡ : testâˆ¼ {âˆ…} {âˆ… , â–¡ "A"}
                  áµ›0
                  (âŒ áµ›0 âŒŸ âŒœ áµáµ›0 âŒ)
testâˆ¼expâ–¡ = refl


-- commâ–¡$ : âˆ€ {Î” Î“ A B} â†’ (ğ’¬ : Î” â Î“ âŠ¢ â–¡ (A âŠƒ B))
--                         (ğ’Ÿ : Î” , A âŠƒ B â Î“ âŠ¢ A âŠƒ B) (â„° : Î” â Î“ âŠ¢ A)
--                      â†’ (âŒ ğ’¬ âŒŸ ğ’Ÿ) $ â„° âˆ¼ âŒ ğ’¬ âŒŸ (ğ’Ÿ $ (áµren (wk idáµ£) â„°))

testâˆ¼commâ–¡$ : testâˆ¼ {âˆ…} {âˆ… , â–¡ ("A" âŠƒ "B") , "A"}
                    ((âŒ áµ›1 âŒŸ áµáµ›0) $ áµ›0)
                    (âŒ áµ›1 âŒŸ (áµáµ›0 $ áµren (wk idáµ£) áµ›0))
testâˆ¼commâ–¡$ = refl


-- commâ–¡âŒâŒŸ : âˆ€ {Î” Î“ A C} â†’ (ğ’¬ : Î” â Î“ âŠ¢ â–¡ â–¡ A)
--                          (ğ’Ÿ : Î” , â–¡ A â Î“ âŠ¢ â–¡ A) (â„° : Î” , A â Î“ âŠ¢ C)
--                       â†’ âŒ (âŒ ğ’¬ âŒŸ ğ’Ÿ) âŒŸ â„° âˆ¼ âŒ ğ’¬ âŒŸ (âŒ ğ’Ÿ âŒŸ (áµren (wk idáµ£) â„°))

testâˆ¼commâ–¡âŒâŒŸ : testâˆ¼ {âˆ…} {âˆ… , â–¡ â–¡ "A"}
                     (âŒ âŒ áµ›0 âŒŸ áµáµ›0 âŒŸ áµáµ›0)
                     (âŒ áµ›0 âŒŸ (âŒ áµáµ›0 âŒŸ áµáµ›0))
testâˆ¼commâ–¡âŒâŒŸ = refl


-- commâ–¡Ï€â‚ : âˆ€ {Î” Î“ A B} â†’ (ğ’¬ : Î” â Î“ âŠ¢ â–¡ (A âˆ§ B))
--                          (ğ’Ÿ : Î” , A âˆ§ B â Î“ âŠ¢ A âˆ§ B)
--                       â†’ Ï€â‚ (âŒ ğ’¬ âŒŸ ğ’Ÿ) âˆ¼ âŒ ğ’¬ âŒŸ (Ï€â‚ ğ’Ÿ)

testâˆ¼commâ–¡Ï€â‚ : testâˆ¼ {âˆ…} {âˆ… , â–¡ ("A" âˆ§ "B")}
                     (Ï€â‚ (âŒ áµ›0 âŒŸ áµáµ›0))
                     (âŒ áµ›0 âŒŸ (Ï€â‚ áµáµ›0))
testâˆ¼commâ–¡Ï€â‚ = refl


-- commâ–¡Ï€â‚‚ : âˆ€ {Î” Î“ A B} â†’ (ğ’¬ : Î” â Î“ âŠ¢ â–¡ (A âˆ§ B))
--                          (ğ’Ÿ : Î” , A âˆ§ B â Î“ âŠ¢ A âˆ§ B)
--                       â†’ Ï€â‚‚ (âŒ ğ’¬ âŒŸ ğ’Ÿ) âˆ¼ âŒ ğ’¬ âŒŸ (Ï€â‚‚ ğ’Ÿ)

testâˆ¼commâ–¡Ï€â‚‚ : testâˆ¼ {âˆ…} {âˆ… , â–¡ ("A" âˆ§ "B")}
                     (Ï€â‚‚ (âŒ áµ›0 âŒŸ áµáµ›0))
                     (âŒ áµ›0 âŒŸ (Ï€â‚‚ áµáµ›0))
testâˆ¼commâ–¡Ï€â‚‚ = refl


--------------------------------------------------------------------------------
--
-- Self-interpretation


-- weakBP : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A)
--                      â†’ TT $ âŒœ ğ’Ÿ âŒ âˆ¼ âŒœ ğ’Ÿ âŒ

testâˆ¼weakBP : testâˆ¼ {âˆ… , "A"} {âˆ…}
                    (áµƒË£T $ âŒœ áµáµ›0 âŒ)
                    áµáµ›0
testâˆ¼weakBP = refl


-- Andrej : âˆ€ {Î” Î“ A B} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A âŠƒ B) (â„° : Î” â Î“ âŠ¢ A)
--                      â†’ (ğ”» $ âŒœ ğ’Ÿ âŒ) $ âŒœ â„° âŒ âˆ¼ âŒœ ğ’Ÿ $ â„° âŒ

testâˆ¼Andrej : testâˆ¼ {âˆ… , "A" âŠƒ "B" , "A"} {âˆ…}
                    ((áµƒË£D $ âŒœ áµáµ›1 âŒ) $ âŒœ áµáµ›0 âŒ)
                    (âŒœ áµáµ›1 $ áµáµ›0 âŒ)
testâˆ¼Andrej = refl


--------------------------------------------------------------------------------

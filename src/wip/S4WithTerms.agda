{-# OPTIONS --rewriting #-}

module S4WithTerms where

open import Prelude public


--------------------------------------------------------------------------------
--
-- Syntax


-- Type variables
data TVar : Set where
  tvar : String â†’ TVar

injtvar : âˆ€ {sâ‚ sâ‚‚} â†’ tvar sâ‚ â‰¡ tvar sâ‚‚ â†’ sâ‚ â‰¡ sâ‚‚
injtvar refl = refl

_â‰Ÿâ‚œáµ¥_ : (xâ‚ xâ‚‚ : TVar) â†’ Dec (xâ‚ â‰¡ xâ‚‚)
tvar sâ‚ â‰Ÿâ‚œáµ¥ tvar sâ‚‚ = mapDec (tvar &_) injtvar (sâ‚ â‰Ÿâ‚› sâ‚‚)

instance
  tvarIsString : IsString TVar
  tvarIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ tvar s
      }


-- Types
infixl 9 _âˆ§_
infixr 7 _âŠƒ_
data ğ’¯ : Set where
  áµ—áµ›  : (x : TVar) â†’ ğ’¯
  _âŠƒ_ : (A B : ğ’¯) â†’ ğ’¯
  _âˆ§_ : (A B : ğ’¯) â†’ ğ’¯
  ğ•‹   : ğ’¯
  â–¡_  : (A : ğ’¯) â†’ ğ’¯

instance
  typeIsString : IsString ğ’¯
  typeIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ áµ—áµ› (tvar s)
      }


injáµ—áµ› : âˆ€ {xâ‚ xâ‚‚} â†’ áµ—áµ› xâ‚ â‰¡ áµ—áµ› xâ‚‚ â†’ xâ‚ â‰¡ xâ‚‚
injáµ—áµ› refl = refl

injâŠƒâ‚ : âˆ€ {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚} â†’ Aâ‚ âŠƒ Bâ‚ â‰¡ Aâ‚‚ âŠƒ Bâ‚‚ â†’ Aâ‚ â‰¡ Aâ‚‚
injâŠƒâ‚ refl = refl

injâŠƒâ‚‚ : âˆ€ {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚} â†’ Aâ‚ âŠƒ Bâ‚ â‰¡ Aâ‚‚ âŠƒ Bâ‚‚ â†’ Bâ‚ â‰¡ Bâ‚‚
injâŠƒâ‚‚ refl = refl

injâˆ§â‚ : âˆ€ {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚} â†’ Aâ‚ âˆ§ Bâ‚ â‰¡ Aâ‚‚ âˆ§ Bâ‚‚ â†’ Aâ‚ â‰¡ Aâ‚‚
injâˆ§â‚ refl = refl

injâˆ§â‚‚ : âˆ€ {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚} â†’ Aâ‚ âˆ§ Bâ‚ â‰¡ Aâ‚‚ âˆ§ Bâ‚‚ â†’ Bâ‚ â‰¡ Bâ‚‚
injâˆ§â‚‚ refl = refl

injâ–¡ : âˆ€ {Aâ‚ Aâ‚‚} â†’ â–¡ Aâ‚ â‰¡ â–¡ Aâ‚‚ â†’ Aâ‚ â‰¡ Aâ‚‚
injâ–¡ refl = refl


_â‰Ÿâ‚œâ‚š_ : (Aâ‚ Aâ‚‚ : ğ’¯) â†’ Dec (Aâ‚ â‰¡ Aâ‚‚)

áµ—áµ› xâ‚ â‰Ÿâ‚œâ‚š áµ—áµ› xâ‚‚     with xâ‚ â‰Ÿâ‚œáµ¥ xâ‚‚
...                 | yes refl = yes refl
...                 | no xâ‚â‰¢xâ‚‚ = no (xâ‚â‰¢xâ‚‚ âˆ˜ injáµ—áµ›)
áµ—áµ› xâ‚ â‰Ÿâ‚œâ‚š (Aâ‚‚ âŠƒ Bâ‚‚) = no (Î» ())
áµ—áµ› xâ‚ â‰Ÿâ‚œâ‚š (Aâ‚‚ âˆ§ Bâ‚‚) = no (Î» ())
áµ—áµ› xâ‚ â‰Ÿâ‚œâ‚š ğ•‹         = no (Î» ())
áµ—áµ› xâ‚ â‰Ÿâ‚œâ‚š (â–¡ Aâ‚‚)    = no (Î» ())

(Aâ‚ âŠƒ Bâ‚) â‰Ÿâ‚œâ‚š áµ—áµ› xâ‚‚     = no (Î» ())
(Aâ‚ âŠƒ Bâ‚) â‰Ÿâ‚œâ‚š (Aâ‚‚ âŠƒ Bâ‚‚) with Aâ‚ â‰Ÿâ‚œâ‚š Aâ‚‚ | Bâ‚ â‰Ÿâ‚œâ‚š Bâ‚‚
...                     | yes refl | yes refl = yes refl
...                     | yes refl | no Bâ‚â‰¢Bâ‚‚ = no (Bâ‚â‰¢Bâ‚‚ âˆ˜ injâŠƒâ‚‚)
...                     | no Aâ‚â‰¢Aâ‚‚ | _        = no (Aâ‚â‰¢Aâ‚‚ âˆ˜ injâŠƒâ‚)
(Aâ‚ âŠƒ Bâ‚) â‰Ÿâ‚œâ‚š (Aâ‚‚ âˆ§ Bâ‚‚) = no (Î» ())
(Aâ‚ âŠƒ Bâ‚) â‰Ÿâ‚œâ‚š ğ•‹         = no (Î» ())
(Aâ‚ âŠƒ Bâ‚) â‰Ÿâ‚œâ‚š (â–¡ Aâ‚‚)    = no (Î» ())

(Aâ‚ âˆ§ Bâ‚) â‰Ÿâ‚œâ‚š áµ—áµ› xâ‚‚     = no (Î» ())
(Aâ‚ âˆ§ Bâ‚) â‰Ÿâ‚œâ‚š (Aâ‚‚ âŠƒ Bâ‚‚) = no (Î» ())
(Aâ‚ âˆ§ Bâ‚) â‰Ÿâ‚œâ‚š (Aâ‚‚ âˆ§ Bâ‚‚) with Aâ‚ â‰Ÿâ‚œâ‚š Aâ‚‚ | Bâ‚ â‰Ÿâ‚œâ‚š Bâ‚‚
...                     | yes refl | yes refl = yes refl
...                     | yes refl | no Bâ‚â‰¢Bâ‚‚ = no (Bâ‚â‰¢Bâ‚‚ âˆ˜ injâˆ§â‚‚)
...                     | no Aâ‚â‰¢Aâ‚‚ | _        = no (Aâ‚â‰¢Aâ‚‚ âˆ˜ injâˆ§â‚)
(Aâ‚ âˆ§ Bâ‚) â‰Ÿâ‚œâ‚š ğ•‹         = no (Î» ())
(Aâ‚ âˆ§ Bâ‚) â‰Ÿâ‚œâ‚š (â–¡ Aâ‚‚)    = no (Î» ())

ğ•‹ â‰Ÿâ‚œâ‚š áµ—áµ› xâ‚‚     = no (Î» ())
ğ•‹ â‰Ÿâ‚œâ‚š (Aâ‚‚ âŠƒ Bâ‚‚) = no (Î» ())
ğ•‹ â‰Ÿâ‚œâ‚š (Aâ‚‚ âˆ§ Bâ‚‚) = no (Î» ())
ğ•‹ â‰Ÿâ‚œâ‚š ğ•‹         = yes refl
ğ•‹ â‰Ÿâ‚œâ‚š (â–¡ Aâ‚‚)    = no (Î» ())

(â–¡ Aâ‚) â‰Ÿâ‚œâ‚š áµ—áµ› xâ‚‚     = no (Î» ())
(â–¡ Aâ‚) â‰Ÿâ‚œâ‚š (Aâ‚‚ âŠƒ Bâ‚‚) = no (Î» ())
(â–¡ Aâ‚) â‰Ÿâ‚œâ‚š (Aâ‚‚ âˆ§ Bâ‚‚) = no (Î» ())
(â–¡ Aâ‚) â‰Ÿâ‚œâ‚š ğ•‹         = no (Î» ())
(â–¡ Aâ‚) â‰Ÿâ‚œâ‚š (â–¡ Aâ‚‚)    with Aâ‚ â‰Ÿâ‚œâ‚š Aâ‚‚
...                  | yes refl = yes refl
...                  | no Aâ‚â‰¢Aâ‚‚ = no (Aâ‚â‰¢Aâ‚‚ âˆ˜ injâ–¡)


-- Modal variables
data MVar : Set where
  mvar : String â†’ MVar

injmvar : âˆ€ {sâ‚ sâ‚‚} â†’ mvar sâ‚ â‰¡ mvar sâ‚‚ â†’ sâ‚ â‰¡ sâ‚‚
injmvar refl = refl

_â‰Ÿâ‚˜áµ¥_ : (xâ‚ xâ‚‚ : MVar) â†’ Dec (xâ‚ â‰¡ xâ‚‚)
mvar sâ‚ â‰Ÿâ‚˜áµ¥ mvar sâ‚‚ = mapDec (mvar &_) injmvar (sâ‚ â‰Ÿâ‚› sâ‚‚)

instance
  mvarIsString : IsString MVar
  mvarIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ mvar s
      }


-- Regular variables
data RVar : Set where
  rvar : String â†’ RVar

injrvar : âˆ€ {sâ‚ sâ‚‚} â†’ rvar sâ‚ â‰¡ rvar sâ‚‚ â†’ sâ‚ â‰¡ sâ‚‚
injrvar refl = refl

_â‰Ÿáµ£áµ¥_ : (xâ‚ xâ‚‚ : RVar) â†’ Dec (xâ‚ â‰¡ xâ‚‚)
rvar sâ‚ â‰Ÿáµ£áµ¥ rvar sâ‚‚ = mapDec (rvar &_) injrvar (sâ‚ â‰Ÿâ‚› sâ‚‚)

instance
  rvarIsString : IsString RVar
  rvarIsString =
    record
      { Constraint = Î» s â†’ âŠ¤
      ; fromString = Î» s â†’ rvar s
      }


-- Terms
data Term : Set where
  áµáµ›     : (x : MVar) â†’ Term
  Ê³áµ›     : (x : RVar) â†’ Term
  Æ›_âˆ™_   : (x : RVar) (M : Term) â†’ Term
  _$_    : (M N : Term) â†’ Term
  _,_    : (M N : Term) â†’ Term
  Ï€â‚     : (M : Term) â†’ Term
  Ï€â‚‚     : (M : Term) â†’ Term
  tt     : Term
  âŒœ_âŒ    : (M : Term) â†’ Term
  âŒ_âŒŸ_âˆ™_ : (M : Term) (x : MVar) (N : Term) â†’ Term
  _â¦‚_    : (M : Term) (A : ğ’¯) â†’ Term


injáµáµ› : âˆ€ {xâ‚ xâ‚‚} â†’ áµáµ› xâ‚ â‰¡ áµáµ› xâ‚‚ â†’ xâ‚ â‰¡ xâ‚‚
injáµáµ› refl = refl

injÊ³áµ› : âˆ€ {xâ‚ xâ‚‚} â†’ Ê³áµ› xâ‚ â‰¡ Ê³áµ› xâ‚‚ â†’ xâ‚ â‰¡ xâ‚‚
injÊ³áµ› refl = refl

injÆ›â‚ : âˆ€ {xâ‚ xâ‚‚ Mâ‚ Mâ‚‚} â†’ Æ› xâ‚ âˆ™ Mâ‚ â‰¡ Æ› xâ‚‚ âˆ™ Mâ‚‚ â†’ xâ‚ â‰¡ xâ‚‚
injÆ›â‚ refl = refl

injÆ›â‚‚ : âˆ€ {xâ‚ xâ‚‚ Mâ‚ Mâ‚‚} â†’ Æ› xâ‚ âˆ™ Mâ‚ â‰¡ Æ› xâ‚‚ âˆ™ Mâ‚‚ â†’ Mâ‚ â‰¡ Mâ‚‚
injÆ›â‚‚ refl = refl

inj$â‚ : âˆ€ {Mâ‚ Mâ‚‚ Nâ‚ Nâ‚‚} â†’ Mâ‚ $ Nâ‚ â‰¡ Mâ‚‚ $ Nâ‚‚ â†’ Mâ‚ â‰¡ Mâ‚‚
inj$â‚ refl = refl

inj$â‚‚ : âˆ€ {Mâ‚ Mâ‚‚ Nâ‚ Nâ‚‚} â†’ Mâ‚ $ Nâ‚ â‰¡ Mâ‚‚ $ Nâ‚‚ â†’ Nâ‚ â‰¡ Nâ‚‚
inj$â‚‚ refl = refl

inj,â‚ : âˆ€ {Mâ‚ Mâ‚‚ Nâ‚ Nâ‚‚} â†’ Mâ‚ Term., Nâ‚ â‰¡ Mâ‚‚ , Nâ‚‚ â†’ Mâ‚ â‰¡ Mâ‚‚
inj,â‚ refl = refl

inj,â‚‚ : âˆ€ {Mâ‚ Mâ‚‚ Nâ‚ Nâ‚‚} â†’ Mâ‚ Term., Nâ‚ â‰¡ Mâ‚‚ , Nâ‚‚ â†’ Nâ‚ â‰¡ Nâ‚‚
inj,â‚‚ refl = refl

injÏ€â‚ : âˆ€ {Mâ‚ Mâ‚‚} â†’ Ï€â‚ Mâ‚ â‰¡ Ï€â‚ Mâ‚‚ â†’ Mâ‚ â‰¡ Mâ‚‚
injÏ€â‚ refl = refl

injÏ€â‚‚ : âˆ€ {Mâ‚ Mâ‚‚} â†’ Ï€â‚‚ Mâ‚ â‰¡ Ï€â‚‚ Mâ‚‚ â†’ Mâ‚ â‰¡ Mâ‚‚
injÏ€â‚‚ refl = refl

injâŒœâŒ : âˆ€ {Mâ‚ Mâ‚‚} â†’ âŒœ Mâ‚ âŒ â‰¡ âŒœ Mâ‚‚ âŒ â†’ Mâ‚ â‰¡ Mâ‚‚
injâŒœâŒ refl = refl

injâŒâŒŸâ‚ : âˆ€ {Mâ‚ Mâ‚‚ xâ‚ xâ‚‚ Nâ‚ Nâ‚‚} â†’ âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚ â‰¡ âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚ â†’ Mâ‚ â‰¡ Mâ‚‚
injâŒâŒŸâ‚ refl = refl

injâŒâŒŸâ‚‚ : âˆ€ {Mâ‚ Mâ‚‚ xâ‚ xâ‚‚ Nâ‚ Nâ‚‚} â†’ âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚ â‰¡ âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚ â†’ xâ‚ â‰¡ xâ‚‚
injâŒâŒŸâ‚‚ refl = refl

injâŒâŒŸâ‚ƒ : âˆ€ {Mâ‚ Mâ‚‚ xâ‚ xâ‚‚ Nâ‚ Nâ‚‚} â†’ âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚ â‰¡ âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚ â†’ Nâ‚ â‰¡ Nâ‚‚
injâŒâŒŸâ‚ƒ refl = refl

injâ¦‚â‚ : âˆ€ {Mâ‚ Mâ‚‚ Aâ‚ Aâ‚‚} â†’ Mâ‚ â¦‚ Aâ‚ â‰¡ Mâ‚‚ â¦‚ Aâ‚‚ â†’ Mâ‚ â‰¡ Mâ‚‚
injâ¦‚â‚ refl = refl

injâ¦‚â‚‚ : âˆ€ {Mâ‚ Mâ‚‚ Aâ‚ Aâ‚‚} â†’ Mâ‚ â¦‚ Aâ‚ â‰¡ Mâ‚‚ â¦‚ Aâ‚‚ â†’ Aâ‚ â‰¡ Aâ‚‚
injâ¦‚â‚‚ refl = refl


_â‰Ÿâ‚œâ‚˜_ : (Mâ‚ Mâ‚‚ : Term) â†’ Dec (Mâ‚ â‰¡ Mâ‚‚)

(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          with xâ‚ â‰Ÿâ‚˜áµ¥ xâ‚‚
...                          | yes refl = yes refl
...                          | no xâ‚â‰¢xâ‚‚ = no (xâ‚â‰¢xâ‚‚ âˆ˜ injáµáµ›)
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , â„•â‚‚)        = no (Î» ())
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
(áµáµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          with xâ‚ â‰Ÿáµ£áµ¥ xâ‚‚
...                          | yes refl = yes refl
...                          | no xâ‚â‰¢xâ‚‚ = no (xâ‚â‰¢xâ‚‚ âˆ˜ injÊ³áµ›)
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        = no (Î» ())
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
(Ê³áµ› xâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      with xâ‚ â‰Ÿáµ£áµ¥ xâ‚‚ | Mâ‚ â‰Ÿâ‚œâ‚˜ Mâ‚‚
...                              | yes refl | yes refl = yes refl
...                              | yes refl | no Mâ‚â‰¢Mâ‚‚ = no (Mâ‚â‰¢Mâ‚‚ âˆ˜ injÆ›â‚‚)
...                              | no xâ‚â‰¢xâ‚‚ | _        = no (xâ‚â‰¢xâ‚‚ âˆ˜ injÆ›â‚)
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        = no (Î» ())
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
(Æ› xâ‚ âˆ™ Mâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        with Mâ‚ â‰Ÿâ‚œâ‚˜ Mâ‚‚ | Nâ‚ â‰Ÿâ‚œâ‚˜ Nâ‚‚
...                            | yes refl | yes refl = yes refl
...                            | yes refl | no Nâ‚â‰¢Nâ‚‚ = no (Nâ‚â‰¢Nâ‚‚ âˆ˜ inj$â‚‚)
...                            | no Mâ‚â‰¢Mâ‚‚ | _        = no (Mâ‚â‰¢Mâ‚‚ âˆ˜ inj$â‚)
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        = no (Î» ())
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
(Mâ‚ $ Nâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        with Mâ‚ â‰Ÿâ‚œâ‚˜ Mâ‚‚ | Nâ‚ â‰Ÿâ‚œâ‚˜ Nâ‚‚
...                            | yes refl | yes refl = yes refl
...                            | yes refl | no Nâ‚â‰¢Nâ‚‚ = no (Nâ‚â‰¢Nâ‚‚ âˆ˜ inj,â‚‚)
...                            | no Mâ‚â‰¢Mâ‚‚ | _        = no (Mâ‚â‰¢Mâ‚‚ âˆ˜ inj,â‚)
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
(Mâ‚ , Nâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        = no (Î» ())
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          with Mâ‚ â‰Ÿâ‚œâ‚˜ Mâ‚‚
...                          | yes refl = yes refl
...                          | no Mâ‚â‰¢Mâ‚‚ = no (Mâ‚â‰¢Mâ‚‚ âˆ˜ injÏ€â‚)
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
(Ï€â‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        = no (Î» ())
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          with Mâ‚ â‰Ÿâ‚œâ‚˜ Mâ‚‚
...                          | yes refl = yes refl
...                          | no Mâ‚â‰¢Mâ‚‚ = no (Mâ‚â‰¢Mâ‚‚ âˆ˜ injÏ€â‚‚)
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
(Ï€â‚‚ Mâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

tt â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
tt â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
tt â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
tt â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
tt â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        = no (Î» ())
tt â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
tt â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
tt â‰Ÿâ‚œâ‚˜ tt               = yes refl
tt â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
tt â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
tt â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        = no (Î» ())
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           with Mâ‚ â‰Ÿâ‚œâ‚˜ Mâ‚‚
...                         | yes refl = yes refl
...                         | no Mâ‚â‰¢Mâ‚‚ = no (Mâ‚â‰¢Mâ‚‚ âˆ˜ injâŒœâŒ)
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
âŒœ Mâ‚ âŒ â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        = no (Î» ())
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) with Mâ‚ â‰Ÿâ‚œâ‚˜ Mâ‚‚ | xâ‚ â‰Ÿâ‚˜áµ¥ xâ‚‚ | Nâ‚ â‰Ÿâ‚œâ‚˜ Nâ‚‚
...                                   | yes refl | yes refl | yes refl = yes refl
...                                   | yes refl | yes refl | no Nâ‚â‰¢Nâ‚‚ = no (Nâ‚â‰¢Nâ‚‚ âˆ˜ injâŒâŒŸâ‚ƒ)
...                                   | yes refl | no xâ‚â‰¢xâ‚‚ | _        = no (xâ‚â‰¢xâ‚‚ âˆ˜ injâŒâŒŸâ‚‚)
...                                   | no Mâ‚â‰¢Mâ‚‚ | _        | _        = no (Mâ‚â‰¢Mâ‚‚ âˆ˜ injâŒâŒŸâ‚)
(âŒ Mâ‚ âŒŸ xâ‚ âˆ™ Nâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        = no (Î» ())

(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ (áµáµ› xâ‚‚)          = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ (Ê³áµ› xâ‚‚)          = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ (Æ› xâ‚‚ âˆ™ Mâ‚‚)      = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ $ Nâ‚‚)        = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ , Nâ‚‚)        = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚ Mâ‚‚)          = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ (Ï€â‚‚ Mâ‚‚)          = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ tt               = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ âŒœ Mâ‚‚ âŒ           = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ (âŒ Mâ‚‚ âŒŸ xâ‚‚ âˆ™ Nâ‚‚) = no (Î» ())
(Mâ‚ â¦‚ Aâ‚) â‰Ÿâ‚œâ‚˜ (Mâ‚‚ â¦‚ Aâ‚‚)        with Mâ‚ â‰Ÿâ‚œâ‚˜ Mâ‚‚ | Aâ‚ â‰Ÿâ‚œâ‚š Aâ‚‚
...                            | yes refl | yes refl = yes refl
...                            | yes refl | no Aâ‚â‰¢Aâ‚‚ = no (Aâ‚â‰¢Aâ‚‚ âˆ˜ injâ¦‚â‚‚)
...                            | no Mâ‚â‰¢Mâ‚‚ | _        = no (Mâ‚â‰¢Mâ‚‚ âˆ˜ injâ¦‚â‚)


-- Contexts
ğ’ : Set
ğ’ = List (MVar Ã— ğ’¯) Ã— List (RVar Ã— ğ’¯)


-- Syntactic entailment
infix 3 _âŠ¢_âˆ·_
data _âŠ¢_âˆ·_ : ğ’ â†’ Term â†’ ğ’¯ â†’ Set
  where
    áµáµ›_#_  : âˆ€ {A Î” Î“} â†’ (x : MVar) (i : Î” âˆ‹ (x , A))
                       â†’ Î” â Î“ âŠ¢ áµáµ› x âˆ· A

    Ê³áµ›_#_  : âˆ€ {A Î” Î“} â†’ (x : RVar) (i : Î“ âˆ‹ (x , A))
                       â†’ Î” â Î“ âŠ¢ Ê³áµ› x âˆ· A

    Æ›_âˆ™_   : âˆ€ {A B M Î” Î“} â†’ (x : RVar) (ğ’Ÿ : Î” â Î“ , (x , A) âŠ¢ M âˆ· B)
                           â†’ Î” â Î“ âŠ¢ Æ› x âˆ™ M âˆ· A âŠƒ B

    _$_    : âˆ€ {A B M N Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ M âˆ· A âŠƒ B) (â„° : Î” â Î“ âŠ¢ N âˆ· A)
                             â†’ Î” â Î“ âŠ¢ M $ N âˆ· B

    _,_    : âˆ€ {A B M N Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ M âˆ· A) (â„° : Î” â Î“ âŠ¢ N âˆ· B)
                             â†’ Î” â Î“ âŠ¢ M , N âˆ· A âˆ§ B

    Ï€â‚     : âˆ€ {A B M Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ M âˆ· A âˆ§ B)
                           â†’ Î” â Î“ âŠ¢ Ï€â‚ M âˆ· A

    Ï€â‚‚     : âˆ€ {A B M Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ M âˆ· A âˆ§ B)
                           â†’ Î” â Î“ âŠ¢ Ï€â‚‚ M âˆ· B

    tt     : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢ tt âˆ· ğ•‹

    âŒœ_âŒ    : âˆ€ {A M Î” Î“} â†’ (ğ’Ÿ : Î” â âˆ… âŠ¢ M âˆ· A)
                         â†’ Î” â Î“ âŠ¢ âŒœ M âŒ âˆ· â–¡ A

    âŒ_âŒŸ_âˆ™_ : âˆ€ {A C M N Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ M âˆ· â–¡ A) (x : MVar) (â„° : Î” , (x , A) â Î“ âŠ¢ N âˆ· C)
                             â†’ Î” â Î“ âŠ¢ âŒ M âŒŸ x âˆ™ N âˆ· C

    _â¦‚_    : âˆ€ {A M Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ M âˆ· A) (Aâ€² : ğ’¯) {{_ : A â‰¡ Aâ€²}}
                         â†’ Î” â Î“ âŠ¢ M â¦‚ A âˆ· A


áµáµ›0 : âˆ€ {A Î” Î“} â†’ (x : MVar) â†’ Î” , (x , A) â Î“ âŠ¢ áµáµ› x âˆ· A
áµáµ›0 x = áµáµ› x # zero

áµáµ›1 : âˆ€ {A yB Î” Î“} â†’ (x : MVar) â†’ Î” , (x , A) , yB â Î“ âŠ¢ áµáµ› x âˆ· A
áµáµ›1 x = áµáµ› x # suc zero

áµáµ›2 : âˆ€ {A yB zC Î” Î“} â†’ (x : MVar) â†’ Î” , (x , A) , yB , zC â Î“ âŠ¢ áµáµ› x âˆ· A
áµáµ›2 x = áµáµ› x # suc (suc zero)


Ê³áµ›0 : âˆ€ {A Î” Î“} â†’ (x : RVar) â†’ Î” â Î“ , (x , A) âŠ¢ Ê³áµ› x âˆ· A
Ê³áµ›0 x = Ê³áµ› x # zero

Ê³áµ›1 : âˆ€ {A yB Î” Î“} â†’ (x : RVar) â†’ Î” â Î“ , (x , A) , yB âŠ¢ Ê³áµ› x âˆ· A
Ê³áµ›1 x = Ê³áµ› x # suc zero

Ê³áµ›2 : âˆ€ {A yB zC Î” Î“} â†’ (x : RVar) â†’ Î” â Î“ , (x , A) , yB , zC âŠ¢ Ê³áµ› x âˆ· A
Ê³áµ›2 x = Ê³áµ› x # suc (suc zero)


-- Normal and neutral forms
mutual
  infix 3 _âŠ¢â‚™â‚˜_âˆ·_
  data _âŠ¢â‚™â‚˜_âˆ·_ : ğ’ â†’ Term â†’ ğ’¯ â†’ Set
    where
      Æ›_âˆ™_   : âˆ€ {A B M Î” Î“} â†’ (x : RVar) (ğ’Ÿ : Î” â Î“ , (x , A) âŠ¢â‚™â‚˜ M âˆ· B)
                             â†’ Î” â Î“ âŠ¢â‚™â‚˜ Æ› x âˆ™ M âˆ· A âŠƒ B

      _,_    : âˆ€ {A B M N Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚˜ M âˆ· A) (â„° : Î” â Î“ âŠ¢â‚™â‚˜ N âˆ· B)
                               â†’ Î” â Î“ âŠ¢â‚™â‚˜ M , N âˆ· A âˆ§ B

      tt     : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‚™â‚˜ tt âˆ· ğ•‹

      âŒœ_âŒ    : âˆ€ {A M Î” Î“} â†’ (ğ’Ÿ : Î” â âˆ… âŠ¢ M âˆ· A)
                           â†’ Î” â Î“ âŠ¢â‚™â‚˜ âŒœ M âŒ âˆ· â–¡ A

      âŒ_âŒŸ_âˆ™_ : âˆ€ {A C M N Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ M âˆ· â–¡ A) (x : MVar) (â„° : Î” , (x , A) â Î“ âŠ¢â‚™â‚˜ N âˆ· C)
                               â†’ Î” â Î“ âŠ¢â‚™â‚˜ âŒ M âŒŸ x âˆ™ N âˆ· C

      â¿áµ—     : âˆ€ {x M Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ M âˆ· áµ—áµ› x)
                           â†’ Î” â Î“ âŠ¢â‚™â‚˜ M âˆ· áµ—áµ› x

  infix 3 _âŠ¢â‚™â‚œ_âˆ·_
  data _âŠ¢â‚™â‚œ_âˆ·_ : ğ’ â†’ Term â†’ ğ’¯ â†’ Set
    where
      áµáµ›_#_ : âˆ€ {A Î” Î“} â†’ (x : MVar) (i : Î” âˆ‹ (x , A))
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ áµáµ› x âˆ· A

      Ê³áµ›_#_ : âˆ€ {A Î” Î“} â†’ (x : RVar) (i : Î“ âˆ‹ (x , A))
                        â†’ Î” â Î“ âŠ¢â‚™â‚œ Ê³áµ› x âˆ· A

      _$_   : âˆ€ {A B M N Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ M âˆ· A âŠƒ B) (â„° : Î” â Î“ âŠ¢â‚™â‚˜ N âˆ· A)
                              â†’ Î” â Î“ âŠ¢â‚™â‚œ M $ N âˆ· B

      Ï€â‚    : âˆ€ {A B M Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ M âˆ· A âˆ§ B)
                            â†’ Î” â Î“ âŠ¢â‚™â‚œ Ï€â‚ M âˆ· A

      Ï€â‚‚    : âˆ€ {A B M Î” Î“} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â‚™â‚œ M âˆ· A âˆ§ B)
                            â†’ Î” â Î“ âŠ¢â‚™â‚œ Ï€â‚‚ M âˆ· B


mutual
  embâ‚™â‚˜ : âˆ€ {Î” Î“ M A} â†’ Î” â Î“ âŠ¢â‚™â‚˜ M âˆ· A â†’ Î” â Î“ âŠ¢ M âˆ· A
  embâ‚™â‚˜ (Æ› x âˆ™ ğ’Ÿ)     = Æ› x âˆ™ embâ‚™â‚˜ ğ’Ÿ
  embâ‚™â‚˜ (ğ’Ÿ , â„°)       = embâ‚™â‚˜ ğ’Ÿ , embâ‚™â‚˜ â„°
  embâ‚™â‚˜ tt            = tt
  embâ‚™â‚˜ (âŒœ ğ’Ÿ âŒ)       = âŒœ ğ’Ÿ âŒ
  embâ‚™â‚˜ (âŒ ğ’Ÿ âŒŸ x âˆ™ â„°) = âŒ embâ‚™â‚œ ğ’Ÿ âŒŸ x âˆ™ embâ‚™â‚˜ â„°
  embâ‚™â‚˜ (â¿áµ— ğ’Ÿ)        = embâ‚™â‚œ ğ’Ÿ

  embâ‚™â‚œ : âˆ€ {Î” Î“ M A} â†’ Î” â Î“ âŠ¢â‚™â‚œ M âˆ· A â†’ Î” â Î“ âŠ¢ M âˆ· A
  embâ‚™â‚œ (áµáµ› x # i) = áµáµ› x # i
  embâ‚™â‚œ (Ê³áµ› x # i) = Ê³áµ› x # i
  embâ‚™â‚œ (ğ’Ÿ $ â„°)    = embâ‚™â‚œ ğ’Ÿ $ embâ‚™â‚˜ â„°
  embâ‚™â‚œ (Ï€â‚ ğ’Ÿ)     = Ï€â‚ (embâ‚™â‚œ ğ’Ÿ)
  embâ‚™â‚œ (Ï€â‚‚ ğ’Ÿ)     = Ï€â‚‚ (embâ‚™â‚œ ğ’Ÿ)


--------------------------------------------------------------------------------
--
-- Renaming


mren : âˆ€ {Î” Î”â€² Î“ M A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢ M âˆ· A
                      â†’ Î”â€² â Î“ âŠ¢ M âˆ· A
mren Î· (áµáµ› x # i)    = áµáµ› x # lookupáµ£ Î· i
mren Î· (Ê³áµ› x # i)    = Ê³áµ› x #  i
mren Î· (Æ› x âˆ™ ğ’Ÿ)     = Æ› x âˆ™ mren Î· ğ’Ÿ
mren Î· (ğ’Ÿ $ â„°)       = mren Î· ğ’Ÿ $ mren Î· â„°
mren Î· (ğ’Ÿ , â„°)       = mren Î· ğ’Ÿ , mren Î· â„°
mren Î· (Ï€â‚ ğ’Ÿ)        = Ï€â‚ (mren Î· ğ’Ÿ)
mren Î· (Ï€â‚‚ ğ’Ÿ)        = Ï€â‚‚ (mren Î· ğ’Ÿ)
mren Î· tt            = tt
mren Î· âŒœ ğ’Ÿ âŒ         = âŒœ mren Î· ğ’Ÿ âŒ
mren Î· (âŒ ğ’Ÿ âŒŸ x âˆ™ â„°) = âŒ mren Î· ğ’Ÿ âŒŸ x âˆ™ mren (liftáµ£ Î·) â„°
mren Î· (ğ’Ÿ â¦‚ A)       = mren Î· ğ’Ÿ â¦‚ A

rren : âˆ€ {Î” Î“ Î“â€² M A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢ M âˆ· A
                      â†’ Î” â Î“â€² âŠ¢ M âˆ· A
rren Î· (áµáµ› x # i)    = áµáµ› x # i
rren Î· (Ê³áµ› x # i)    = Ê³áµ› x # lookupáµ£ Î· i
rren Î· (Æ› x âˆ™ ğ’Ÿ)     = Æ› x âˆ™ rren (liftáµ£ Î·) ğ’Ÿ
rren Î· (ğ’Ÿ $ â„°)       = rren Î· ğ’Ÿ $ rren Î· â„°
rren Î· (ğ’Ÿ , â„°)       = rren Î· ğ’Ÿ , rren Î· â„°
rren Î· (Ï€â‚ ğ’Ÿ)        = Ï€â‚ (rren Î· ğ’Ÿ)
rren Î· (Ï€â‚‚ ğ’Ÿ)        = Ï€â‚‚ (rren Î· ğ’Ÿ)
rren Î· tt            = tt
rren Î· âŒœ ğ’Ÿ âŒ         = âŒœ ğ’Ÿ âŒ
rren Î· (âŒ ğ’Ÿ âŒŸ x âˆ™ â„°) = âŒ rren Î· ğ’Ÿ âŒŸ x âˆ™ rren Î· â„°
rren Î· (ğ’Ÿ â¦‚ A)       = rren Î· ğ’Ÿ â¦‚ A


mutual
  mrenâ‚™â‚˜ : âˆ€ {Î” Î”â€² Î“ M A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‚™â‚˜ M âˆ· A
                          â†’ Î”â€² â Î“ âŠ¢â‚™â‚˜ M âˆ· A
  mrenâ‚™â‚˜ Î· (Æ› x âˆ™ ğ’Ÿ)     = Æ› x âˆ™ mrenâ‚™â‚˜ Î· ğ’Ÿ
  mrenâ‚™â‚˜ Î· (ğ’Ÿ , â„°)       = mrenâ‚™â‚˜ Î· ğ’Ÿ , mrenâ‚™â‚˜ Î· â„°
  mrenâ‚™â‚˜ Î· tt            = tt
  mrenâ‚™â‚˜ Î· âŒœ ğ’Ÿ âŒ         = âŒœ mren Î· ğ’Ÿ âŒ
  mrenâ‚™â‚˜ Î· (âŒ ğ’Ÿ âŒŸ x âˆ™ â„°) = âŒ mrenâ‚™â‚œ Î· ğ’Ÿ âŒŸ x âˆ™ mrenâ‚™â‚˜ (liftáµ£ Î·) â„°
  mrenâ‚™â‚˜ Î· (â¿áµ— ğ’Ÿ)        = â¿áµ— (mrenâ‚™â‚œ Î· ğ’Ÿ)

  mrenâ‚™â‚œ : âˆ€ {Î” Î”â€² Î“ M A} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‚™â‚œ M âˆ· A
                          â†’ Î”â€² â Î“ âŠ¢â‚™â‚œ M âˆ· A
  mrenâ‚™â‚œ Î· (áµáµ› x # i) = áµáµ› x # lookupáµ£ Î· i
  mrenâ‚™â‚œ Î· (Ê³áµ› x # i) = Ê³áµ› x # i
  mrenâ‚™â‚œ Î· (ğ’Ÿ $ â„°)    = mrenâ‚™â‚œ Î· ğ’Ÿ $ mrenâ‚™â‚˜ Î· â„°
  mrenâ‚™â‚œ Î· (Ï€â‚ ğ’Ÿ)     = Ï€â‚ (mrenâ‚™â‚œ Î· ğ’Ÿ)
  mrenâ‚™â‚œ Î· (Ï€â‚‚ ğ’Ÿ)     = Ï€â‚‚ (mrenâ‚™â‚œ Î· ğ’Ÿ)


mutual
  rrenâ‚™â‚˜ : âˆ€ {Î” Î“ Î“â€² M A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‚™â‚˜ M âˆ· A
                          â†’ Î” â Î“â€² âŠ¢â‚™â‚˜ M âˆ· A
  rrenâ‚™â‚˜ Î· (Æ› x âˆ™ ğ’Ÿ)     = Æ› x âˆ™ rrenâ‚™â‚˜ (liftáµ£ Î·) ğ’Ÿ
  rrenâ‚™â‚˜ Î· (ğ’Ÿ , â„°)       = rrenâ‚™â‚˜ Î· ğ’Ÿ , rrenâ‚™â‚˜ Î· â„°
  rrenâ‚™â‚˜ Î· tt            = tt
  rrenâ‚™â‚˜ Î· âŒœ ğ’Ÿ âŒ         = âŒœ ğ’Ÿ âŒ
  rrenâ‚™â‚˜ Î· (âŒ ğ’Ÿ âŒŸ x âˆ™ â„°) = âŒ rrenâ‚™â‚œ Î· ğ’Ÿ âŒŸ x âˆ™ rrenâ‚™â‚˜ Î· â„°
  rrenâ‚™â‚˜ Î· (â¿áµ— ğ’Ÿ)        = â¿áµ— (rrenâ‚™â‚œ Î· ğ’Ÿ)

  rrenâ‚™â‚œ : âˆ€ {Î” Î“ Î“â€² M A} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‚™â‚œ M âˆ· A
                          â†’ Î” â Î“â€² âŠ¢â‚™â‚œ M âˆ· A
  rrenâ‚™â‚œ Î· (áµáµ› x # i) = áµáµ› x # i
  rrenâ‚™â‚œ Î· (Ê³áµ› x # i) = Ê³áµ› x # lookupáµ£ Î· i
  rrenâ‚™â‚œ Î· (ğ’Ÿ $ â„°)    = rrenâ‚™â‚œ Î· ğ’Ÿ $ rrenâ‚™â‚˜ Î· â„°
  rrenâ‚™â‚œ Î· (Ï€â‚ ğ’Ÿ)     = Ï€â‚ (rrenâ‚™â‚œ Î· ğ’Ÿ)
  rrenâ‚™â‚œ Î· (Ï€â‚‚ ğ’Ÿ)     = Ï€â‚‚ (rrenâ‚™â‚œ Î· ğ’Ÿ)


renâ‚™â‚˜ : âˆ€ {Î” Î”â€² Î“ Î“â€² M A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â‚™â‚˜ M âˆ· A
                          â†’ Î”â€² â Î“â€² âŠ¢â‚™â‚˜ M âˆ· A
renâ‚™â‚˜ Î· ğ’Ÿ = (mrenâ‚™â‚˜ (projâ‚ Î·) âˆ˜ rrenâ‚™â‚˜ (projâ‚‚ Î·)) ğ’Ÿ

renâ‚™â‚œ : âˆ€ {Î” Î”â€² Î“ Î“â€² M A} â†’ Î”â€² â Î“â€² âŠ‡Â² Î” â Î“ â†’ Î” â Î“ âŠ¢â‚™â‚œ M âˆ· A
                          â†’ Î”â€² â Î“â€² âŠ¢â‚™â‚œ M âˆ· A
renâ‚™â‚œ Î· ğ’Ÿ = (mrenâ‚™â‚œ (projâ‚ Î·) âˆ˜ rrenâ‚™â‚œ (projâ‚‚ Î·)) ğ’Ÿ


--------------------------------------------------------------------------------
--
-- Substitution


-- Simultaneous substitutions
infix 3 _âŠ¢â‹†_
_âŠ¢â‹†_ : ğ’ â†’ List ğ’¯ â†’ Set
Î” â Î“ âŠ¢â‹† Î = All (Î» A â†’ Î£ Term (Î» M â†’ Î” â Î“ âŠ¢ M âˆ· A)) Î


mrenâ‹† : âˆ€ {Î” Î”â€² Î“ Î} â†’ Î”â€² âŠ‡ Î” â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î”â€² â Î“ âŠ¢â‹† Î
mrenâ‹† Î· Ïƒ = mapAll (mapÎ£ id (mren Î·)) Ïƒ

rrenâ‹† : âˆ€ {Î” Î“ Î“â€² Î} â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” â Î“â€² âŠ¢â‹† Î
rrenâ‹† Î· Ïƒ = mapAll (mapÎ£ id (rren Î·)) Ïƒ


mwkâ‚› : âˆ€ {x A Î” Î“ Î} â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” , (x , A) â Î“ âŠ¢â‹† Î
mwkâ‚› Ïƒ = mrenâ‹† (wkáµ£ idáµ£) Ïƒ

rwkâ‚› : âˆ€ {x A Î” Î“ Î} â†’ Î” â Î“ âŠ¢â‹† Î
                     â†’ Î” â Î“ , (x , A) âŠ¢â‹† Î
rwkâ‚› Ïƒ = rrenâ‹† (wkáµ£ idáµ£) Ïƒ


mliftâ‚› : âˆ€ {x A Î” Î“ Î} â†’ Î” â Î“ âŠ¢â‹† Î
                       â†’ Î” , (x , A) â Î“ âŠ¢â‹† Î , A
mliftâ‚› {x} Ïƒ = mwkâ‚› Ïƒ , (áµáµ› x , (áµáµ› x # zero))

rliftâ‚› : âˆ€ {x A Î” Î“ Î} â†’ Î” â Î“ âŠ¢â‹† Î
                       â†’ Î” â Î“ , (x , A) âŠ¢â‹† Î , A
rliftâ‚› {x} Ïƒ = rwkâ‚› Ïƒ , (Ê³áµ› x , (Ê³áµ› x # zero))


midâ‚› : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‹† map projâ‚‚ Î”
midâ‚› {âˆ…}     = âˆ…
midâ‚› {Î” , A} = mliftâ‚› midâ‚›

ridâ‚› : âˆ€ {Î“ Î”} â†’ Î” â Î“ âŠ¢â‹† map projâ‚‚ Î“
ridâ‚› {âˆ…}     = âˆ…
ridâ‚› {Î“ , A} = rliftâ‚› ridâ‚›


lookupâ‚› : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î âˆ‹ A
                      â†’ Î£ Term (Î» M â†’ Î” â Î“ âŠ¢ M âˆ· A)
lookupâ‚› Ïƒ i = lookupAll Ïƒ i


-- Substitution

msubâ‚œâ‚˜ : âˆ€ {Î” Î“ Î M A} â†’ {Î¾ : List MVar} {{p : length Î¾ â‰¡ length Î}}
                       â†’ Î” â âˆ… âŠ¢â‹† Î â†’ zip Î¾ Î â Î“ âŠ¢ M âˆ· A
                       â†’ Term
msubâ‚œâ‚˜ Ïƒ (áµáµ› x # i)          = projâ‚ (lookupâ‚› Ïƒ (projâˆ‹â‚‚ i))
msubâ‚œâ‚˜ Ïƒ (Ê³áµ› x # i)          = Ê³áµ› x
msubâ‚œâ‚˜ Ïƒ (Æ› x âˆ™ ğ’Ÿ)           = Æ› x âˆ™ msubâ‚œâ‚˜ Ïƒ ğ’Ÿ
msubâ‚œâ‚˜ Ïƒ (ğ’Ÿ $ â„°)             = msubâ‚œâ‚˜ Ïƒ ğ’Ÿ $ msubâ‚œâ‚˜ Ïƒ â„°
msubâ‚œâ‚˜ Ïƒ (ğ’Ÿ , â„°)             = msubâ‚œâ‚˜ Ïƒ ğ’Ÿ , msubâ‚œâ‚˜ Ïƒ â„°
msubâ‚œâ‚˜ Ïƒ (Ï€â‚ ğ’Ÿ)              = Ï€â‚ (msubâ‚œâ‚˜ Ïƒ ğ’Ÿ)
msubâ‚œâ‚˜ Ïƒ (Ï€â‚‚ ğ’Ÿ)              = Ï€â‚‚ (msubâ‚œâ‚˜ Ïƒ ğ’Ÿ)
msubâ‚œâ‚˜ Ïƒ tt                  = tt
msubâ‚œâ‚˜ Ïƒ âŒœ ğ’Ÿ âŒ               = âŒœ msubâ‚œâ‚˜ Ïƒ ğ’Ÿ âŒ
msubâ‚œâ‚˜ {{p}} Ïƒ (âŒ ğ’Ÿ âŒŸ x âˆ™ â„°) = âŒ msubâ‚œâ‚˜ Ïƒ ğ’Ÿ âŒŸ x âˆ™ msubâ‚œâ‚˜ {{foo p}} (mliftâ‚› {x} Ïƒ) â„°
msubâ‚œâ‚˜ Ïƒ (ğ’Ÿ â¦‚ A)             = msubâ‚œâ‚˜ Ïƒ ğ’Ÿ â¦‚ A


msub : âˆ€ {Î” Î“ Î M A} â†’ {Î¾ : List MVar} {{p : length Î¾ â‰¡ length Î}}
                     â†’ (Ïƒ : Î” â âˆ… âŠ¢â‹† Î) (ğ’Ÿ : zip Î¾ Î â Î“ âŠ¢ M âˆ· A)
                     â†’ Î” â Î“ âŠ¢ msubâ‚œâ‚˜ Ïƒ ğ’Ÿ âˆ· A
msub Ïƒ (áµáµ› x # i)          = rren infáµ£ (projâ‚‚ (lookupâ‚› Ïƒ (projâˆ‹â‚‚ i)))
msub Ïƒ (Ê³áµ› x # i)          = Ê³áµ› x # i
msub Ïƒ (Æ› x âˆ™ ğ’Ÿ)           = Æ› x âˆ™ msub Ïƒ ğ’Ÿ
msub Ïƒ (ğ’Ÿ $ â„°)             = msub Ïƒ ğ’Ÿ $ msub Ïƒ â„°
msub Ïƒ (ğ’Ÿ , â„°)             = msub Ïƒ ğ’Ÿ , msub Ïƒ â„°
msub Ïƒ (Ï€â‚ ğ’Ÿ)              = Ï€â‚ (msub Ïƒ ğ’Ÿ)
msub Ïƒ (Ï€â‚‚ ğ’Ÿ)              = Ï€â‚‚ (msub Ïƒ ğ’Ÿ)
msub Ïƒ tt                  = tt
msub Ïƒ âŒœ ğ’Ÿ âŒ               = âŒœ msub Ïƒ ğ’Ÿ âŒ
msub {{p}} Ïƒ (âŒ ğ’Ÿ âŒŸ x âˆ™ â„°) = âŒ msub Ïƒ ğ’Ÿ âŒŸ x âˆ™ msub {{foo p}} (mliftâ‚› Ïƒ) â„°
msub Ïƒ (_â¦‚_ ğ’Ÿ A {{refl}})  = msub Ïƒ ğ’Ÿ â¦‚ A


--------------------------------------------------------------------------------
--
-- Semantics


-- Introspective Kripke models
record ğ” : Setâ‚ where
  field
    ğ’²    : Set

    ğ’±    : ğ’² â†’ TVar â†’ Set

    _â‰¥_  : ğ’² â†’ ğ’² â†’ Set

    idâ‚  : âˆ€ {w} â†’ w â‰¥ w

    _âˆ˜â‚_ : âˆ€ {w wâ€² wâ€³} â†’ wâ€² â‰¥ w â†’ wâ€³ â‰¥ wâ€²
                       â†’ wâ€³ â‰¥ w

    accáµ¥ : âˆ€ {x w wâ€²} â†’ wâ€² â‰¥ w â†’ ğ’± w x
                      â†’ ğ’± wâ€² x

    âŒŠ_âŒ‹  : ğ’² â†’ ğ’

    âŒŠ_âŒ‹â‚ : âˆ€ {w wâ€²} â†’ wâ€² â‰¥ w
                    â†’ âŒŠ wâ€² âŒ‹ âŠ‡Â² âŒŠ w âŒ‹

open ğ” {{â€¦}} public


áµâŒŠ_âŒ‹ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List (MVar Ã— ğ’¯)
áµâŒŠ w âŒ‹ = projâ‚ âŒŠ w âŒ‹

Ê³âŒŠ_âŒ‹ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List (RVar Ã— ğ’¯)
Ê³âŒŠ w âŒ‹ = projâ‚‚ âŒŠ w âŒ‹

áµâŒŠ_âŒ‹â‚ : âˆ€ {{ğ” : ğ”}} {w wâ€²} â†’ wâ€² â‰¥ w
                           â†’ áµâŒŠ wâ€² âŒ‹ âŠ‡ áµâŒŠ w âŒ‹
áµâŒŠ Î· âŒ‹â‚ = projâ‚ âŒŠ Î· âŒ‹â‚

Ê³âŒŠ_âŒ‹â‚ : âˆ€ {{ğ” : ğ”}} {w wâ€²} â†’ wâ€² â‰¥ w
                           â†’ Ê³âŒŠ wâ€² âŒ‹ âŠ‡ Ê³âŒŠ w âŒ‹
Ê³âŒŠ Î· âŒ‹â‚ = projâ‚‚ âŒŠ Î· âŒ‹â‚


-- Values
mutual
  infix 3 _âŠ©_
  _âŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ ğ’¯ â†’ Set

  w âŠ© áµ—áµ› x  = ğ’± w x

  w âŠ© A âŠƒ B = âˆ€ {wâ€²} â†’ (Î· : wâ€² â‰¥ w) (k : wâ€² áµâŠ© A)
                      â†’ wâ€² áµâŠ© B

  w âŠ© A âˆ§ B = w áµâŠ© A Ã— w áµâŠ© B

  w âŠ© ğ•‹     = âŠ¤

  w âŠ© â–¡ A   = âˆ€ {wâ€²} â†’ (Î· : wâ€² â‰¥ w)
                      â†’ wâ€² áµáµâŠ© A

  infix 3 _áµâŠ©_
  _áµâŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ ğ’¯ â†’ Set
  w áµâŠ© A = âˆ€ {wâ€² C} â†’ (Î· : wâ€² â‰¥ w) (f : âˆ€ {wâ€³} â†’ wâ€³ â‰¥ wâ€² â†’ wâ€³ âŠ© A
                                                 â†’ Î£ Term (Î» Mâ€³ â†’ âŒŠ wâ€³ âŒ‹ âŠ¢â‚™â‚˜ Mâ€³ âˆ· C))
                     â†’ Î£ Term (Î» Mâ€² â†’ âŒŠ wâ€² âŒ‹ âŠ¢â‚™â‚˜ Mâ€² âˆ· C)

  infix 3 _áµáµâŠ©_
  _áµáµâŠ©_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ ğ’¯ â†’ Set
  w áµáµâŠ© A = Î£ Term (Î» M â†’ áµâŒŠ w âŒ‹ â âˆ… âŠ¢ M âˆ· A) Ã— w áµâŠ© A


syn : âˆ€ {{ğ” : ğ”}} {w A} â†’ w áµáµâŠ© A
                        â†’ Î£ Term (Î» M â†’ áµâŒŠ w âŒ‹ â âˆ… âŠ¢ M âˆ· A)
syn Mğ’Ÿk = projâ‚ Mğ’Ÿk

sem : âˆ€ {{ğ” : ğ”}} {w A} â†’ w áµáµâŠ© A
                        â†’ w áµâŠ© A
sem Mğ’Ÿk = projâ‚‚ Mğ’Ÿk


-- Environments
infix 3 _áµâŠ©â‹†_
_áµâŠ©â‹†_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List ğ’¯ â†’ Set
w áµâŠ©â‹† Î = All (w áµâŠ©_) Î

infix 3 _áµáµâŠ©â‹†_
_áµáµâŠ©â‹†_ : âˆ€ {{ğ” : ğ”}} â†’ ğ’² â†’ List ğ’¯ â†’ Set
w áµáµâŠ©â‹† Î = All (w áµáµâŠ©_) Î


synâ‹† : âˆ€ {{ğ” : ğ”}} {w Î} â†’ w áµáµâŠ©â‹† Î
                         â†’ áµâŒŠ w âŒ‹ â âˆ… âŠ¢â‹† Î
synâ‹† mÏ = mapAll syn mÏ

semâ‹† : âˆ€ {{ğ” : ğ”}} {w Î} â†’ w áµáµâŠ©â‹† Î
                         â†’ w áµâŠ©â‹† Î
semâ‹† mÏ = mapAll sem mÏ


-- Semantic entailment
infix 3 _âŠ¨_
_âŠ¨_ : ğ’ â†’ ğ’¯ â†’ Setâ‚
Î” â Î“ âŠ¨ A = âˆ€ {{ğ” : ğ”}} {w} â†’ w áµáµâŠ©â‹† map projâ‚‚ Î” â†’ w áµâŠ©â‹† map projâ‚‚ Î“
                             â†’ w áµâŠ© A


-- Accessibility
mutual
  acc : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w âŠ© A
                             â†’ wâ€² âŠ© A
  acc {áµ—áµ› x}  Î· Mğ’Ÿ = accáµ¥ Î· Mğ’Ÿ
  acc {A âŠƒ B} Î· f = Î» Î·â€² â†’ f (Î· âˆ˜â‚ Î·â€²)
  acc {A âˆ§ B} Î· p = kacc {A} Î· (projâ‚ p) , kacc {B} Î· (projâ‚‚ p)
  acc {ğ•‹}     Î· t = tt
  acc {â–¡ A}   Î· f = Î» Î·â€² â†’ f (Î· âˆ˜â‚ Î·â€²)

  kacc : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâŠ© A
                              â†’ wâ€² áµâŠ© A
  kacc Î· k = Î» Î·â€² f â†’ k (Î· âˆ˜â‚ Î·â€²) f

mkacc : âˆ€ {{ğ” : ğ”}} {A w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµáµâŠ© A
                             â†’ wâ€² áµáµâŠ© A
mkacc {A} Î· (M , ğ’Ÿ , k) = M , mren áµâŒŠ Î· âŒ‹â‚ ğ’Ÿ , kacc {A} Î· k

kaccâ‹† : âˆ€ {{ğ” : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµâŠ©â‹† Î
                             â†’ wâ€² áµâŠ©â‹† Î
-- TODO: Why does Agda require seemingly unused annotations here?
-- kaccâ‹† Î· rÏ = mapAll (kacc Î·) rÏ
kaccâ‹† Î· rÏ = mapAll (Î» {A} k {_} {_} â†’ kacc {A} Î· (k {_})) rÏ

mkaccâ‹† : âˆ€ {{ğ” : ğ”}} {Î w wâ€²} â†’ wâ€² â‰¥ w â†’ w áµáµâŠ©â‹† Î
                              â†’ wâ€² áµáµâŠ©â‹† Î
mkaccâ‹† Î· mÏ = mapAll (mkacc Î·) mÏ


-- Kripke continuation monad
return : âˆ€ {{ğ” : ğ”}} {A w} â†’ w âŠ© A
                           â†’ w áµâŠ© A
return {A} a = Î» Î· f â†’
                 f idâ‚ (acc {A} Î· a)

bind : âˆ€ {{ğ” : ğ”}} {A C w} â†’ w áµâŠ© A â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² âŠ© A
                                                 â†’ wâ€² áµâŠ© C)
                           â†’ w áµâŠ© C
bind k f = Î» Î· fâ€² â†’
             k Î· (Î» Î·â€² a â†’
               f (Î· âˆ˜â‚ Î·â€²) a idâ‚ (Î» Î·â€³ b â†’
                 fâ€² (Î·â€² âˆ˜â‚ Î·â€³) b))


klookupâ‚‘ : âˆ€ {{ğ” : ğ”}} {Î A w} â†’ w áµâŠ©â‹† Î â†’ Î âˆ‹ A
                               â†’ w áµâŠ© A
klookupâ‚‘ rÏ i = lookupAll rÏ i


kÆ› : âˆ€ {{ğ” : ğ”}} {A B w} â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² áµâŠ© A
                                    â†’ wâ€² áµâŠ© B)
                         â†’ w áµâŠ© A âŠƒ B
kÆ› {A} {B} f = return {A âŠƒ B} (Î» Î· k â†’ f Î· k)

k$ : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A âŠƒ B â†’ w áµâŠ© A
                         â†’ w áµâŠ© B
k$ {A} {B} kâ‚ kâ‚‚ = bind {A âŠƒ B} {B} kâ‚ (Î» Î· f â†’ f idâ‚ (kacc {A} Î· kâ‚‚))

k, : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A â†’ w áµâŠ© B
                         â†’ w áµâŠ© A âˆ§ B
k, {A} {B} kâ‚ kâ‚‚ = return {A âˆ§ B} (kâ‚ , kâ‚‚)

kÏ€â‚ : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A âˆ§ B
                          â†’ w áµâŠ© A
kÏ€â‚ {A} {B} k = bind {A âˆ§ B} {A} k (Î» Î· p â†’ projâ‚ p)

kÏ€â‚‚ : âˆ€ {{ğ” : ğ”}} {A B w} â†’ w áµâŠ© A âˆ§ B
                          â†’ w áµâŠ© B
kÏ€â‚‚ {A} {B} k = bind {A âˆ§ B} {B} k (Î» Î· p â†’ projâ‚‚ p)

ktt : âˆ€ {{ğ” : ğ”}} {w} â†’ w áµâŠ© ğ•‹
ktt = return {ğ•‹} tt

kâŒœâŒ : âˆ€ {{ğ” : ğ”}} {A w} â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w
                                   â†’ wâ€² áµáµâŠ© A)
                        â†’ w áµâŠ© â–¡ A
kâŒœâŒ {A} f = return {â–¡ A} (Î» Î· â†’ f Î·)

kâŒâŒŸ : âˆ€ {{ğ” : ğ”}} {A C w} â†’ w áµâŠ© â–¡ A
                          â†’ (âˆ€ {wâ€²} â†’ wâ€² â‰¥ w â†’ wâ€² áµáµâŠ© A
                                     â†’ wâ€² áµâŠ© C)
                          â†’ w áµâŠ© C
kâŒâŒŸ {A} {C} k f = bind {â–¡ A} {C} k (Î» Î· fâ€² â†’ f Î· (fâ€² idâ‚))


-- -- Soundness
-- â†“ : âˆ€ {Î” Î“ M A} â†’ Î” â Î“ âŠ¢ M âˆ· A
--                 â†’ Î” â Î“ âŠ¨ A
-- â†“ (áµáµ› x # i)             mÏ rÏ = klookupâ‚‘ (semâ‹† mÏ) (projâˆ‹â‚‚ i)
-- â†“ (Ê³áµ› x # i)             mÏ rÏ = klookupâ‚‘ rÏ (projâˆ‹â‚‚ i)
-- â†“ (Æ›_âˆ™_ {A} {B} x ğ’Ÿ)     mÏ rÏ = kÆ› {A} {B} (Î» Î· k â†’
--                                    â†“ ğ’Ÿ (mkaccâ‹† Î· mÏ) (kaccâ‹† Î· rÏ , k))
-- â†“ (_$_ {A} {B} ğ’Ÿ â„°)      mÏ rÏ = k$ {A} {B} (â†“ ğ’Ÿ mÏ rÏ) (â†“ â„° mÏ rÏ)
-- â†“ (_,_ {A} {B} ğ’Ÿ â„°)      mÏ rÏ = k, {A} {B} (â†“ ğ’Ÿ mÏ rÏ) (â†“ â„° mÏ rÏ)
-- â†“ (Ï€â‚_ {A} {B} ğ’Ÿ)        mÏ rÏ = kÏ€â‚ {A} {B} (â†“ ğ’Ÿ mÏ rÏ)
-- â†“ (Ï€â‚‚_ {A} {B} ğ’Ÿ)        mÏ rÏ = kÏ€â‚‚ {A} {B} (â†“ ğ’Ÿ mÏ rÏ)
-- â†“ tt                     mÏ rÏ = ktt
-- â†“ {Î”} (âŒœ_âŒ {A} {M} ğ’Ÿ)    mÏ rÏ rewrite lemâ‚„ Î” â»Â¹
--                                = kâŒœâŒ {A} (Î» Î· â†’
--                                    msubâ‚œâ‚˜ {Î¾ = map projâ‚ Î”} (synâ‹† (mkaccâ‹† Î· mÏ)) ğ’Ÿ
--                                  , msub {Î¾ = map projâ‚ Î”} (synâ‹† (mkaccâ‹† Î· mÏ)) ğ’Ÿ
--                                  , â†“ ğ’Ÿ (mkaccâ‹† Î· mÏ) âˆ…)
-- â†“ (âŒ_âŒŸ_âˆ™_ {A} {C} ğ’Ÿ x â„°) mÏ rÏ = kâŒâŒŸ {A} {C} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· Mğ’Ÿk â†’
--                                    â†“ â„° (mkaccâ‹† Î· mÏ , Mğ’Ÿk) (kaccâ‹† Î· rÏ))


-- Soundness, inlined
â†“ : âˆ€ {Î” Î“ M A} â†’ Î” â Î“ âŠ¢ M âˆ· A
                â†’ Î” â Î“ âŠ¨ A
â†“ (áµáµ› x # i)             mÏ rÏ = klookupâ‚‘ (semâ‹† mÏ) (projâˆ‹â‚‚ i)
â†“ (Ê³áµ› x # i)             mÏ rÏ = klookupâ‚‘ rÏ (projâˆ‹â‚‚ i)
â†“ (Æ›_âˆ™_ {A} {B} x ğ’Ÿ)     mÏ rÏ = return {A âŠƒ B} (Î» Î· k â†’
                                   â†“ ğ’Ÿ (mkaccâ‹† Î· mÏ) (kaccâ‹† Î· rÏ , k))
â†“ (_$_ {A} {B} ğ’Ÿ â„°)      mÏ rÏ = bind {A âŠƒ B} {B} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· f â†’
                                   f idâ‚ (â†“ â„° (mkaccâ‹† Î· mÏ) (kaccâ‹† Î· rÏ)))
â†“ (_,_ {A} {B} ğ’Ÿ â„°)      mÏ rÏ = return {A âˆ§ B} (â†“ ğ’Ÿ mÏ rÏ , â†“ â„° mÏ rÏ)
â†“ (Ï€â‚ {A} {B} ğ’Ÿ)         mÏ rÏ = bind {A âˆ§ B} {A} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· p â†’ projâ‚ p)
â†“ (Ï€â‚‚ {A} {B} ğ’Ÿ)         mÏ rÏ = bind {A âˆ§ B} {B} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· p â†’ projâ‚‚ p)
â†“ tt                     mÏ rÏ = return {ğ•‹} tt
â†“ {Î”} (âŒœ_âŒ {A} {M} ğ’Ÿ)    mÏ rÏ rewrite lemâ‚„ Î” â»Â¹
                               = return {â–¡ A} (Î» Î· â†’
                                   msubâ‚œâ‚˜ {Î¾ = map projâ‚ Î”} (synâ‹† (mkaccâ‹† Î· mÏ)) ğ’Ÿ
                                 , msub {Î¾ = map projâ‚ Î”} (synâ‹† (mkaccâ‹† Î· mÏ)) ğ’Ÿ
                                 , â†“ ğ’Ÿ (mkaccâ‹† Î· mÏ) âˆ…)
â†“ (âŒ_âŒŸ_âˆ™_ {A} {C} ğ’Ÿ x â„°) mÏ rÏ = bind {â–¡ A} {C} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· f â†’
                                   â†“ â„° (mkaccâ‹† Î· mÏ , f idâ‚) (kaccâ‹† Î· rÏ))
â†“ (_â¦‚_ ğ’Ÿ A {{refl}})     mÏ rÏ = bind {A} {A} (â†“ ğ’Ÿ mÏ rÏ) (Î» Î· a â†’
                                   return {A} a)


--------------------------------------------------------------------------------
--
-- Completeness


-- Canonical model
instance
  ğ”á¶œ : ğ”
  ğ”á¶œ = record
         { ğ’²    = ğ’
         ; ğ’±    = Î» { (Î” â Î“) x â†’ Î£ Term (Î» M â†’ Î” â Î“ âŠ¢â‚™â‚˜ M âˆ· áµ—áµ› x ) }
         ; _â‰¥_  = _âŠ‡Â²_
         ; idâ‚  = idáµ£áµ£
         ; _âˆ˜â‚_ = _âˆ˜áµ£áµ£_
         ; accáµ¥ = Î» { Î· (M , ğ’Ÿ) â†’ M , renâ‚™â‚˜ Î· ğ’Ÿ }
         ; âŒŠ_âŒ‹  = id
         ; âŒŠ_âŒ‹â‚ = id
         }


-- Canonical soundness and completeness

-- TODO: Generate fresh names!
mutual
  â†‘á¶œ : âˆ€ {A Î” Î“} â†’ Î” â Î“ áµâŠ© A
                 â†’ Î£ Term (Î» M â†’ Î” â Î“ âŠ¢â‚™â‚˜ M âˆ· A)
  â†‘á¶œ {áµ—áµ› x}  k = k idáµ£áµ£ (Î» Î· Mğ’Ÿ â†’ Mğ’Ÿ)
  â†‘á¶œ {A âŠƒ B} k = k idáµ£áµ£ (Î» Î· f â†’ let M , ğ’Ÿ = â†‘á¶œ (f (rwkáµ£áµ£ idáµ£áµ£) (â†“á¶œ (Ê³áµ› "RFRESH" # zero))) in
                                  Æ› "RFRESH" âˆ™ M , Æ› "RFRESH" âˆ™ ğ’Ÿ)
  â†‘á¶œ {A âˆ§ B} k = k idáµ£áµ£ (Î» Î· p â†’ let M , ğ’Ÿ = â†‘á¶œ (projâ‚ p) in
                                  let N , â„° = â†‘á¶œ (projâ‚‚ p) in
                                  (M , N) , (ğ’Ÿ , â„°))
  â†‘á¶œ {ğ•‹}     k = k idáµ£áµ£ (Î» Î· t â†’ tt , tt)
  â†‘á¶œ {â–¡ A}   k = k idáµ£áµ£ (Î» Î· f â†’ let M , ğ’Ÿ = syn (f idáµ£áµ£) in
                                  âŒœ M âŒ , âŒœ ğ’Ÿ âŒ)

  â†“á¶œ : âˆ€ {A M Î” Î“} â†’ Î” â Î“ âŠ¢â‚™â‚œ M âˆ· A
                   â†’ Î” â Î“ áµâŠ© A
  â†“á¶œ {áµ—áµ› x}  {M} ğ’Ÿ = return {áµ—áµ› x} (M , â¿áµ— ğ’Ÿ)
  â†“á¶œ {A âŠƒ B} {M} ğ’Ÿ = return {A âŠƒ B} (Î» Î· k â†’ â†“á¶œ (renâ‚™â‚œ Î· ğ’Ÿ $ projâ‚‚ (â†‘á¶œ k)))
  â†“á¶œ {A âˆ§ B} {M} ğ’Ÿ = return {A âˆ§ B} (â†“á¶œ (Ï€â‚ ğ’Ÿ) , â†“á¶œ (Ï€â‚‚ ğ’Ÿ))
  â†“á¶œ {ğ•‹ }    {M} ğ’Ÿ = return {ğ•‹} tt
  â†“á¶œ {â–¡ A}   {M} ğ’Ÿ {_} {C} = Î» Î· f â†’
                         let N , â„° = f (mwkáµ£áµ£ idáµ£áµ£) Î» Î·â€² â†’
                                       áµáµ› "MFRESH"
                                     , (áµáµ› "MFRESH" # mlookupáµ£áµ£ Î·â€² zero)
                                     , â†“á¶œ (áµáµ› "MFRESH" # mlookupáµ£áµ£ Î·â€² zero) in
                         âŒ M âŒŸ "MFRESH" âˆ™ N , âŒ renâ‚™â‚œ Î· ğ’Ÿ âŒŸ "MFRESH" âˆ™ â„°


mkidâ‚‘ : âˆ€ {Î” Î“} â†’ Î” â Î“ áµáµâŠ©â‹† map projâ‚‚ Î”
mkidâ‚‘ {âˆ…}           = âˆ…
mkidâ‚‘ {Î” , (x , A)} = mkaccâ‹† (mwkáµ£áµ£ idáµ£áµ£) mkidâ‚‘ , (áµáµ› x , (áµáµ› x # zero) , â†“á¶œ (áµáµ› x # zero))

kidâ‚‘ : âˆ€ {Î“ Î”} â†’ Î” â Î“ áµâŠ©â‹† map projâ‚‚ Î“
kidâ‚‘ {âˆ…}           = âˆ…
kidâ‚‘ {Î“ , (x , A)} = kaccâ‹† (rwkáµ£áµ£ idáµ£áµ£) kidâ‚‘ , â†“á¶œ (Ê³áµ› x # zero)


-- Completeness
â†‘ : âˆ€ {Î” Î“ A} â†’ Î” â Î“ âŠ¨ A
              â†’ Î£ Term (Î» M â†’ Î” â Î“ âŠ¢â‚™â‚˜ M âˆ· A)
â†‘ ğ” = â†‘á¶œ (ğ” mkidâ‚‘ kidâ‚‘)


-- Normalisation
nf : âˆ€ {Î” Î“ M A} â†’ Î” â Î“ âŠ¢ M âˆ· A
                 â†’ Î£ Term (Î» Mâ€² â†’ Î” â Î“ âŠ¢â‚™â‚˜ Mâ€² âˆ· A)
nf = â†‘ âˆ˜ â†“


--------------------------------------------------------------------------------
--
-- Examples


axI : âˆ€ {A Î” Î“}
    â†’ Î” â Î“ âŠ¢ Æ› "x" âˆ™ Ê³áµ› "x"
             âˆ· A âŠƒ A
axI = Æ› "x" âˆ™ Ê³áµ›0 "x"

axK : âˆ€ {A B Î” Î“}
    â†’ Î” â Î“ âŠ¢ Æ› "x" âˆ™ (Æ› "y" âˆ™ Ê³áµ› "x")
             âˆ· A âŠƒ B âŠƒ A
axK = Æ› "x" âˆ™ (Æ› "y" âˆ™ Ê³áµ›1 "x")

axS : âˆ€ {A B C Î” Î“}
    â†’ Î” â Î“ âŠ¢ Æ› "f" âˆ™ (Æ› "g" âˆ™ (Æ› "x" âˆ™
                  ((Ê³áµ› "f" $ Ê³áµ› "x") $ (Ê³áµ› "g" $ Ê³áµ› "x"))))
             âˆ· (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
axS = Æ› "f" âˆ™ (Æ› "g" âˆ™ (Æ› "x" âˆ™
        ((Ê³áµ›2 "f" $ Ê³áµ›0 "x" ) $ (Ê³áµ›1 "g" $ Ê³áµ›0 "x"))))


axD : âˆ€ {A B Î” Î“}
    â†’ Î” â Î“ âŠ¢ Æ› "'f" âˆ™ (Æ› "'x" âˆ™
                  (âŒ Ê³áµ› "'f" âŒŸ "f" âˆ™ (âŒ Ê³áµ› "'x" âŒŸ "x" âˆ™
                    (âŒœ áµáµ› "f" $ áµáµ› "x" âŒ))))
             âˆ· â–¡ (A âŠƒ B) âŠƒ â–¡ A âŠƒ â–¡ B
axD = Æ› "'f" âˆ™ (Æ› "'x" âˆ™
        (âŒ Ê³áµ›1 "'f" âŒŸ "f" âˆ™ (âŒ Ê³áµ›0 "'x" âŒŸ "x" âˆ™
          (âŒœ áµáµ›1 "f" $ áµáµ›0 "x" âŒ))))

axT : âˆ€ {A Î” Î“}
    â†’ Î” â Î“ âŠ¢ Æ› "'x" âˆ™ (âŒ Ê³áµ› "'x" âŒŸ "x" âˆ™ (áµáµ› "x"))
             âˆ· â–¡ A âŠƒ A
axT = Æ› "'x" âˆ™ (âŒ Ê³áµ›0 "'x" âŒŸ "x" âˆ™ (áµáµ›0 "x"))

ax4 : âˆ€ {A Î” Î“}
    â†’ Î” â Î“ âŠ¢ Æ› "'x" âˆ™ (âŒ Ê³áµ› "'x" âŒŸ "x" âˆ™ (âŒœ âŒœ áµáµ› "x" âŒ âŒ))
             âˆ· â–¡ A âŠƒ â–¡ â–¡ A
ax4 = Æ› "'x" âˆ™ (âŒ Ê³áµ›0 "'x" âŒŸ "x" âˆ™ (âŒœ âŒœ áµáµ›0 "x" âŒ âŒ))


--------------------------------------------------------------------------------
--
-- Conversion tests


testâˆ¼ : âˆ€ {Î” Î“ Mâ‚ Mâ‚‚ A} â†’ Î” â Î“ âŠ¢ Mâ‚ âˆ· A â†’ Î” â Î“ âŠ¢ Mâ‚‚ âˆ· A â†’ Set
testâˆ¼ {Mâ‚‚ = Mâ‚‚} ğ’Ÿâ‚ ğ’Ÿâ‚‚ with nf ğ’Ÿâ‚
testâˆ¼ {Mâ‚‚ = Mâ‚‚} ğ’Ÿâ‚ ğ’Ÿâ‚‚ | Mâ‚â€² , ğ’Ÿâ‚â€² with Mâ‚â€² â‰Ÿâ‚œâ‚˜ Mâ‚‚
testâˆ¼ {Mâ‚‚ = Mâ‚‚} ğ’Ÿâ‚ ğ’Ÿâ‚‚ | .Mâ‚‚ , ğ’Ÿâ‚â€² | yes refl  = embâ‚™â‚˜ ğ’Ÿâ‚â€² â‰¡ ğ’Ÿâ‚‚
testâˆ¼ {Mâ‚‚ = Mâ‚‚} ğ’Ÿâ‚ ğ’Ÿâ‚‚ | Mâ‚â€² , ğ’Ÿâ‚â€² | no Mâ‚â€²â‰¢Mâ‚‚ = âŠ¥


-- redâŠƒ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ , A âŠ¢ B) (N : Î” â Î“ âŠ¢ A)
--                     â†’ Æ› M $ N âˆ¼ rsub (ridâ‚› , N) M

testâˆ¼redâŠƒ : testâˆ¼ {âˆ…} {âˆ… , ("x" , "A")}
                  ((Æ› "y" âˆ™ Ê³áµ›0 "y") $ Ê³áµ›0 "x")
                  (Ê³áµ›0 "x")
testâˆ¼redâŠƒ = refl


-- redâˆ§â‚ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A) (N : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚ (M , N) âˆ¼ M

testâˆ¼redâˆ§â‚ : testâˆ¼ {âˆ…} {âˆ… , ("x" , "A") , ("y" , "B")}
                   (Ï€â‚ (Ê³áµ›1 "x" , Ê³áµ›0 "y"))
                   (Ê³áµ›1 "x")
testâˆ¼redâˆ§â‚ = refl


-- redâˆ§â‚‚ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A) (N : Î” â Î“ âŠ¢ B)
--                     â†’ Ï€â‚‚ (M , N) âˆ¼ N

testâˆ¼redâˆ§â‚‚ : testâˆ¼ {âˆ…} {âˆ… , ("x" , "A") , ("y" , "B")}
                   (Ï€â‚‚ (Ê³áµ›1 "x" , Ê³áµ›0 "y"))
                   (Ê³áµ›0 "y")
testâˆ¼redâˆ§â‚‚ = refl


-- redâ–¡ : âˆ€ {Î” Î“ A C} â†’ (M : Î” â âˆ… âŠ¢ A) (N : Î” , A â Î“ âŠ¢ C)
--                    â†’ âŒ âŒœ M âŒ âŒŸ N âˆ¼ msub (midâ‚› , M) N

testâˆ¼redâ–¡ : testâˆ¼ {âˆ… , ("x" , "A")} {âˆ…}
                  (âŒ âŒœ áµáµ›0 "x" âŒ âŒŸ "y" âˆ™ áµáµ›0 "y")
                  (áµáµ›0 "x")
testâˆ¼redâ–¡ = refl


-- expâŠƒ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A âŠƒ B)
--                     â†’ M âˆ¼ Æ› (ren (wkáµ£ idáµ£) M $ áµ›0)

testâˆ¼expâŠƒ : testâˆ¼ {âˆ…} {âˆ… , ("f" , "A" âŠƒ "B")}
                  (Ê³áµ›0 "f")
                  (Æ› "RFRESH" âˆ™ (rren (wkáµ£ idáµ£) (Ê³áµ›0 "f") $ Ê³áµ›0 "RFRESH"))
testâˆ¼expâŠƒ = refl


-- expâˆ§ : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A âˆ§ B)
--                    â†’ M âˆ¼ Ï€â‚ M , Ï€â‚‚ M

testâˆ¼expâˆ§ : testâˆ¼ {âˆ…} {âˆ… , ("x" , "A" âˆ§ "B")}
                  (Ê³áµ›0 "x")
                  (Ï€â‚ (Ê³áµ›0 "x") , Ï€â‚‚ (Ê³áµ›0 "x"))
testâˆ¼expâˆ§ = refl


-- expğ•‹ : âˆ€ {Î” Î“} â†’ (M : Î” â Î“ âŠ¢ ğ•‹)
--                 â†’ M âˆ¼ tt

testâˆ¼expğ•‹ : testâˆ¼ {âˆ…} {âˆ… , ("x" , ğ•‹)}
                  (Ê³áµ›0 "x")
                  tt
testâˆ¼expğ•‹ = refl


-- expâ–¡ : âˆ€ {Î” Î“} â†’ (M : Î” â Î“ âŠ¢ â–¡ A)
--                â†’ M âˆ¼ âŒ M âŒŸ âŒœ áµáµ›0 âŒ

testâˆ¼expâ–¡ : testâˆ¼ {âˆ…} {âˆ… , ("'x" , â–¡ "A")}
                  (Ê³áµ›0 "'x")
                  (âŒ Ê³áµ›0 "'x" âŒŸ "MFRESH" âˆ™ âŒœ áµáµ›0 "MFRESH" âŒ)
testâˆ¼expâ–¡ = refl


-- commâ–¡$ : âˆ€ {Î” Î“ A B X} â†’ (K : Î” â Î“ âŠ¢ â–¡ X)
--                           (M : Î” , X â Î“ âŠ¢ A âŠƒ B) (N : Î” â Î“ âŠ¢ A)
--                        â†’ (âŒ K âŒŸ M) $ N âˆ¼ âŒ K âŒŸ (M $ (mren (wkáµ£ idáµ£) N))

testâˆ¼commâ–¡$ : testâˆ¼ {âˆ…} {âˆ… , ("'f" , â–¡ ("A" âŠƒ "B")) , ("x" , "A")}
                    ((âŒ Ê³áµ›1 "'f" âŒŸ "f" âˆ™ áµáµ›0 "f") $ Ê³áµ›0 "x")
                    (âŒ Ê³áµ›1 "'f" âŒŸ "MFRESH" âˆ™ (áµáµ›0 "MFRESH" $ mren (wkáµ£ idáµ£) (Ê³áµ›0 "x")))
testâˆ¼commâ–¡$ = refl


-- commâ–¡âŒâŒŸ : âˆ€ {Î” Î“ A C X} â†’ (K : Î” â Î“ âŠ¢ â–¡ X)
--                            (M : Î” , X â Î“ âŠ¢ â–¡ A) (N : Î” , A â Î“ âŠ¢ C)
--                         â†’ âŒ (âŒ K âŒŸ M) âŒŸ N âˆ¼ âŒ K âŒŸ (âŒ M âŒŸ (mren (wkáµ£ idáµ£) N))

testâˆ¼commâ–¡âŒâŒŸ : testâˆ¼ {âˆ…} {âˆ… , ("''x" , â–¡ â–¡ "A")}
                     (âŒ âŒ Ê³áµ›0 "''x" âŒŸ "'x" âˆ™ áµáµ›0 "'x" âŒŸ "x" âˆ™ áµáµ›0 "x")
                     (âŒ Ê³áµ›0 "''x" âŒŸ "MFRESH" âˆ™ âŒ áµáµ›0 "MFRESH" âŒŸ "MFRESH" âˆ™ áµáµ›0 "MFRESH")  -- TODO: Generate fresh names!
testâˆ¼commâ–¡âŒâŒŸ = refl


-- commâ–¡Ï€â‚ : âˆ€ {Î” Î“ A B X} â†’ (K : Î” â Î“ âŠ¢ â–¡ X)
--                            (M : Î” , X â Î“ âŠ¢ A âˆ§ B)
--                         â†’ Ï€â‚ (âŒ K âŒŸ M) âˆ¼ âŒ K âŒŸ (Ï€â‚ M)

testâˆ¼commâ–¡Ï€â‚ : testâˆ¼ {âˆ…} {âˆ… , ("'x" , â–¡ ("A" âˆ§ "B"))}
                     (Ï€â‚ (âŒ Ê³áµ›0 "'x" âŒŸ "x" âˆ™ áµáµ›0 "x"))
                     (âŒ Ê³áµ›0 "'x" âŒŸ "MFRESH" âˆ™ Ï€â‚ (áµáµ›0 "MFRESH"))
testâˆ¼commâ–¡Ï€â‚ = refl


-- commâ–¡Ï€â‚‚ : âˆ€ {Î” Î“ A B X} â†’ (K : Î” â Î“ âŠ¢ â–¡ X)
--                            (M : Î” , X â Î“ âŠ¢ A âˆ§ B)
--                         â†’ Ï€â‚‚ (âŒ K âŒŸ M) âˆ¼ âŒ K âŒŸ (Ï€â‚‚ M)

testâˆ¼commâ–¡Ï€â‚‚ : testâˆ¼ {âˆ…} {âˆ… , ("'x" , â–¡ ("A" âˆ§ "B"))}
                     (Ï€â‚‚ (âŒ Ê³áµ›0 "'x" âŒŸ "x" âˆ™ áµáµ›0 "x"))
                     (âŒ Ê³áµ›0 "'x" âŒŸ "MFRESH" âˆ™ Ï€â‚‚ (áµáµ›0 "MFRESH"))
testâˆ¼commâ–¡Ï€â‚‚ = refl


--------------------------------------------------------------------------------
--
-- Self-interpretation


-- weakBP : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A)
--                      â†’ ğ•‹ $ âŒœ M âŒ âˆ¼ âŒœ M âŒ

testâˆ¼weakBP : testâˆ¼ {âˆ… , ("x" , "A")} {âˆ…}
                    (axT $ âŒœ áµáµ›0 "x" âŒ)
                    (áµáµ›0 "x")
testâˆ¼weakBP = refl


-- Andrej : âˆ€ {Î” Î“ A B} â†’ (M : Î” â Î“ âŠ¢ A âŠƒ B) (N : Î” â Î“ âŠ¢ A)
--                      â†’ (ğ”» $ âŒœ M âŒ) $ âŒœ N âŒ âˆ¼ âŒœ M $ N âŒ

testâˆ¼Andrej : testâˆ¼ {âˆ… , ("f" , "A" âŠƒ "B") , ("x" , "A")} {âˆ…}
                    ((axD $ âŒœ áµáµ›1 "f" âŒ) $ âŒœ áµáµ›0 "x" âŒ)
                    (âŒœ áµáµ›1 "f" $ áµáµ›0 "x" âŒ)
testâˆ¼Andrej = refl


--------------------------------------------------------------------------------
